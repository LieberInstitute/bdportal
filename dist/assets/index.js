var Dn=Object.defineProperty,An=Object.defineProperties;var jn=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Ft=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var Mt=(e,l,r)=>l in e?Dn(e,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[l]=r,Fe=(e,l)=>{for(var r in l||(l={}))Ft.call(l,r)&&Mt(e,r,l[r]);if(tt)for(var r of tt(l))Bt.call(l,r)&&Mt(e,r,l[r]);return e},_e=(e,l)=>An(e,jn(l));var Lt=(e,l)=>{var r={};for(var s in e)Ft.call(e,s)&&l.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&tt)for(var s of tt(e))l.indexOf(s)<0&&Bt.call(e,s)&&(r[s]=e[s]);return r};import{j as Mn,a as Fn,F as Bn,y as se,$ as v,M as Ln,b as En,c as Pn,C as en,d as Ce,e as Tn,R as k,B as we,p as Qe,s as xe,f as D,I as oe,l as ne,N as Nt,U as tn,D as nn,g as ln,h as an,i as Be,k as $n,m as Ue,n as Ye,o as In,q as On,L as me,A as _n,r as Et,t as ze,S as zn}from"./vendor.js";const qn=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerpolicy&&(c.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?c.credentials="include":a.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(a){if(a.ep)return;a.ep=!0;const c=r(a);fetch(a.href,c)}};qn();const et="/dev/bdportal/";var Xn="/dev/bdportal/assets/logo.svg",Un="/dev/bdportal/assets/bands.png",Gn="/dev/bdportal/assets/bands_r.png",Hn="/dev/bdportal/assets/brain_encircled.svg";const t=Mn,o=Fn,pe=Bn;function Ge(e){if(!(e.toggle&&typeof e.toggle=="function"))throw new Error("DlgModal: props.toggle function must be provided !");const l=e.title?e.title:" ",r=e.buttonClose?e.buttonClose:"Close";e.buttonEnable||(e.buttonEnable=()=>!0);async function s(a){let c=!0;a.preventDefault(),e.onSubmit&&typeof e.onSubmit=="function"&&(c=await e.onSubmit(a)),c&&e.toggle()}return se(()=>{const a=v(".modal-body").find("input[type='text']:enabled:visible:first");a&&a.focus()}),o(Ln,{focus:!0,fade:!1,backdrop:"static",isOpen:e.isOpen,toggle:e.toggle,children:[o("div",{className:"modal-header app-bg pt-1 mt-0",style:"height:32px;",children:[t("h5",{className:"modal-title",style:"line-height:120%;",children:l}),t("div",{type:"button",tabindex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:e.toggle,children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),o(En,{onSubmit:s,children:[t(Pn,{className:"app-bg",children:t(en,{fluid:!0,children:t(Ce,{children:e.children})})}),t(Tn,{className:"justify-content-center app-bg",children:o(k,{className:"d-flex w-75 justify-content-around",children:[e.button&&t(we,{type:"submit",className:"app-btn",disabled:!e.buttonEnable(),onClick:a=>{e.buttonAction&&e.buttonAction(a)},children:e.button}),t(we,{color:"secondary rounded-0",onClick:e.toggle,children:r})]})})]})]})}function Vn(e){const[,l]=Qe(g=>g+1,0),s=xe({wasSubmitted:!1,wasInvalid:!1,uname_fld:"",prevUser:""}).current,a=e.button?e.button:"Log in",c=e.checkLogin?e.checkLogin:()=>!0;function d({target:g}){const _=s.uname_fld.length;s.uname_fld=g.value.trim();const T=s.uname_fld.length;let m=0;(_===0&&T>0||_>0&&T===0)&&m++,s.wasInvalid&&(s.wasInvalid=!1,m++),m&&l()}function i({target:g}){s.wasInvalid&&(s.wasInvalid=!1,v(g).parents().find("#invalid").hide())}function n(g){if(g.key.toLowerCase()==="enter"){const _=g.target.form,T=[..._].indexOf(g.target);_.elements[T+1].focus(),g.preventDefault()}}function y(){return s.uname_fld.length>0}function P(g){if(g){v("#login-spinner").addClass("spinner-border");const _=v(".modal-content").find(":button");_&&_.prop("disabled",!0)}else{v("#login-spinner").removeClass("spinner-border");const _=v(".modal-content").find(":button");_&&_.prop("disabled",!1)}}async function B(g){s.wasSubmitted=!0;const _=g.target.username.value.trim(),T=g.target.password.value;P(!0);const m=await c(_,T);return P(!1),m?(s.wasInvalid=!1,!0):(s.prevUser=_,s.wasInvalid=!0,l(),!1)}function A(g){s.wasInvalid=!1,s.uname_fld="",e.toggle(g)}se(()=>{s.wasInvalid&&v(".modal-body").find("#invalid").show()});const x=e.isOpen||s.wasSubmitted&&s.wasInvalid;return s.wasSubmitted=!1,o(Ge,{title:e.title,isOpen:x,toggle:A,onSubmit:B,button:a,buttonEnable:y,invalid:s.wasInvalid,children:[o(k,{className:"d-flex form-group align-items-center justify-content-center",style:"height:1.4em;",children:[t("span",{children:"\xA0"}),s.wasInvalid&&t("span",{id:"invalid",style:"color:red",children:"Invalid login !"}),t("div",{id:"login-spinner",className:"text-danger",role:"status",children:"\xA0"}),t("span",{children:"\xA0"})]}),o(k,{className:"d-flex form-group align-items-center",children:[t(D,{xs:"4",className:"d-flex justify-content-end",children:t("span",{children:"Username: "})}),t(D,{xs:"6",className:"d-flex justify-content-start p-2",children:t(oe,{type:"text",name:"username",onChange:d,onKeyDown:n})})]}),o(k,{className:"d-flex form-group align-items-center",children:[t(D,{xs:"4",className:"d-flex justify-content-end",children:t("span",{children:"Password: "})}),t(D,{xs:"6",className:"d-flex justify-content-start p-2",children:t(oe,{type:"password",name:"password",onChange:i})})]}),t(k,{className:"w-100 d-flex align-items-center",style:"height:1.4em;"})]})}function Wn(e){const l=e.prompt?e.prompt:"Are you sure?",r=e.title?e.title:"Confirm",s=e.button?e.button:"Yes",a=e.buttonClose?e.buttonClose:"No";function c(d){return e.onConfirm&&e.onConfirm(d),!0}return o(Ge,{title:r,isOpen:e.isOpen,toggle:e.toggle,onSubmit:c,button:s,buttonClose:a,children:[t(k,{className:"p-1 d-flex form-group align-items-center justify-content-center",children:t("span",{style:"font-size:120%; font-weight:800;",children:l})}),t(k,{className:"w-100 d-flex align-items-center"})]})}const Je={brsel:[1,"Brain Matrix",["matrix","Select"],["browse","Browse"]],rna:[2,"bulk RNAseq",["sel","Select"],["exp","Explore"],["rep","Reports"]],dnam:[3,"DNA methylation"],lrna:[4,"long RNAseq"],default:"brsel"},ot=[];function Kn(){ot.length||(Object.keys(Je).forEach(e=>{if(e!=="default"){const l=Je[e];ot.push([e,...l])}}),ot.sort((e,l)=>e[1]-l[1]))}function Pt(){return window.location.hash.replace("#","")||"/"}function Jn(e){window.location.hash=e}function Zn(){const[e,l]=ne(Pt());return se(()=>{const r=()=>l(Pt());return window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r)},[]),[e,Jn]}function Qn(e){if(!e)return[Je.default];const l=[];let r=e;for(;r.charAt(0)=="/";)r=r.substring(1);if(r.length==0)return l[0]=Je.default,l;for(r=r.replace("//","/");r.length&&r.charAt(r.length-1)=="/";)r=r.substring(0,r.length-1);return r.split("/")}function Yn({login:e}){const[l,r]=ne(!1),[s,a]=ne(!1);function c(){r(!l)}function d(){a(!s)}const[i,n]=ne(["","",null]);function y(){i[2]?a(!0):r(!0)}function P(){n(["","",null])}async function B(A,x){const g={username:A,password:x},_={"Access-Control-Allow-Origin":"*"};try{const T=await $n.post("/auth",g,{headers:_});if(T)return n([T.data.signed_user,"x",T.data.token]),!0}catch(T){console.log(`Error : ${T}`)}return!1}return se(()=>{r(!1)},[]),o(pe,{children:[t("span",{className:"navlogin",onClick:()=>y(),children:i[2]?i[0]:"Login"}),t(Vn,{isOpen:l,toggle:c,checkLogin:B,title:"User Login"}),t(Wn,{isOpen:s,toggle:d,onConfirm:P,title:"Logout"})]})}function el({page:e,tab:l,menuClick:r}){Kn();const s=et;function a(i,n){i!=e&&(r||typeof r!="function")&&r(i,n)}const c=Je[e];if(!c)return o("h1",{children:[" Navdata for page $",e," not found!"]});const d=c.slice(2);return!l&&d.length&&(l=d[0][0]),o(Nt,{className:"bg-light d-flex align-items-center navheader flex-nowrap",children:[t("a",{href:"http://www.libd.org",children:t("img",{alt:"logo",src:Xn,style:{height:"2rem"}})}),t("span",{style:{height:"100%",padding:"0.5rem 1rem"},children:" "}),o(tn,{nav:!0,inNavbar:!0,className:"p-0 m-0 ddtsel",children:[t(nn,{className:"navdbtsel v-100 m-2",nav:!0,caret:!0,children:c[1]}),t(ln,{className:"navddlst",children:ot.map((i,n)=>t(an,{disabled:n>1,onClick:()=>a(i[0],i[1]),children:i[2]},n))})]}),t("div",{class:"navtab-box flex-nowrap",children:d.length>0&&d.map(i=>t(Be,{className:i[0]===l?"navtab selected":"navtab",id:i[0],children:t("div",{children:t("a",{href:`${s}#/${e}/${i[0]}`,children:i[1]})})},i[0]))}),o(Be,{className:"ml-auto nav-right",children:[t("img",{alt:"bands",src:Un,className:"navimgbands"}),t("span",{className:"navtitle",children:"LIBData Portal"}),t("img",{alt:"bands_r",src:Gn,className:"navimgbands"}),t(Yn,{}),t("img",{alt:"brainlogo",src:Hn,style:{height:"2rem",paddingRight:"0.5rem"}})]})]})}const Xe=[],tl=["Brain Matrix","bulk RNAseq","DNA methylation","WGS","scRNAseq","long RNAseq","microRNA"],he={selXType:0,prevSelXType:-1,dataLoaded:!1,rebuildRMatrix:!0},Ct=65,G={reg:["reg"],regFull:["regname"],dx:["dx"],dxFull:["dxname"],dset:[],dsetp:[],dsetRef:[],proto:[[1,"PolyA","Ribo-Zero HMR","Ribo-Zero Gold"],[2,"450k","WGBS"],[3,"WGS"]],race:["race"],sex:["sex"],age:["age","fetal","0-15","16-64","65+"],ageRanges:[[0],[.01,15.99],[16,64.99],[Ct]]};function nl(e,l){return G.dsetRef[e][l]}const Tt=["reg"],$t=["dx"],ut=[],Re=[],mt=[{}],We=[],ft=[],ht=new Set,ct=new Set,qe=[],$e=[],ye={reg:[],dx:[],race:[],sex:[],age:[],dset:[],proto:[]},fe={reg:[],dx:[],race:[],sex:[],age:[]},ue={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],proto:["proto"],dset:["dset"]},te={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],dx2cx:{},cx2dx:{},s2cx:{},r2cx:{},cx2s:{},cx2r:{},cxDxSex:[],cxDxRace:[],Brains:new Set},Le=te.Brains,de={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],proto:["proto"],dset:["dset"]},C={reg:new Set,dx:new Set,proto:new Set,dset:new Set,age:new Set,ageRange:[],race:new Set,sex:new Set,brSet:new Set,brXtX:new Set,with_seq:!1,with_gt:!1},It=G.ageRanges;function sn(){return C.brSet}function rn(){C.brSet.clear(),Ae()}function on(e){if(e.length==0)return 0;const l=[];for(let r=0;r<e.length;r++){let s=e[r],a=parseInt(s.replace("Br",""));a>0&&(a=mt[0][a]),a&&l.push(a)}if(l.length==0)return 0;St(!0);for(let r=0;r<l.length;r++)C.brSet.add(l[r]);return Ae(),l.length}function Te(e){if(e=Math.floor(e*10)/10,e<0)return 1;if(e===0)return 2;let l=It.length;if(e>=Ct)return l;--l;for(let r=1;r<l;++r){let s=It[r];if(e>=s[0]&&e<=s[1])return r+1}return 0}const Ke=(e,l)=>{l||(l="[updateCounts]"),console.log(`${l} WARNING: could not get an Age range index from age ${e}"`)};function ll(e){const l=e.dtypes.length;if(!l){console.log("FATAL ERROR: numDataTypes is zero!!!");return}Xe.length=0,e.dtypes.forEach(m=>{Xe.push(m)}),console.log("[loadData] loading data.."),["sex","race"].forEach(m=>{let j=G[m];j.length=0,j.push(m),Array.prototype.push.apply(j,e[m])});const r=G.race;for(let m=1;m<r.length;m++)r[m]=="Multi-Racial"?r[m]="Multi":r[m]=="Native American"&&(r[m]="NA");Tt.length=1,$t.length=1,["dx","reg"].forEach(m=>{let j=G[m],V=`${m}Full`,$=G[V];j.length=0,j.push(m),$.length=0,$.push(V);let M=e[m],p=null,f=null;if(m==="reg"){f=Tt,p=ye.reg,p.length=0;for(let R=0;R<=l;R++)p.push([R])}else{f=$t,p=fe.dx,p.length=0;for(let R=0;R<=l;R++)p.push([R]);M.forEach(()=>p[0].push(0))}M.forEach(R=>{if(j.length!==R[0]&&console.log(`Error: index mismatch loading ${m} data`),j.push(R[1]),$.push(R[2]),f.push(R[3]),p)for(let q=1;q<=l;q++)p[q].push(R[3+q])})});const s=G.dset,a=G.dsetp,c=G.dsetRef;s.length=0,a.length=0,c.length=0;let d=e.datasets;d.length!==l&&console.log("[loadData] Error: allData.dset len ",d.length," not ",l),ut.length=0;const i=ye.dset;i.length=0,i.push([0]);const n=G.proto,y=ye.proto;y.length=0,y.push([0]);for(let m=1;m<=l;m++){s.push([m]),a.push([m]),c.push([m]),ut.push([m]);const j=m-1;i[m]=[m],d[j].forEach($=>{s[j].push($[1]),i[m].push($[4]),a[j].push($[2]+1),c[j].push($[5]),ut[j].push($[3])}),y[m]=[m];let V=n[j].length;for(;--V;)y[m].push(0)}Re.length=0,Re.push([]),mt.length=0,["dx","reg","race","sex","age"].forEach(m=>{let j=G[m].length;(m==="reg"?[fe[m]]:m==="dx"?[ye[m]]:[fe[m],ye[m]]).forEach($=>{if($){$.length=0;for(let M=0;M<=l;M++){let p=j;for($[M]=[],$[M].length=j,$[M][0]=M;--p;)$[M][p]=0}}})});const P=fe.dx[0],B=fe.age[0],A=fe.race[0],x=fe.sex[0],g={};mt.push(g),ct.clear(),e.brains.forEach(m=>{const[j,V,$,M,p,f,R,q,Z]=m;if(Re.length!==j)throw new Error(`[loadData] Error: brain index ${j} mismatch (${Re.length})`);if(ct.add(j),Re.push([V,$,M,p,f,R,q,Z]),g[V]=j,!Z){let K=Te(f);K===0?Ke(f):B[K]++,P[$]++,x[p]++,A[M]++}});for(let m=0;m<We.length;m++)We[m].length=0;We.length=0,ft.length=0,qe.length=0,$e.length=0;const _=fe.reg[0],T=[];return ht.clear(),e.sdata.forEach((m,j)=>{$e.push([]),We.push(m);const V={};qe.push(V);const $=[],M=[],p=j+1,f=ye.dx[p],R=ye.race[p],q=ye.sex[p],Z=ye.age[p],K=ye.proto[p],b=fe.dx[p],E=fe.race[p],L=fe.sex[p],U=fe.age[p],h=fe.reg[p];let w={},z=0;m.forEach((S,X)=>{const[H,W,,ae,Q]=S;$[W]=H;let N=V[H];N||(N=[],V[H]=N),N.push(X),K[Q]++;const[,O,I,Y,ce,Me,Ie,Ne]=Re[H];if(!Ne){let ge=Te(ce);f[O]++,R[I]++,q[Y]++,Z[ge]++,ht.has(H)||(ht.add(H),ct.delete(H)),w[H]||(z++,w[H]=1,b[O]++,E[I]++,L[Y]++,U[ge]++);const u=`${H}_${ae}`;M[u]||(M[u]=1,h[ae]++),T[u]||(T[u]=1,_[ae]++)}}),ft.push([m.length,z])}),e.sdata=[],e=null,he.prevSelXType=-1,Ae(),he.dataLoaded=!0,[$e,ue,te,!0]}function Se(e){const l=he.selXType;if(!he.dataLoaded)return[];const r=[],s=e==="dset"||e==="proto";if(l===0&&s)throw new Error(`getFilterData(${e}) should NOT be called with 0 selXType`);const a=s?G[e][l-1]:G[e];if(!a||a.length<2)throw new Error(`[getFilterData]: no names data found for filter name "${e}" (selXType=${l})`);const c=e==="reg",d=c||e==="dx"?G[`${e}Full`]:new Array(a.length).fill("");let i=null,n=null;i=l?ye[e][l]:fe[e][0],n=c?de[e][l]:de[e];const y=e==="dset"?G.dsetp[l-1]:[];if(y.length===0&&(y.length=a.length),a.length!==n.length||n.length!==i.length)throw new Error(`[getFilterData ${e}]: fltNames(${a.length}), fltXCounts(${n.length}) and oriCounts(${i.length}) must be equal length!`);return a.forEach((P,B)=>{B&&i[B]>0&&r.push([P,n[B],y[B],B,i[B],d[B]])}),r}function ke(e){const l=C[e];if(l==null)throw new Error(`Error: cannot get filter set for "${e}"`);return l}function Ot(e){const l=C[e];if(l==null||typeof l!="boolean")throw new Error(`Cannot get filter set for "${e}"`);return l}function Rt(e){e==="reg"&&(console.log("WARNING: brXtX filter cleared, did you mean that? *************"),C.brXtX.clear()),Ae()}function _t(){return C.ageRange}function al(){if(C.ageRange.length==2)return!0;let e=!1;const l=C.age;if(l.size==0)return C.ageRange.length=0,!0;if(l.size==1){const r=l.values().next().value;if(r===1)C.ageRange.length=0,C.ageRange.push(-1,0);else if(r===G.ageRanges.length)C.ageRange.length=0,C.ageRange.push(Ct,120);else{const s=G.ageRanges[r-1];C.ageRange.length=0,C.ageRange.push(Math.trunc(s[0]),Math.trunc(s[1]))}}else e=!0,C.ageRange.length=0;return C.age.clear(),e&&Ae(),!e}function zt(e,l){if(!(e in C))throw new Error(`applyFilterCond(${e}) invalid property `);if(typeof C[e]!="boolean")throw new Error(`applyFilterCond(${e}) not a boolean property`);if(typeof l=="undefined")throw new Error(`applyFilterCond(${e}, ?) requires a value`);C[e]=l,Ae()}function sl(e,l,r){const s=C[e];if(s==null)throw new Error(`Error: cannot applyFilterData for "${e}"`);s.clear(),l.forEach(a=>s.add(a)),e==="reg"&&C.brXtX.clear(),r&&C.brXtX.add(r-1),Ae()}function cn(e){for(const l in C)if(!!Object.prototype.hasOwnProperty.call(C,l)){if(l==="ageRange"){if(C[l].length===2)return!0}else if(l.startsWith("with_")&&!e){if(he.selXType===0&&C[l])return!0}else if(C[l].size)return!0}return!1}function St(e){for(const l in C)!Object.prototype.hasOwnProperty.call(C,l)||(l==="ageRange"?C[l].length=0:l.startsWith("with_")?C[l]=!1:C[l].clear());e||Ae()}const nt=1,qt=1<<1,lt=1<<2,Xt=1<<3,Ut=1<<4,at=1<<5,st=1<<6;function dn(e=0,l=!1){he.selXType=e,(l||e!=he.prevSelXType)&&Ae()}let pt,fn,dt,xt,bt,yt,un,hn,gn,mn,pn,xn;function rl(){te.dx2cx={},te.cx2dx={},te.s2cx={},te.r2cx={},te.cx2s={},te.cx2r={},te.cxDxSex.length=0,te.cxDxRace.length=0,Le.clear(),pt=te.dx2cx,fn=te.cx2dx,dt=te.cxDxSex,xt=te.cxDxRace,bt=te.s2cx,yt=te.r2cx,un=te.cx2s,hn=te.cx2r,gn=te.dx,mn=te.age,pn=te.race,xn=te.sex;const e=Xe.length;let l=G.reg.length,r=e+1,s=te.reg;for(s.length=r;r--;){s[r]=[r],s[r].length=l;let a=l;for(;a--;)s[r][a]=0}["dx","age","sex","race"].forEach(a=>{let c=G[a].length,d=te[a];for(d.length=c,d[0]=a;--c;)d[c]=0})}function Gt(e,l,r,s,a){if(Le.has(e))return!1;Le.add(e);let c=pt[l],d=dt.length,i=Object.keys(bt).length,n=Object.keys(yt).length;return c>=0||(pt[l]=d,fn[d]=l,c=d,dt.push(Array(i).fill(0)),xt.push(Array(n).fill(0))),[[bt,un,dt,i,r],[yt,hn,xt,n,s]].forEach(y=>{let[P,B,A,x,g]=y,_=P[g];_>=0||(P[g]=x,B[x]=g,_=x,A.forEach(T=>T.push(0))),A[c]||console.log("brix=",e,"   d=",c,"   cxDxf=",A),A[c][_]++}),gn[l]++,pn[s]++,xn[r]++,a&&mn[a]++,!0}function Ae(){const e=Xe.length,l=he.selXType;l!=he.prevSelXType&&(he.prevSelXType=l);let r=G.reg.length;[ue.reg,de.reg].forEach(p=>{let f=e+1;for(p.length=f;f--;){p[f]=[f],p[f].length=r;let R=r;for(;R--;)p[f][R]=0}}),["dx","age","sex","race"].forEach(p=>{let f=G[p].length;[ue[p],de[p]].forEach(R=>{if(R){let q=f;for(R.length=f,R[0]=p;--q;)R[q]=0}})}),rl();let s=-1;const a=l===0,c=[];$e.length=0;const d=C.ageRange.length==2?C.ageRange.slice():null;if(d&&(d[0]>=0?d[1]=Math.trunc(d[1])+.99:d[1]===0&&(d[1]=-.001)),l){s=l-1,c.push(l-1);let p=ue.dset,f=de.dset,R=G.dset[l-1].length;for(p.length=f.length=R,p[0]=f[0]="dset";--R;)p[R]=0,f[R]=0;for(p=ue.proto,f=de.proto,R=G.proto[l-1].length,p.length=f.length=R,p[0]=f[0]="proto";--R;)p[R]=0,f[R]=0}else{["reg"].forEach(R=>{let q=G[R].length;[te[R][0],de[R][0]].forEach(K=>{if(K){let b=q;for(K.length=q,K[0]=0;--b;)K[b]=0}})});const p=C.brXtX.size;let f=0;if(p){if(p>1)throw new Error("Error: multiple intersection data types not implemented yet!");for(s=C.brXtX.values().next().value,console.log(">>>> brXtX filter:",s),f=0;f<e;f++)if(f===s){c.push(s);break}for(f=0;f<e;f++)f!==s&&c.push(f)}else for(f=0;f<e;f++)c.push(f)}Le.clear();const i=new Set,n=C.brSet,y=n.size>0,P=ue.dx,B=ue.sex,A=ue.age,x=ue.race,g=ue.dset,_=ue.proto,T=de.dx,m=de.age,j=de.race,V=de.sex,$=de.dset,M=de.proto;for(let p=0;p<c.length;p++){const f=c[p],R=We[f];if(!R||R.length==0){console.log(`[updateCounts] Error: no sample data found for data ${Xe[f]}`);continue}const q=[],Z=ue.reg[f+1],K=de.reg[f+1],b=te.reg[f+1];$e[f]=[];const E=R.length;C.reg.values().next().value;for(let L=0;L<E;++L){const[U,h,w,z,S]=R[L];if(y&&!n.has(U)||a&&s>=0&&s!=f&&!Le.has(U))continue;const[,X,H,W,ae,Q,N,O]=Re[U];if(O||C.with_seq&&!Q||C.with_gt&&!N||d&&(ae<d[0]||ae>d[1]))continue;let I=0,Y=0;f===s&&C.reg.size&&!C.reg.has(z)&&(Y|=qt),C.dx.size&&!C.dx.has(X)&&(Y|=nt),C.race.size&&!C.race.has(H)&&(Y|=lt),C.sex.size&&!C.sex.has(W)&&(Y|=at),l&&(C.dset.size&&!C.dset.has(w)&&(Y|=Xt),C.proto.size&&!C.proto.has(S)&&(Y|=Ut)),C.age.size&&(I===0&&(I=Te(ae)),I===0?Ke(ae):C.age.has(I)||(Y|=st));let ce=!i.has(U);const Me=`${U}_${z}`,Ie=!q[Me],Ne=l||ce,ge=l||Ie;if(Y){if(Y===qt&&ge&&(K[z]++,q[Me]=1),Ne){let u=0;switch(Y){case nt:T[X]++,u|=1;break;case Xt:l&&($[w]++,u|=1);break;case Ut:l&&(M[S]++,u|=1);break;case st:I===0&&(I=Te(ae)),I&&m[I]++,u|=1;break;case lt:j[H]++,u|=1;break;case at:V[W]++,u|=1;break}ce&&u&&i.add(U)}continue}Z[z]++,ge&&K[z]++,Ie&&(b[z]++,q[Me]=1),Ne&&(P[X]++,T[X]++,x[H]++,j[H]++,B[W]++,V[W]++,l&&(g[w]++,$[w]++,_[S]++,M[S]++),I===0&&(I=Te(ae)),I===0?Ke(ae):(A[I]++,m[I]++),Gt(U,X,W,H,I)&&i.add(U)),$e[f].push([U,h,w,z,S])}}a&&s<0&&ct.forEach(p=>{const[,f,R,q,Z,K,b,E]=Re[p];if(E||C.with_seq&&!K||C.with_gt&&!b||y&&!n.has(p)||d&&(Z<d[0]||Z>d[1]))return;let L=0,U=0;if(C.dx.size&&!C.dx.has(f)&&(U|=nt),C.race.size&&!C.race.has(R)&&(U|=lt),C.sex.size&&!C.sex.has(q)&&(U|=at),C.age.size&&(L===0&&(L=Te(Z)),L===0?Ke(Z):C.age.has(L)||(U|=st)),U)switch(U){case nt:T[f]++;break;case st:L&&m[L]++;break;case lt:j[R]++;break;case at:V[q]++;break}else T[f]++,j[R]++,L===0&&(L=Te(Z)),V[q]++,L===0?Ke(Z):m[L]++,Gt(p,f,q,R,L)})}function il(e){const l=[];let r=0;const s=["BrNum","Dx","Race","Sex","Age"];if(Array.isArray(e)){r=e.length;for(let a=0;a<r;a++)s.push(Xe[e[a]]+"_samples")}return l.push(s),Le.forEach(a=>{const[c,d,i,n,y]=Re[a],P=[`Br${c}`,G.dx[d],G.race[i],G.sex[n],y];if(r)for(let B=0;B<r;B++){let A=e[B],x=qe[A],g=0;x&&x[a]&&(g=x[a].length),P.push(g)}l.push(P)}),l}const bn=Ue(),ol=Ue();function He(){return Ye(bn)}function cl({children:e}){const[l,r]=ne([$e,ue,te,he.dataLoaded]),[s,a]=ne(et+"data/multi_dta.json.gz");function c(i,n){a(i),r(n)}const d=async i=>{const n=await fetch(i,{mode:"cors"});if(n.headers.get("Content-Type")=="application/json")return JSON.parse(await n.text());let P=new Uint8Array(await n.arrayBuffer());const B=In(P),A=On(B);return JSON.parse(A)};return se(()=>{d(s).then(i=>{console.log("fetching all sample data"),r(ll(i))}).catch(i=>console.log(i))},[s]),t(bn.Provider,{value:l,children:t(ol.Provider,{value:c,children:e})})}function dl(){const e=xe(!0);return se(()=>{e.current=!1},[]),e.current}const yn=Ue(),vn=Ue();function kt(){const e=Ye(yn);if(e===void 0)throw new Error("useFltCtx must be used within FltCtxProvider!");return e}function Dt(){const e=Ye(vn);if(e===void 0)throw new Error("useFltCtxUpdate must be used within FltCtxProvider!");return e}function fl(e){const[l,r]=ne([null,!1]);function s(a){console.log(`FltCtxProvider: requested update of [${l}] by "${a}"`),r(c=>[a,!c[1]])}return t(yn.Provider,{value:l,children:t(vn.Provider,{value:s,children:e.children})})}const ul={dx:"Diagnosis",age:"Age",race:"Ancestry",reg:"Brain region",sex:"Sex",dset:" Datasets ",proto:"Protocol",pub:"Public"};function hl(e,l){if(Object.keys(e).length!==Object.keys(l).length)return!1;for(let r in e)if(e[r]!==l[r])return!1;return!0}function De(e){const l=xe(null),r=xe({fltData:[],onlyStates:{},appliedStates:{},idMap:{},jqCreated:!1,btnApply:null,btnUndo:null,lHeight:0}),[,s]=Qe(N=>N+1,0),a=r.current,c=e.id,d=e.type&&e.type.indexOf("toggle")>=0,i=e.type=="ftoggle"||e.type=="faketoggle",n=typeof e.filter=="function"?e.filter(c):e.filter,y=e.type==="htoggle"||e.horiz,P=d||typeof e.nocollapse!="undefined"||typeof e.noCollapse!="undefined",B=e.data?typeof e.data=="function"?e.data(c):e.data:[["Item-one",101,2,15,1e3,"This is item-1"],["Item-two",202,1,42,2e3,"This is item-2"],["Item-three",303,2,33,3e3,"This is item-3"],["Item-four",404,2,14,4e3,"This is item-4"],["Item-five",508,2,52,5e3,"This is item-5"],["Item-six",803,1,83,3e3,"This is item-6"],["Item-seven",704,2,74,4e3,"This is item-7"],["Item-eight",608,2,62,5e3,"This is item-8"]];if(B.length>0){a.fltData.length=B.length;let N=0;B.forEach((O,I)=>{a.fltData[I]=O,O[1]>N&&(N=O[1])}),e.sort&&a.fltData.sort((O,I)=>I[1]-O[1]),a.fltData.forEach((O,I)=>{a.idMap[O[3]]=I,O[6]=Math.round(O[1]*100/N)})}n&&(a.onlyStates={},n.forEach(N=>a.onlyStates[N]=1),a.appliedStates=Object.assign({},a.onlyStates));const A=c=="age"&&e.ageRange&&e.ageRange.length===2;se(()=>{if(a.fltData.length===0)return;const N=v(l.current);if(a.jqCreated||(a.jqCreated=!0),b(N),a.btnApply=N.find(".lg-apply"),a.btnUndo=N.find(".btn-undo"),!d){const O=N.find(".lg-scroller");p(O),m(),Object.keys(a.onlyStates).length===0&&f()}});function x(N){Object.keys(a.onlyStates).length===a.fltData.length&&(a.onlyStates={}),a.appliedStates=Object.assign({},a.onlyStates),n&&e.updateFilter&&(n.clear(),Object.keys(a.onlyStates).map(Number).forEach(O=>n.add(O))),e.onApply&&e.onApply(a.onlyStates,c),!N&&s()}function g(){return Object.keys(a.appliedStates).length===0&&Object.keys(a.onlyStates).length===a.fltData.length?!1:!hl(a.appliedStates,a.onlyStates)}function _(){A&&(e.ageRange.length=0),T(!0),q()}function T(N){a.onlyStates={},!N&&(f(),s())}function m(){const N=v(l.current).find(".lg-only");N.hide();let O=N.find(".lg-only-item");if(O.off("click"),O.remove(),Object.keys(a.onlyStates).length)N.append(Object.keys(a.onlyStates).map(I=>Number(a.idMap[I])).sort((I,Y)=>I-Y).map(I=>`<span class="lg-only-item" key=${I} id="o${a.fltData[I][3]}">${a.fltData[I][0]}</span>`)),N.show(),O=N.find(".lg-only-item"),O.on("click",I=>{if(!I.target.id||I.target.id.length<2)return;const Y=Number(I.target.id.substring(1)),ce=v(I.target).closest(".lg-panel").find(".lg-item")[a.idMap[Y]];$(v(ce),Y),x()});else if(A){let[I,Y]=e.ageRange,ce="";I<0&&Y<0&&(I=Math.round(I*52+40),Y=Math.round(Y*52+40),ce="PCW"),N.append(`<span class="lg-only-item" key="ar" id="oar">${I} - ${Y} ${ce}</span>`),N.show(),N.find(".lg-only-item").on("click",()=>{_()})}}function j(){const N=g(),O=N&&Object.keys(a.appliedStates).length>0;N?(O?a.btnUndo.show():a.btnUndo.hide(),a.btnApply.show()):(a.btnUndo.hide(),a.btnApply.hide())}function V(N,O,I){d&!(i&&I)&&(a.onlyStates={},N.siblings().removeClass("lg-sel")),N.addClass("lg-sel"),a.onlyStates[O]=1,d||m(),j()}function $(N,O){N.removeClass("lg-sel"),delete a.onlyStates[O],d||m(),j()}function M(N){let O=v(N.target);if(N.preventDefault(),A){e.onNoClickInfo&&e.onNoClickInfo(c,"age-range");return}if(!O.hasClass("lg-item")&&(O=O.closest(".lg-item"),O.length==0))return;const I=parseInt(O[0].id);isNaN(I)||(a.onlyStates[I]?$(O,I):(V(O,I,N.ctrlKey),e.onClickItem&&e.onClickItem(I,c,Object.keys(a.onlyStates))))}function p(N){a.lHeight=N.get(0).scrollHeight;const O=Math.round(N.height());N.off("scroll"),E(N,a.lHeight,O),O<a.lHeight&&N.on("scroll",I=>E(v(I.target),a.lHeight,O))}function f(){if(d)return;const N=v(l.current);if(N.find(".lg-title")){const I=N.find(".lg-lst");I.collapse("show"),N.removeClass("lg-collapsed"),a.lHeight<4&&p(I.find(".lg-scroller"))}}function R(){if(d)return;const N=v(l.current);N.find(".lg-lst").collapse("hide"),N.addClass("lg-collapsed")}function q(){x(),!(d||P)&&(Object.keys(a.onlyStates).length>0?R():f())}function Z(){a.onlyStates=Object.assign({},a.appliedStates),s()}function K(N){v(l.current).hasClass("lg-collapsed")?f():R()}function b(N){return c==="proto"&&!y&&(N.find(".lg-item").css({"font-size":"14px"}),N.find(".lg-count").css({"font-size":"13px"})),N}function E(N,O,I){const Y=N.scrollTop(),ce=N.closest(".lg-panel").find(".lg-lst");Y>1?ce.find(".lg-topshade").show():ce.find(".lg-topshade").hide(),Y+I>=O?ce.find(".lg-bottomshade").hide():ce.find(".lg-bottomshade").show()}function L(N){return a.onlyStates[N]>0?"lg-sel":""}function U(N){return N?N===1?t("span",{class:"lg-item-lock",children:" "}):t("span",{class:"lg-item-pub",children:" "}):null}function h(){const N=!y&&typeof e.nobars=="undefined";return a.fltData.map(O=>o("li",{class:`d-flex justify-content-between lg-item ${y?"lg-item-h":""} ${L(O[3])}`,id:O[3],children:[o("span",{class:"lg-item-th",children:[U(O[2]),O[0]]}),y&&t("span",{class:"lg-spacer",children:" "}),o("span",{class:"lg-item-counts",children:[N&&o("span",{class:"lg-item-bar",children:[" ",t("span",{class:"lg-item-bar-v",style:{width:`${O[6]}%`},children:" "})," "]}),t("span",{class:`badge-primary badge-pill lg-count ${O[1]===0?"lg-count-0":""}`,children:O[1]})]})]},`${O[3]}_${String(Date.now()).substring(4)}`))}let w="lg-panel";d&&(w=`${w} lg-collapsed`),e.class&&(w=`${w} ${e.class}`);const z=!d&&(Object.keys(a.onlyStates).length>0||A),S=g(),X=S&&Object.keys(a.appliedStates).length>0,H=ul[e.id]||e.id,W=P||e.notitleclick,ae=c=="dset"?"lg-title lg-dset-title":"lg-title",Q=y?"lg-toggler d-flex justify-content-around":"lg-toggler";return o("div",{class:w,ref:l,id:e.id,style:{width:e.width?e.width:"auto"},children:[o("div",{class:ae,children:[t("span",{onClick:W?null:K,class:W?"lg-tcaption":"lg-tcaption lg-clickable",children:H}),o("span",{class:"float-right d-flex justify-content-center align-items-center",children:[t("span",{class:"btn-undo",onClick:Z,style:X?{display:"inline-block"}:{display:"none"},children:t("img",{class:"btn-undo-icon"})},String(Date.now()-10).substring(4)),t("span",{class:"lg-apply",onClick:q,style:S?{display:"inline"}:{display:"none"},children:"Apply"},String(Date.now()).substring(4)),!P&&t("span",{className:"coll-glyph",onClick:K,children:" "})]})]}),d?o("ul",{class:Q,onClick:M,style:i?{maxHeight:e.height?e.height:"8.6rem"}:{},children:[h()," "]}):o("ul",{class:"collapse show lg-lst",onClick:M,children:[t("div",{class:"lg-scroller",style:{maxHeight:e.height?e.height:"8.6rem"},children:h()}),t("div",{class:"lg-topshade",children:" "}),t("div",{class:"lg-bottomshade",children:" "})]}),t("div",{class:"lg-only",style:z?"display:block;":"display:none;",children:t("span",{class:"lg-only-lb",onClick:_,children:"\u2715"})},String(Date.now()).substring(4))]})}function gl(e){const l=["gene","tx","ex","jx"];ne("");const[r,s]=ne("dataset_"),[a,c]=ne("rda"),[d,i]=ne(0);function n(A){c(A.target.id=="r1"?"rda":"csv.gz")}function y(A){i(A.target.id=="n0"?0:1)}function P(A){switch(A){case"ex":A="exon";break;case"tx":A="transcript";break;case"jx":A="junction";break}return A.charAt(0).toUpperCase()+A.slice(1)}function B({target:A}){s(A.value)}return o(Ge,_e(Fe({},e),{title:"Download data",justClose:"1",width:"40em",children:[o(k,{className:"form-group d-flex justify-content-center flex-nowrap mb-0 pb-0",style:"font-size:90%;",children:[t(D,{xs:"3",className:"d-flex justify-content-end mr-0 pr-2",children:t(me,{className:"pt-2 float-right",children:"File prefix:"})}),t(D,{xs:"3",className:"ml-0 pl-0 d-flex justify-content-start",children:t(oe,{id:"fpre",onChange:B,value:r})}),o(D,{className:"ml-0 pl-0 d-flex justify-content-start ",children:["File format: \xA0",o(Ce,{tag:"fieldset",onChange:n,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r1",name:"fmt",checked:a=="rda"})," .rda (RSE)"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r2",name:"fmt",checked:a=="csv.gz"})," .csv.gz"]})})]})]})]}),t(k,{className:"d-flex justify-content-center mt-0 pt-0",style:"font-size:90%;",children:o(Ce,{tag:"fieldset",onChange:y,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"n0",name:"norm",checked:d==0})," raw counts"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"n1",name:"norm",checked:d==1})," normalized (RPKM/TPM)"]})})]})}),t(k,{className:"form-group pt-0 mt-0",style:"font-size:90%;min-height:2em;",children:d?o(pe,{children:[t(D,{xs:"4",className:"pr-0 mr-0 align-self-center",style:"max-width:9em;",children:"Restrict to genes:"}),t(D,{xs:"8",className:"pl-0 ml-0 mx-auto mr-0 pr-0",children:t(oe,{placeholder:"GRIN2A,GRIN2B,SP4"})})]}):null}),l.map((A,x)=>o(k,{className:"form-group d-flex justify-content-end",style:"font-size:90%;",children:[o(D,{xs:"4",className:"align-self-center",children:[P(A)," data"]},x+1),o(D,{xs:"4",className:"align-self-center",style:"color:#666;",children:[" ",`${r}${A}.${a}`," "]},x),o(D,{xs:"3",className:"align-self-center",children:[t(we,{className:"btn app-btn",children:"Download"})," "]},x+2)]},A))]}))}function ml(e){let s=e,{datasets:l}=s,r=Lt(s,["datasets"]);return o(Ge,_e(Fe({},r),{title:"Restricted data",button:"Request",buttonClose:"Cancel",children:[o("p",{children:[t("br",{}),"The following datasets are restricted. Please enter access codes for each dataset or press the ",t("b",{children:"Request Access"})," button below to request access to them."]}),o(k,{className:"form-group",children:[t("div",{className:"col-5 align-self-center",children:" "}),t("div",{className:"col-5 align-self-center",children:" Access code  "})]}),l.map(a=>o(k,{className:"form-group",style:"font-size:90%;font-weight:bold;",children:[t(D,{xs:"5",className:"align-self-center",children:a}),o(D,{xs:"4",className:"align-self-center",children:[t(oe,{type:"text",name:"name"})," "]}),o(D,{xs:"3",className:"align-self-center",children:[t(we,{className:"btn-primary",children:"Unlock"})," "]})]},a)),o(k,{className:"form-group justify-content-left ",children:["If you are requesting access, please enter a brief justification below, to be sent along with your request.",t("textarea",{style:{width:"100%"},children:"  "})]})]}))}function pl(e){const l=e.split(","),r=parseInt(l[0].slice(4)),s=parseInt(l[1]),a=parseInt(l[2]);return Math.floor((2.99*r+5.87*s+1.14*a)/10)}function xl(e,l){const r=e.split(","),s=l<0?0:255,a=l<0?l*-1:l,c=parseInt(r[0].slice(4)),d=parseInt(r[1]),i=parseInt(r[2]);return"rgb("+(Math.round((s-c)*a)+c)+","+(Math.round((s-d)*a)+d)+","+(Math.round((s-i)*a)+i)+")"}function bl(e,l,r){const s=e.split(","),a=l.split(","),c=parseInt(s[0].slice(4)),d=parseInt(s[1]),i=parseInt(s[2]);return"rgb("+(Math.round((parseInt(a[0].slice(4))-c)*r)+c)+","+(Math.round((parseInt(a[1])-d)*r)+d)+","+(Math.round((parseInt(a[2])-i)*r)+i)+")"}function yl(e){let l="";for(let r=0;r<e.length;r++){let s=e[r]===null?"":e[r].toString();e[r]instanceof Date&&(s=e[r].toLocaleString());let a=s.replace(/"/g,'""');a.search(/("|,|\n)/g)>=0&&(a='"'+a+'"'),r>0&&(l+=","),l+=a}return l+=`
`,l}function vl(e){let l="";for(let r=0;r<e.length;r++){let s=e[r]===null?"":e[r].toString();e[r]instanceof Date&&(s=e[r].toLocaleString());const a=/[\t\n]/g;let c=s.replace(a," ");r>0&&(l+="	"),l+=c}return l+=`
`,l}async function wl(e,l,r){r||(r="text/plain:charset-utf-8");const s=new Blob([e],{type:r}),a=document.createElement("a");a.download=l,a.href=URL.createObjectURL(s),a.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(a.href),30*1e3)}),document.body.appendChild(a),a.click(),document.body.removeChild(a)}function Nl(e){const[l,r]=ne(""),[s,a]=ne(1);function c({target:y}){r(y.value)}function d(y){a(y.target.id=="r1"?1:2)}function i(){if(e.data){let y=e.data;typeof e.data=="function"&&(y=e.data());const P=s==1?"csv":"tsv";let B=`${l}.${P}`,A="";s==1?y.forEach(x=>A+=yl(x)):y.forEach(x=>A+=vl(x)),wl(A,B,e.mimeType)}}function n(){return l.length>0}return o(Ge,_e(Fe({},e),{title:"Save text file",button:"Save",buttonAction:i,buttonEnable:n,buttonClose:"Cancel",children:[o(k,{className:"form-group pt-2 mt-2 d-flex justify-content-center flex-nowrap",children:[t(D,{xs:"5",className:"d-flex justify-content-end mr-0 pr-2",children:t(me,{className:"pt-2 float-right",children:"Please enter file name:"})}),t(D,{xs:"7",className:"ml-0 pl-0 d-flex justify-content-start",children:t(oe,{id:"fname",onChange:c,placeholder:"file name (without extension)"})})]}),o(k,{className:"form-group d-flex justify-content-center flex-nowrap pb-0",children:[t(D,{xs:"5",className:"d-flex justify-content-end",children:"File format:"}),t(D,{xs:"7",className:"d-flex pb-0",children:o(Ce,{tag:"fieldset",onChange:d,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r1",name:"fmt",checked:s==1})," .csv"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r2",name:"fmt",checked:s==2})," .tsv"]})})]})})]})]}))}function At({id:e,title:l,show:r,text:s}){return l||(l="Information"),s||(s="  text needed here "),e||(e="infoToast1"),t("div",{class:"position-fixed p-1",style:"z-index: 200; top: 2em; right: 40em;",children:o("div",{id:e,class:r?"toast":"toast hide",role:"alert","aria-live":"assertive","aria-atomic":"true","data-delay":"2000",style:"opacity:1;background-color: rgba(255,255,255,0.95);",children:[o("div",{class:"toast-header-sm",children:[t("strong",{class:"mr-auto",style:"color:#777;",children:l}),t("button",{type:"button",class:"ml-2 mb-1 mr-1 close","data-dismiss":"toast","aria-label":"Close",children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),t("div",{class:"toast-body mt-1 pt-0 d-flex flex-column justify-content-center align-content-center",style:"color:#b46",children:s})]})})}const Cl=()=>{const[e,l]=ne(!1);function r(){l(!e)}return[e,r,l]};function Rl(e){let l,r=[];const[s,a]=ne(""),[c,d]=ne(!1);function i(){d(!1)}function n(x,g){x||(x="No valid BrNum entries found."),d(!0),a(x),g||(g=5),setTimeout(()=>{d(!1)},g*1e3)}function y(x){let g=x.trim().split(/\r?\n/);if(r.length=0,g)for(let _=0;_<g.length;_++){let T=g[_].match(/\b(Br\d+)\b/g);T&&T.length&&r.push(...T)}}function P(x){const g=l.result;y(g);let _="";r.length?(_=r.join(`
`),v("#brlst").val(_),v("#brlst").prop("disabled",!0)):n()}function B(x){l=new FileReader,l.onloadend=P,l.readAsText(x)}function A(){if(r.length==0){let x=v("#brlst").val();if(x.trim().length==0)return n("List is empty!"),!1;if(y(x),r.length==0)return n(),!1}return e.onSubmit&&e.onSubmit(r),!0}return o(Ge,_e(Fe({},e),{title:"BrNum list",button:"Apply list",buttonClose:"Cancel",onSubmit:A,children:[t(k,{className:"d-flex m-0 p-0 justify-content-center align-items-center",style:"min-height:52px;",children:c&&t(_n,{id:"alInvalid",className:"mb-0",color:"danger",isOpen:c,toggle:i,style:"font-size:90%",children:s})}),t(k,{className:"p-1 d-flex justify-content-start align-items-center",children:o("label",{for:"fupload",className:"app-file-upload app-btn",children:["  ",t("input",{type:"file",id:"fupload",accept:".csv,.txt,.tsv",onChange:x=>B(x.target.files[0])})," Upload Br list"]})}),t(k,{className:"mb-4 pb-4",children:t(oe,{id:"brlst",type:"textarea",rows:"5"})})]}))}function Sl(e){const[l,r]=ne(e.brloaded|0),[s,a]=ne(!1);function c(){a(!s)}function d(){l>0?e.onBrList&&r(e.onBrList([])):a(!0)}function i(B){e.onBrList?r(e.onBrList(B)):r(B.length)}let n=l;e.brloaded&&l!=e.brloaded&&(r(l),n=l);const y=n?"subjects loaded":"No subjects loaded.";return o(k,{className:"p-1 mb-3 d-flex justify-content-start align-items-center",children:[t(we,{id:"b1",className:"btn-sm app-btn",onClick:d,children:n?"Clear BrNums":"Upload BrNums"}),"\xA0",n>0&&t("span",{class:"lg-flt",children:n}),t("span",{style:"padding:2px 2px;font-size:90%",children:y}),t(Rl,{isOpen:s,toggle:c,onSubmit:i,title:"Confirm"})]})}function jt(e){kt();const[l,r,s]=He(),[a,c]=Cl(),d=he.selXType,i=d?d-1:0;C.reg.size>0;let n=C.dset,y=cn(!0),P=d&&n.size>0;const B=[];if(y)for(let M=1;M<r.proto.length;M++)r.proto[M]>0&&B.push(G.proto[i][M]);function A(){return t(pe,{children:o(k,{className:"d-flex flex-nowrap justify-content-between pt-4",children:[t(we,{className:"btn-light btn-sm app-btn btn-download flex-nowrap ",onClick:c,children:"Download"}),t(Nl,{data:il([0,1,2]),isOpen:a,toggle:c}),t("div",{children:"\xA0\xA0\xA0\xA0\xA0"}),t(we,{className:"btn-light btn-sm app-btn flex-nowrap ",children:"Request Genotypes"})]})})}if(se(()=>{B.length>1&&v("#tsWarnProto").toast("show")}),!ft||ft.length==0)return null;const x=d?l[i].length:0,g=s.sex.slice(1).reduce((M,p)=>M+p);let _=[];d&&n.forEach(M=>{G.dsetp[i][M]===1&&_.push(G.dset[i][M])});function T(){return o(pe,{children:[t(D,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.dx.map((M,p)=>{if(p>0&&M>0)return o("tr",{children:[o("td",{align:"right",children:[" ",M," "]})," ",o("td",{align:"left",children:[G.dx[p]," "]})]},p)})})})}),t(D,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.race.map((M,p)=>{if(p>0&&M>0)return o("tr",{children:[o("td",{align:"right",children:[" ",M," "]})," ",o("td",{align:"left",children:[G.race[p]," "]})]},p)})})})}),t(D,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.sex.map((M,p)=>{if(p>0&&M>0)return o("tr",{children:[o("td",{align:"right",children:[" ",M," "]})," ",o("td",{align:"left",children:[G.sex[p]," "]})]},p)})})})})]})}function m(M,p){if(M.length!==p.length)return!1;for(let f=0;f<M.length;f++)if(M[f]!==p[f])return!1;return!0}function j(){if(s.cxDxRace.length<2)return T();const M=s.cxDxRace,p=s.cx2dx,f=s.cxDxSex,R=s.cx2s,q=s.cx2r;let Z=[],K=[],b=[],E=M.map((S,X)=>X),L=f.map((S,X)=>X);if(!m(E,L))return console.log(" !!!!!!!!!! Error: subjXTable Dx rows should be the same!"),T();let U=M[0].map((S,X)=>X),h=f[0].map((S,X)=>X);E.sort((S,X)=>p[S]-p[X]),U.sort((S,X)=>q[S]-q[X]);let w=E.map((S,X)=>M[S]);for(let S=0;S<w.length;S++)K.push(0),w[S]=U.map((X,H)=>{const W=w[S][X];return K[S]+=W,S===0&&Z.push(0),Z[H]+=W,W});let z=L.map((S,X)=>f[S]);for(let S=0;S<z.length;S++)z[S]=h.map((X,H)=>{const W=z[S][X];return S===0&&b.push(0),b[H]+=W,W});return t(D,{className:"pt-2",children:o("table",{className:"subjxtbl",children:[o("thead",{children:[o("tr",{children:[t("td",{class:"td-blank",children:"  "})," ",t("td",{class:"td-blank",children:"  "}),Z.map((S,X)=>t("th",{children:S},X)),t("td",{class:"tc-spacer",children:" "}),b.map((S,X)=>t("th",{children:S},X))]}),o("tr",{children:[t("td",{class:"td-blank",children:"  "})," ",t("td",{class:"td-blank",children:"  "}),w[0].map((S,X)=>t("th",{children:G.race[q[U[X]]]},X)),t("td",{class:"tc-spacer",children:" "}),z[0].map((S,X)=>t("th",{children:G.sex[R[h[X]]]},X))]})]}),t("tbody",{children:w.map((S,X)=>o("tr",{children:[t("th",{children:K[X]}),t("th",{children:G.dx[p[E[X]]]}),S.map((H,W)=>t("td",{children:H},W)),t("td",{class:"tc-spacer",children:" "}),z[X].map((H,W)=>t("td",{children:H},W))]},X))})]})})}const V=fe.sex[0].reduce((M,p)=>M+p),$=Le.size;return o(D,{className:"pl-0 ml-0 d-flex flex-column sel-summary text-align-center justify-content-center align-items-center",children:[!e.browse&&t(Sl,{brloaded:e.brloaded,onBrList:e.onBrList}),d==0&&!y&&!e.browse&&o("div",{style:"color: #777;font-size:95%;",children:[o("span",{children:[V," subjects in the database"]}),$!==V&&o("span",{children:[" (",$,") "]})]}),t("div",{class:"red-info-text",style:"line-height:200%;",children:y?t("span",{children:"\xA0"}):t("span",{children:"Apply a selection to see subject summaries."})}),y&&o(pe,{children:[d?o(k,{className:"pb-0 mb-0 d-flex justify-content-center",style:"font-size:1rem;border-bottom:1px solid #ddd;",children:[t("span",{style:"color:#923",children:t("b",{children:y?g:0})})," \xA0 subjects"]}):o(k,{className:"d-flex flex-nowrap align-items-center align-self-center justify-content-center",style:"font-size:1rem;border-bottom:1px solid #ddd;",children:[t("span",{class:"flex-fill",children:" Selected subjects:\xA0 "}),t("span",{style:"color:#923;padding:0 2px;padding-right:4px;",children:t("b",{children:y?g:0})})]}),t(k,{className:"flex-nowrap align-self-center pt-0 mt-0",children:j()})," "]}),t(k,{className:"flex-nowrap flex-row justify-content-center",style:{paddingTop:"1em"},children:P?o(D,{className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-nowrap align-items-center align-self-center justify-content-center",style:{fontSize:"1rem"},children:[t("span",{class:"flex-fill",children:" Selected samples: "}),o("span",{className:"sel-total",children:[" ",x||0," "]})]}),t(k,{className:"p-2 m-2",children:B.length>1&&t(At,{id:"tsWarnProto",title:"Warning",text:`Selection has samples with ${B.length} different RNAseq protocols (${B.join(", ")})`})}),o(k,{className:"d-flex flex-fill flex-nowrap justify-content-center",children:[o(D,{className:"d-flex justify-content-center",children:[t(we,{className:"btn-light btn-sm app-btn btn-download",onClick:c,children:t("b",{children:"Download"})}),_.length?t(ml,{datasets:_,isOpen:a,toggle:c}):t(gl,{isOpen:a,toggle:c})]}),t(D,{className:"d-flex justify-content-center",children:t(we,{className:"btn-light btn-sm app-btn btn-xplore",children:t("b",{children:"Explore"})})})]})]}):o(D,{children:[" ",d?t("div",{className:"mx-auto",children:t("span",{class:"red-info-text",children:" Apply a dataset selection to access samples. "})}):o(pe,{children:[" ",y&&A()," "]})]})})]})}function kl(e){let l;typeof e.value=="undefined"?l=e.type==="single"?1:[]:l=Array.isArray(e.value)?[e.value[0],e.value[1]]:[e.value],typeof e.type=="undefined"&&!Array.isArray(e.value)&&(e.type="single");const r=xe(null);function s(f,R){return typeof f=="undefined"?R:f}function a(f,R){return typeof f=="undefined"?R:f=="yes"||f==1}function c(f){return typeof f!="undefined"}function d(f,R){if(f===R)return!0;if(f==null||R==null||f.length!==R.length)return!1;for(let q=0;q<f.length;++q)if(f[q]!==R[q])return!1;return!0}const i=xe({isRange:e.type!=="single",from:parseFloat(s(e.from,0)),to:parseFloat(s(e.to,10)),step:s(e.step,1),scale_prop:e.scale,width:parseInt(s(e.width,300),10),showLabels:a(e.showLabels,!0),scaleClickable:a(e.scaleClickable,!1),snap:a(e.snap,!0),format:s(e.format,"%s"),theme:s(e.theme,""),disabled:a(e.disabled,!1),decimals:s(e.decimals,0),animate:a(e.animate,!1),value:[l[0],l[1]],mapValue:e.mapValue,mapScale:e.mapScale,lastPos:[],rebuild:!0,pointers:null,loPtr:null,hiPtr:null,psize:0,vstep:0,labels:null,lowLabel:null,highLabel:null,scale:null,bar:null,clickableBar:null,interval:0}),n=i.current,y=e.type!=="single";n.isRange!==y&&(n.isRange=y,n.rebuild=!0);const P=parseFloat(s(e.from,0));n.from!==P&&(n.from=P,n.rebuild=!0);const B=parseFloat(s(e.to,10));n.to!==B&&(n.to=B,n.rebuild=!0);const A=s(e.step,1);n.step!==A&&(n.step=A,n.rebuild=!0);const x=e.scale;d(n.scale_prop,x)||(n.scale_prop=x,n.rebuild=!0);const g=parseInt(s(e.width,300),10);n.width!==g&&(n.width=g,n.rebuild=!0);const _=a(e.showLabels,!0);_!==n.showLabels&&(n.showLabels=_,n.rebuild=!0);const T=a(e.scaleClickable,!1);T!==n.scaleClickable&&(n.scaleClickable=T,n.rebuild=!0);const m=s(e.format,"%s");m!==n.format&&(n.format=m,n.rebuild=!0);const j=a(e.snap,!0);j!==n.snap&&(n.snap=j,n.rebuild=!0);const V=s(e.theme,"");V!==n.theme&&(n.theme=V,n.rebuild=!0);const $=a(e.disabled,!1);$!==n.disabled&&(n.disabled=$,n.rebuild=!0);const M=s(e.decimals,0);M!==n.decimals&&(n.decimals=M,n.rebuild=!0),e.mapValue!==n.mapValue&&(n.mapValue=e.mapValue),n.animate=a(e.animate,!0);function p(){const f=i.current;f.clickableBar.off("click"),f.pointers.off("mousedown touchstart dragstart")}return se(()=>{const f=v(r.current);let R=n.vstep,q=n.from,Z=n.to-q,K=n.width;function b(){return n.decimals>0}function E(u){let F=Ie(u);if(b()){const J=parseFloat(F).toFixed(n.decimals);return F=parseFloat(J),[J,F]}return F=Math.round(F/n.step)*n.step,[String(F),F]}function L(u){let F=n.value[u];return b()?[parseFloat(F).toFixed(n.decimals),F]:(F=Math.round(F/n.step)*n.step,[String(F),F])}function U(u){let F=Ie(u);F=Math.round(F/n.step)*n.step,F-=n.from;const J=K/(n.interval/n.step),le=F/n.step*J;return u<=le+J/2&&u>=le-J/2?Math.round(le):-1}function h(){f.toggleClass("slider-readonly",n.disabled)}function w(u,F,J,le){const ie=typeof le=="undefined";if(!ie&&!n.showLabels)return!1;const re=u?n.highLabel:n.lowLabel;let je;const[Ee,be]=ie?E(F):L(u);if(typeof n.format=="function"){const kn=n.isRange?u?"high":"low":void 0;je=n.format(Ee,kn)}else je=n.format.replace("%s",Ee);const Pe=re.html(je).width();let Oe=Math.min(Math.max(F,0),K);return Oe-=Pe/2,n.showLabels&&z(re,{left:Oe},J&&n.animate),ie&&n.value[u]!==be?(n.value[u]=be,!0):!1}function z(u,F,J){J?(u.stop(!0),u.animate(F)):u.css(F)}function S(u,F,J,le){let ie,re=parseFloat(n.loPtr.css("left")),je=parseFloat(n.hiPtr.css("left"))||0,Ee=u?n.hiPtr:n.loPtr,be=n.psize/2;if(n.snap&&(F=U(F)),F===n.lastPos[u])return!1;n.lastPos[u]=F,u?je=Math.round(F-be):re=Math.round(F-be);const Pe=Math.round(F-be);if(z(Ee,{left:Pe},J&&n.animate),n.isRange){ie=n.isRange?re+be:0;const Oe=Math.round(je+be-ie);z(n.bar,{width:Math.abs(Oe),left:Oe>0?ie:ie+Oe},J&&n.animate)}return w(u,F,J,le)}function X(u){if(n.disabled)return;let F=!1;const J=Math.round(u.pageX-n.clickableBar.offset().left);if(!n.isRange)F=S(0,J,!0);else{const le=Math.abs(parseFloat(n.loPtr.css("left"),10)),ie=n.loPtr.width()/2,re=Math.abs(parseFloat(n.hiPtr.css("left"),10)),je=n.loPtr.width()/2,Ee=Math.abs(le-J+ie),be=Math.abs(re-J+je);let Pe;Ee==be?Pe=J<le?0:1:Pe=Ee<be?0:1,F=S(Pe,J,!0)}e.onBarClick&&typeof e.onBarClick=="function"&&e.onBarClick(n.value[0],n.value[1]),F&&W()}function H(){if(!n.isRange)return;const u=n.value[0]==n.from&&n.value[1]==n.to,F=!n.bar.hasClass("full-range");u&&F?n.bar.addClass("full-range"):!u&&!F&&n.bar.removeClass("full-range")}function W(){if(H(),e.onChange&&typeof e.onChange=="function")if(n.isRange){let u=n.value[0],F=n.value[1];n.mapValue&&(u=n.mapValue(u),F=n.mapValue(F)),e.onChange(u,F)}else{let u=n.value[0];n.mapValue&&(u=n.mapValue(u)),e.onChange(u)}}function ae(u,F,J){let le=0,ie=K;n.isRange&&(le=F?parseFloat(n.loPtr.css("left"))+n.loPtr.width()/2:0,ie=F===0?parseFloat(n.hiPtr.css("left"))+n.hiPtr.width()/2:K);const re=Math.min(Math.max(J,le),ie);S(F,re)&&W()}function Q(u){if(n.disabled||u.type==="mousedown"&&u.which!==1)return;u.stopPropagation(),u.preventDefault();const F=v(u.target);n.pointers.removeClass("last-active"),F.addClass("focused last-active");const J=F.hasClass("low")?0:1;f.find(J?"highLabel":"lowLabel").addClass("focused"),v(document).on("mousemove.rslider touchmove.rslider",{pidx:J},N),v(document).on("mouseup.rslider touchend.rslider touchcancel.rslider",{pidx:J},O)}function N(u){u.stopPropagation(),u.preventDefault(),u.originalEvent.touches&&u.originalEvent.touches.length?u=u.originalEvent.touches[0]:u.originalEvent.changedTouches&&u.originalEvent.changedTouches.length&&(u=u.originalEvent.changedTouches[0]);const F=Math.round(f.offset().left*100)/100,J=Math.round(u.clientX-F);f.trigger("change",[u.data.pidx,J])}function O(u){n.pointers.removeClass("focused").trigger("rangeslideend"),n.labels.removeClass("focused"),v(document).off(".rslider"),e.onDragEnd&&typeof e.onDragEnd=="function"&&(n.isRange?e.onDragEnd(n.value[0],n.value[1]):e.onDragEnd(n.value[0]))}function I(){n.clickableBar.on("click",X),n.pointers.on("mousedown touchstart",Q),n.pointers.on("dragstart",u=>u.preventDefault())}function Y(u){let F=!1;if(!n.isRange){F=u!==n.value[0],Ne([u]),F&&W();return}const J=Math.abs(n.value[0]-u);if(Math.abs(n.value[1]-u)>J){F=u!==n.value[0],Ne([u,n.value[1]]),F&&W();return}F=u!==n.value[1],Ne([n.value[0],u]),F&&W()}function ce(){let u=n.scale_prop||[n.from,n.to],F="";for(let le=0;le<u.length;le++){if(u[le]<n.from||u[le]>n.to)continue;const ie=Math.round(Me(u[le]));let re=u[le];n.mapScale?re=n.mapScale(re):n.mapValue&&(re=n.mapValue(re)),F+=`<span style="left: ${ie}px"><ins data-pos="${u[le]}">${re}</ins></span>`}n.scale.html().length>5&&n.scaleClickable&&v("ins",n.scale).each((le,ie)=>ie.off("click")),n.scale.html(F),v("ins",n.scale).each((le,ie)=>{const re=v(ie);n.scaleClickable?(re.on("click",()=>Y(String(re.data("pos")))),re.css({marginLeft:-re.outerWidth()/2,cursor:"pointer"})):re.css({marginLeft:-re.outerWidth()/2})})}function Me(u){return K*(u-q)/Z}function Ie(u){return u*Z/K+q}function Ne(u){c(u)||(u=[n.value[0],n.value[1]]),u[0]=Math.min(Math.max(u[0],n.from),n.to),n.isRange&&c(u[1])&&(u[1]=Math.min(Math.max(u[1],n.from),n.to),u[0]>u[1]?(n.value[0]=u[1],n.value[1]=u[0]):(n.value[0]=u[0],n.value[1]=u[1])),S(0,Math.round(Me(n.value[0])),!1,n.value[0]),n.isRange&&c(u[1])&&S(1,Math.round(Me(n.value[1])),!1,n.value[1])}let ge=n.theme;ge.length>0&&ge!="default"&&(ge=`theme-${ge}`,f.hasClass(ge)||f.addClass(ge)),n.rebuild?(f.off("change"),n.interval=n.to-n.from,n.lastPos=[],n.isRange?(c(n.value[0])||(n.value[0]=n.from+(n.to-n.from)/4),c(n.value[1])||(n.value[1]=n.value[0]+(n.to-n.from)/4)):c(n.value[0])||(n.value[0]=c(e.value)?e.value:n.value[0]=n.from+(n.to-n.from)/2),f.on("change",ae),n.pointers=v(".pointer",f),n.loPtr=n.pointers.first(),n.hiPtr=n.pointers.last(),n.labels=v(".pointer-label",f),n.lowLabel=n.labels.first(),n.highLabel=n.labels.last(),n.scale=v(".scale",f),n.bar=v(".selected-bar",f),n.clickableBar=f.find(".clickable-bar"),K=n.width,f.width(K+1),n.isRange?(n.hiPtr.show(),n.highLabel.show(),n.bar.show()):(n.hiPtr.hide(),n.highLabel.hide(),n.bar.hide()),n.psize=n.loPtr.outerWidth(),R=1/Math.pow(10,M),n.vstep=R,q=n.from,Z=n.to-q,n.showLabels?n.labels.show():n.labels.hide(),p(),I(),e.scale&&ce(),n.rebuild=!1,c(e.value)&&(n.value[0]=l[0],n.value[1]=l[1]),Ne(),H(),h()):c(e.value)&&(n.value[0]!==l[0]||n.value[1]!==l[1])&&(n.value[0]=l[0],n.value[1]=l[1],Ne(),H())}),se(()=>()=>{p()},[]),t("div",{class:"slider-range-wrap",children:o("div",{ref:r,class:"slider-container",children:[o("div",{class:"back-bar",children:[t("div",{class:"selected-bar"}),t("div",{class:"pointer low"}),t("div",{class:"pointer-label low"}),t("div",{class:"pointer high"}),t("div",{class:"pointer-label high"}),t("div",{class:"clickable-bar"})]}),t("div",{class:"scale"})]})})}function Ht(e,l){return typeof e=="undefined"?l:Number(e)}function Dl({range:e,text:l,onClick:r}){function s(a){r&&r(a,e)}return t("div",{class:"btn-age-preset",range:e,onClick:s,children:l})}const ee=[-1,120],ve=[0,10,20,30,40],rt=[ee[0],15,30,45,60,75,90,105,ee[1]],Ve=[ve[0],ve[ve.length-1]];function Vt(e){return Math.round(e*100+Number.EPSILON)/100}function Al(e){const[l,r]=ne({vmin:ee[0],vmax:ee[1],fetal:!1}),s=e.drange,[,a]=Qe(h=>h+1,0),c=xe(null),d=xe({fetalSel:[0,40],fullSel:[ee[0],ee[1]],scale:rt,mrange:ee,slState:l,currentRange:[ee[0],ee[1]],appliedRange:[ee[0],ee[1]],jqCreated:!1,internalRerender:!1,renderKey:1234,btnApply:null,inputTimeout:null}),i=d.current;function n(h){const w=i.slState.vmin!=h.vmin||i.slState.vmax!=h.vmax||i.slState.fetal!=h.fetal;if(i.slState.fetal!=h.fetal&&(h.fetal?(i.scale=ve,i.mrange=Ve):(i.scale=rt,i.mrange=ee)),i.slState=Fe({},h),w){const z=h.fetal?Vt((h.vmin-40)/52):h.vmin,S=h.fetal?Vt((h.vmax-40)/52):h.vmax;h.fetal?i.fetalSel=[h.vmin,h.vmax]:i.fullSel=[h.vmin,h.vmax],e.onChange&&e.onChange(z,S),i.currentRange[0]=z,i.currentRange[1]=S}i.internalRerender=!0,r(h)}function y(){return i.currentRange[0]!=ee[0]||i.currentRange[1]!=ee[1]}function P(){s&&(i.currentRange[0]===ee[0]&&i.currentRange[1]===ee[1]?s.length=0:(s[0]=i.currentRange[0],s[1]=i.currentRange[1])),i.appliedRange[0]=i.currentRange[0],i.appliedRange[1]=i.currentRange[1],y()?x():g(),e.onApply&&e.onApply(i.appliedRange[0],i.appliedRange[1]),a()}function B(h){i.currentRange[0]=ee[0],i.currentRange[1]=ee[1],n({vmin:ee[0],vmax:ee[1],fetal:!1}),P()}se(()=>{i.jqCreated||(i.jqCreated=!0),i.internalRerender=!1});function A(h,w){w&&j(w)}function x(){const h=v(c.current);h.find(".age-panel").collapse("hide"),h.addClass("lg-collapsed")}function g(){const h=v(c.current);h.find(".lg-title")&&(h.find(".age-panel").collapse("show"),h.removeClass("lg-collapsed"))}function _(h){v(c.current).hasClass("lg-collapsed")?g():x()}function T(h,w){h>0&&(h=Math.round(h)),w>0&&(w=Math.round(w)),n(_e(Fe({},d.current.slState),{vmin:h,vmax:w}))}function m(h){const w=h.target.checked;i.scale=w?ve:rt,i.mrange=[i.scale[0],i.scale[i.scale.length-1]];const z=w?i.fetalSel:i.fullSel;n({fetal:w,vmin:z[0],vmax:z[1]})}function j(h){const w=d.current.slState;(w.vmin!==h[0]||w.vmax!==h[1])&&(e.onChange&&e.onChange(h),n({fetal:w.fetal,vmin:h[0],vmax:h[1]}))}function V(){i.inputTimeout&&clearTimeout(i.inputTimeout),i.inputTimeout=null}function $(h,w=1200){h.inputType==="insertReplacementText"&&(w=0),V(),i.inputTimeout=setTimeout(()=>{const z=d.current.slState,[S,X]=i.mrange;let H=[z.vmin,z.vmax],W=h.target.value.trim();if(W===""||W==="-"){h.target.value=H[0],i.inputTimeout=null;return}let ae=parseFloat(W).toFixed(0);if(ae.length>0&&ae!="NaN"){let Q=parseFloat(ae);Q>X&&(Q=X),Q>H[1]&&(Q=H[1]),Q<S&&(Q=S),Q!==H[0]&&j([Q,H[1]]),Q!==parseFloat(W)&&(h.target.value=Q)}else h.target.value=H[0];i.inputTimeout=null},w)}function M(h){if(i.slState.fetal){const w=ve[ve.length-1];return h==w?"birth":h}return h}function p(h,w=1200){h.inputType==="insertReplacementText"&&(w=0),V(),i.inputTimeout=setTimeout(()=>{const z=d.current.slState;let S=[z.vmin,z.vmax];const[X,H]=i.mrange;let W=h.target.value.trim();if(W===""||W==="-"){h.target.value=S[1],i.inputTimeout=null;return}let ae=parseFloat(W).toFixed(0);if(ae.length>0&&ae!="NaN"){let Q=parseFloat(ae);Q>H&&(Q=H),Q<S[0]&&(Q=S[0]),Q<X&&(Q=X),Q!==S[1]&&j([S[0],Q]),Q!==parseFloat(W)&&(h.target.value=Q)}else h.target.value=S[1];i.inputTimeout=null},w)}function f(h){$(h,0)}function R(h){p(h,0)}function q(h){h.key.toLowerCase()==="enter"&&(h.target.id=="ivmin"?$(h,0):p(h,0),h.preventDefault())}function Z(){const h=i.appliedRange[1]<=0&&i.appliedRange[0]<=0;let w=[i.appliedRange[0],i.appliedRange[1]];h&&(w[0]=Math.round(i.appliedRange[0]*52+40),w[1]=Math.round(i.appliedRange[1]*52+40)),n({vmin:w[0],vmax:w[1],fetal:h})}if(s&&(s.length==0?i.appliedRange=[ee[0],ee[1]]:i.appliedRange=[s[0],s[1]]),!i.jqCreated||!i.internalRerender){if(s?(l.vmin=i.appliedRange[0],l.vmax=i.appliedRange[1],l.fetal=l.vmin<0&&l.vmax<=0):(l.vmin=Ht(e.vmin,e.fetal?Ve[0]:ee[0]),l.vmax=Ht(e.vmax,e.fetal?Ve[1]:ee[1]),e.fetal?l.fetal=!0:l.fetal=l.vmin<0&&l.vmax<=0),i.currentRange=[l.vmin,l.vmax],l.vmin<0&&l.vmax<=0){l.fetal=!0;let h=Math.round(l.vmin*52+40),w=Math.round(l.vmax*52+40);const z=ve[0],S=ve[ve.length-1];h<z&&(h=z),h>S&&(h=S),w<z&&(w=z),w>S&&(w=S),l.vmin=h,l.vmax=w}i.scale=l.fetal?ve:rt,i.mrange=[i.scale[0],i.scale[i.scale.length-1]],i.slState=Fe({},l),i.renderKey=String(Date.now()).substring(4)}const K=y(),b=i.currentRange[0]!=i.appliedRange[0]||i.currentRange[1]!=i.appliedRange[1],E=b&&i.appliedRange[0]!==ee[0]&&i.appliedRange[1]!==ee[1];let L=`${i.slState.vmin} - ${i.slState.vmax}`;i.slState.fetal?L=i.slState.vmin==Ve[0]&&i.slState.vmax==Ve[1]?"fetal":`fetal ${L}`:i.slState.vmin<0&&(L=`fetal - ${i.slState.vmax}`);const U=e.title||"Age range";return o("div",{class:"lg-panel",ref:c,style:{width:e.width?e.width:"14rem"},children:[o("div",{class:"lg-title d-flex align-items-center",style:"min-height:24px !important;",children:[t("span",{onClick:e.notitleclick?null:_,class:e.notitleclick?"":"lg-clickable",children:U}),o("span",{class:"float-right d-flex justify-content-center align-items-center",children:[t("span",{class:"btn-undo",onClick:Z,style:E?{display:"inline-block"}:{display:"none"},children:t("img",{class:"btn-undo-icon"})},String(Date.now()-10).substring(4)),t("span",{class:"lg-apply",onClick:P,style:{display:b?"inline":"none"},children:"Apply"},String(Date.now()).substring(4)),t("span",{className:"coll-glyph",onClick:_,children:" "})]})]})," ",o("div",{class:"collapse show age-panel",children:[o("div",{class:"age-padder d-flex justify-content-start align-items-center pt-1",children:[o("div",{class:"custom-control custom-checkbox",children:[t("input",{type:"checkbox",class:"custom-control-input",id:"swFetal",checked:i.slState.fetal,onClick:m}),o("label",{class:i.slState.fetal?"custom-control-label lb-fetal-ck":"custom-control-label lb-fetal",for:"swFetal",children:["fetal",i.slState.fetal?"":"?"," "]})]}),t("span",{class:"flex-fill",children:!i.slState.fetal&&t(Dl,{range:[16,64],onClick:A,text:"16-64"})})]}),t("div",{class:"age-padder pt-0",children:t(kl,{onChange:T,width:"180",scale:i.scale,showLabels:!0,from:i.mrange[0],to:i.mrange[1],mapScale:M,value:[i.slState.vmin,i.slState.vmax]})}),o("div",{class:"age-padder d-inline-flex align-items-center justify-content-center pl-4 pt-0",children:[t(oe,{className:"form-control-sm",id:"ivmin",type:"number",size:"5",pattern:"^-?[1-9]\\d*$",onChange:$,onBlur:f,onKeyDown:q,min:i.mrange[0],max:i.mrange[1],value:i.slState.vmin}),t("span",{class:"age-spacer",children:" .. "}),t(oe,{className:"form-control-sm",id:"ivmax",type:"number",size:"5",pattern:"^\\.-?[1-9]\\d*$",onChange:p,onBlur:R,onKeyDown:q,min:i.mrange[0],max:i.mrange[1],value:i.slState.vmax}),o("div",{class:"age-label",children:[" ",i.slState.fetal?"PCW":"years"," "]})]})]}),K&&o("div",{className:"lg-only",children:[t("span",{class:"lg-only-lb",onClick:B,children:"\u2715"}),t("span",{class:"lg-only-item",onClick:B,children:L})]})]})}function wn(e){const l=e.width||"15em",r=Se("age"),s=_t();let a=s.length?1:0;const c=e.onAgeSelection&&typeof e.onAgeSelection=="function"?e.onAgeSelection:null,[d,i]=ne(a),n=["Age bins ","Age range "];xe({created:!1});function y(x,g){g=="age-range"&&v("#tsAgeRange").toast("show")}function P(x){if(x==d)return;let g=!0;g=x?al():!0,g||(g=!0,console.log("NOTICE::::: Age selection cleared!"),c&&c(d)),i(x)}function B(){Rt("age"),c&&c(d)}function A(x,g){Ae(),c&&c(d)}return ee[0],ee[1],s.length==2,String(Date.now()).substring(4),o(k,{className:"d-flex justify-content-start pt-0 mt-0",style:{position:"relative"},children:[d?t(Al,{width:l,title:" ",drange:s,onApply:A,notitleclick:!0}):t(De,{id:"age",title:" ",width:l,ageRange:_t(),data:r,filter:ke,onApply:B,onNoClickInfo:y,notitleclick:!0,updateFilter:!0}),o(tn,{className:"p-0 m-0 age-t-dd",children:[t(nn,{className:"age-t-dtoggle v-100 m-2",nav:!0,caret:!0,children:n[d]}),t(ln,{className:"age-t-ddlst",children:n.map((x,g)=>t(an,{onClick:()=>P(g),children:x},g))})]}),t(At,{id:"tsAgeRange",text:"A custom age range was selected. Dismiss it before selecting age bins."})]})}const Nn=Ue(),Cn=Ue();function jl(){return Ye(Nn)}function Ml(){return Ye(Cn)}function Fl({children:e}){const[l,r]=ne([0,[],[],[]]);function s(a){r(a)}return t(Nn.Provider,{value:l,children:t(Cn.Provider,{value:s,children:e})})}var Bl="/dev/bdportal/assets/br_sect_100w.png";let Ze=[],Wt=null;const Ll=700,El=tl.slice(1,6),Pl="#FFF0F0",Tl="rgb(255,240,240)",vt="#ed1848";let Kt=null,gt=!1;function Rn(e,l){return e>=Ze.length-1?0:Ze[e+1][l]}function Jt(e,l,r){return l=parseInt(l,10),l>e.length-1||l<0?e:e.substring(0,l).concat(r,e.substring(l+1))}function $l(e){const[l,r,s,a]=He(),[c,d]=kt(),i=Dt();gt=dl();const n=xe({onlySt:[""],appSt:[""],appSelcol:[0],selcol:[0],selregs:[],interSects:[],btnApp:[null]}),y=n.current.onlySt,P=n.current.appSt,B=n.current.appSelcol,A=n.current.btnApp,x=n.current.selregs,g=n.current.selcol;Kt=Ml(),Wt=l;let _=0;s.reg.length>0&&(_=s.reg[0].length),se(()=>{if(gt&&de.reg.length>0){g[0]=0,x.length=0;const b=de.reg;for(let L=1;L<G.reg.length;L++)x.push(0);m(),P[0]=y[0];const E=Ol(El,b);K(),$(E),C.reg.size&&C.brXtX.size&&T()}}),se(()=>{function b(){gt||Ze.length===0||(C.reg.size==0&&(M(!0),P[0]=y[0],B[0]=0),v("#rxMatrix > tbody > tr").each((E,L)=>{v(L).find("td").each((U,h)=>{let w=Rn(U,E+1),z=v(h);z.html(w===0?"":w),Sn(z,w),U+1===g[0]&&x[E]&&q(z,E,U,1)})}),j(),p())}b()},[d]);function T(){const b=C.brXtX.values().next().value;C.reg.forEach(E=>{x[E-1]=1,q(null,E-1,b+1,1)}),P[0]=y[0],B[0]=g[0],p()}function m(){g[0]=0;for(let b=0;b<x.length;b++)x[b]=0;y[0]="";for(let b=0;b<_;b++)y[0]+="0"}function j(){if(y[0]===P[0]&&B[0]===g[0]){A[0].hide();return}A[0].show()}function V(){const b=[];for(let E=0;E<x.length;E++)x[E]>0&&b.push(E+1);sl("reg",b,g[0]),P[0]=y[0],B[0]=g[0],i("reg")}function $(b){A[0]=b.find(".lg-apply"),A[0].off("click"),A[0].on("click",function(){v(this).hide(),V()}),A[0].hide()}function M(b){if(g[0]>0){for(let E=0;E<x.length;E++)x[E]>0&&Z(null,E,g[0],1);m()}b||(p(),j())}function p(){Kt([g[0],x,Ze,Wt])}function f(b,E,L,U){if(x[E]&&g[0]===L&&b.html().trim().length!==0)return;const h=b.prop("obg");if(U)h?b.css("background-color",h):b.css("background-color","");else if(h){const w=bl(h,Tl,.1);b.css("background-color",w)}else b.css("background-color",Pl)}function R(b,E){const L=b.index(),U=b.parent().index();if(b.siblings("td").each(function(){const w=v(this),z=w.index();f(w,U,z,E)}),x[U]?it(b.siblings("th")):wt(b.siblings("th"),E),g[0]===0||g[0]===L){v("#rxMatrix td:nth-child("+(L+1)+")").each(function(){const w=v(this),z=w.parent().index();f(w,z,L,E)}),f(b,U,L,E);var h=v("#rxMatrix th:nth-child("+(L+1)+") > div > span");L===g[0]?it(h):wt(h,E)}}function q(b,E,L,U){if(b==null&&(b=v("table#rxMatrix tr").eq(E+1).find("td").eq(L-1)),b!=null){if(b.html().trim().length!==0)b.css("font-weight","bold"),b.css("color","#fff"),b.css("background-color",vt);else return;var h=b.siblings("th");it(h),x[E]=1,g[0]===0&&(it(v("#rxMatrix th:nth-child("+(L+1)+") > div > span")),g[0]=L),y[0]=Jt(y[0],E,"1"),U||(j(),p())}}function Z(b,E,L,U){if(b==null&&(b=v("table#rxMatrix tr").eq(E+1).find("td").eq(L-1)),b==null)return;b.css("font-weight","normal");const h=b.prop("obg"),w=b.prop("ofg");w?b.css("color",w):b.css("color",""),h?b.css("background-color",h):b.css("background-color",""),x[E]=0,Qt(b.siblings("th"));let z=0;for(let S=0;S<x.length;S++)if(x[S]){z=1;break}z===0&&(g[0]&&Qt(v("#rxMatrix th:nth-child("+(g[0]+1)+") > div > span")),g[0]=0),y[0]=Jt(y[0],E,"0"),U||(j(),p())}function K(){v("#rxMatrix td").on("mouseenter",function(){R(v(this),0,g[0])}).on("mouseleave",function(){R(v(this),1,g[0])}),v("#rxMatrix td").on("click",function(){const b=v(this),E=b.index(),L=b.parent().index();g[0]>0&&g[0]!==E||(x[L]?Z(b,L,E):b.html()>0&&q(b,L,E))}),v("#rxMatrix th").on("mouseenter",function(){Zt(v(this),0,g[0],x)}).on("mouseleave",function(){Zt(v(this),1,g[0],x)}),v("#rxMatrix th").on("click",function(){let b=v(this),E=b.index();if(b.hasClass("rt")){if(g[0]>0&&g[0]!==E)return;if(g[0]>0)M(!0);else{console.log(" selecting all!~~~~~~~~~~~~~~~~~~~");for(let L=0;L<x.length;L++)q(null,L,E,1)}}else{let L=b.parent().index();g[0]>0&&(x[L]?Z(null,L,g[0],1):q(null,L,g[0],1))}j(),p()})}return t(pe,{children:o("div",{className:"col mx-auto",children:[t("div",{className:"mxImgBox",children:t("img",{alt:"Regions",src:Bl})}),o("div",{className:"mxApply",children:[t("span",{className:"lg-apply",children:"Apply"})," "]}),o("table",{id:"rxMatrix",children:[t("thead",{}),t("tbody",{})]})]})})}function Il(e,l,r){let s=v("#rxMatrix > thead"),a=s.parents(".matrixWrap");v("#rxMatrix td").off(),s.empty(),s.append('<tr><th class="cr" style="width:8rem;"></th>'+v.map(e,d=>'<th class="rt"><div class="txRotate"><span>'+d+"</span></div></th>").join()+"</tr>");let c=v("#rxMatrix > tbody");return c.empty(),c.append(v.map(l,(d,i)=>'<tr><th><span data-toggle="tooltip" data-placement="left" title="'+r[i]+'">'+d+"</span></th>"+v.map(e,(n,y)=>{let P=Rn(y,i+1);return P===0&&(P=""),"<td>"+P+"</td>"}).join()+`</tr>
`).join()),v("#rxMatrix td").each(function(){let d=v(this),i=d.html();Sn(d,i)}),a}function Sn(e,l){if(l>0){let r=l/(Ll*4.1),s=xl("rgb(240,240,240)",-r),a=pl(s)<120?"#fff":"#000";e.prop("obg",s),e.css("background-color",s),e.prop("ofg",a),e.css("color",a),e.css("cursor","pointer")}else e.removeProp("obg"),e.removeProp("ofg"),e.css("cursor","default"),e.css("background-color",""),e.css("color","")}function Ol(e,l){if(l.length===0){console.log("RMatrix --- zero data length!");return}return he.rebuildRMatrix=!1,Ze=l,Il(e,G.reg.slice(1),G.regFull.slice(1))}function Zt(e,l,r,s){if(e.hasClass("rt")){if(r>0)return}else{let a=e.parent().index();if(r>0&&s[a])return}wt(e,l)}function it(e){e.hasClass("rt")?e.css("color",vt):(e.css("color","#fff"),e.css("background-color",vt))}function Qt(e){e.css("color",""),e.css("background-color","")}function wt(e,l){l?(e.css("color",""),e.css("background-color","")):e.css("color","#622")}function _l(){kt();const[e,l,r,s]=jl();let a=0,c="";const i=xe({regSelApplied:!1,showHint:!1,expType:""}).current;if(e>0){c=["RNASeq","DNAm","WGS","scRNAseq","long RNAseq"][e-1];for(let n=0;n<l.length;n++)l[n]&&a++}return a&&C.reg.size>0&&(i.regSelApplied=!0),i.showHint=a&&!i.regSelApplied,i.expType=c,se(()=>{i.showHint&&v("#regSelInfo").toast("show")}),t(k,{className:"m-0 p-0 ml-3 mr-2 trinfo justify-content-center align-items-center red-info-text",style:"width:20rem;min-height:4rem;",children:t("div",{class:"position-fixed p-1",style:"z-index: 15; top: 4em; right: 12em;",children:o("div",{id:"regSelInfo",class:"toast hide",role:"alert","aria-live":"assertive","aria-atomic":"true","data-delay":"2000",children:[o("div",{class:"toast-header-sm",children:[t("strong",{class:"mr-auto",style:"color:#777;",children:"Information"}),t("button",{type:"button",class:"ml-2 mb-1 mr-1 close","data-dismiss":"toast","aria-label":"Close",children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),o("div",{class:"toast-body mt-1 pt-0",children:["Only subjects having ",i.expType," samples in the ",t("br",{})," selected brain regions will be considered after selection is applied"]})]})})})}const zl=({tab:e,style:l})=>{const[,,,r]=He(),s=Dt();if(Qe(T=>T+1,0),se(()=>{v('[data-toggle="tooltip"]').tooltip({delay:{show:800,hide:100},trigger:"hover"}),v(".toast").toast({delay:5e3})},[]),!r)return t("h3",{children:"Loading.."});function a(){St(),s("clear")}function c(T){if(!T||T.length==0)return rn(),s("clear-brlist"),0;const m=on(T);return s("brlist"),m}function d(T){let m=T.target.checked;zt("with_seq",m),s("sequenced")}function i(T){let m=T.target.checked;zt("with_gt",m),s("genotyped")}function n(T){Rt(T),s(T)}function y(T){s(T?"age-range":"age")}const P=Se("sex"),B=Se("dx"),A=Se("race"),x=Ot("with_seq"),g=Ot("with_gt"),_=sn().size;return t("div",{class:"col-12 d-flex flex-column",children:o(Fl,{children:[o(k,{className:"pl-2 pt-0 pb-0 mt-0 d-flex flex-nowrap align-items-end justify-content-center",children:[o(D,{xs:"3",className:"colDemo ml-2",style:{height:"3.3rem"},children:[" \xA0",o("div",{class:"col d-flex justify-content-between align-self-center ckRow",children:[t("div",{class:"col-6 d-flex",children:t("div",{class:"row pl-0 d-flex justify-content-start align-self-center",children:t(we,{outline:!0,color:"danger",className:"btn-sm align-self-start",onClick:a,"data-toggle":"tooltip",title:"Clear all demographic filters",style:"line-height:80%;font-size:80%;margin-top:-3px;",children:"Clear"})})}),o("div",{class:"col-6 d-flex flex-column",children:[t("div",{class:"row mx-auto",children:o("div",{className:"ckbox-label","data-toggle":"tooltip","data-placement":"left",title:"Consider only genotyped brains",children:[t(Et,{type:"checkbox",id:"ckOnlyGenotyped",onClick:i,checked:g}),"Genotyped"]})}),t("div",{class:"row mx-auto",children:o("div",{className:"ckbox-label","data-toggle":"tooltip","data-placement":"left",title:"Only sequenced brains with at least one data type",children:[t(Et,{type:"checkbox",id:"ckOnlySeq",onClick:d,checked:x}),"Sequenced"]})})]})]})]}),t(D,{xs:"5",className:"colMatrix d-flex align-self-start",children:"  "}),t(D,{xs:"4",className:"pl-3 colSummary align-self-start",children:t(k,{className:"m-0 p-0 mr-1 pr-1 mt-1 d-flex justify-content-start",children:t(_l,{})})})]}),o(k,{className:"flex-grow-1 pt-0 mt-0 justify-content-center",children:[t(D,{xs:"3",className:"colDemo",children:o(D,{className:"d-flex flex-column col-vscroll",children:[t(k,{className:"d-flex justify-content-start",children:t(De,{id:"dx",width:"15em",height:"6.9em",data:B,filter:ke,onApply:n,updateFilter:!0})}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"sex",type:"htoggle",width:"15em",data:P,filter:ke,onApply:n,updateFilter:!0})}),t(wn,{width:"15em",onAgeSelection:y}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"race",width:"15em",height:"5.4rem",data:A,filter:ke,onApply:n,updateFilter:!0})})]})}),t(D,{xs:"5",className:"pt-0 mt-0 colMatrix align-self-start",children:t(k,{className:"mt-0 pt-0",children:t(D,{className:"col-4 matrixWrap",children:t($l,{})})})}),t(D,{xs:"4",className:"d-flex flex-fill",children:t(k,{className:"pt-0 mt-0 d-flex flex-fill flex-grow-1 justify-content-center align-items-start",children:t(jt,{brloaded:_,onBrList:c})})})]})]})})},ql=["#","BrNum","Dx","Ancestry","Sex","Age","RNAseq","DNAm","WGS"];function Xl(e,l,r){const[s,a,c,d,i,n,y,P]=e;let B=qe[0],A=0;B&&B[l]&&(A=B[l].length);let x=qe[1],g=0;x&&x[l]&&(g=x[l].length);let _=qe[2],T=0;return _&&_[l]&&(T=_[l].length),o("tr",{children:[o("td",{children:[r,"."]})," ",o("td",{children:["Br",s]}),t("td",{children:G.dx[a]}),t("td",{children:G.race[c]})," ",t("td",{children:G.sex[d]})," ",t("td",{children:i}),t("td",{children:A})," ",t("td",{children:g}),"  ",t("td",{children:T})]},r)}const Ul=e=>{xe({brd:[],sortcol:0,sortup:!1}).current,se(()=>{const s=v(".brtbl"),a=s.find("tbody tr:first").children(),c=s.find("thead tr");let d=a.map(function(){return v(this).width()}).get(),i=c.children().map(function(){return v(this).width()}).get();c.children().each((n,y)=>{v(y).width(Math.max(d[n],i[n]))}),a.each((n,y)=>{v(y).width(Math.max(d[n],i[n]))})});const r=[];return Le.forEach(s=>{const a=Re[s];r.push([a,s])}),o("table",{class:"tbl tbldsets brtbl",children:[t("thead",{children:t("tr",{children:ql.map((s,a)=>o("td",{children:["  ",s]},a))},"t0")}),t("tbody",{children:r.map((s,a)=>{const[c,d]=s;return Xl(c,d,a+1)})})]})},Gl=()=>{const[e,l]=ne(0);return cn(!0)?o("div",{class:"col-12 d-flex flex-column",children:[t(k,{className:"pt-1",children:"\xA0"}),o(k,{className:"flex-grow-1 pt-0 mt-0 mr-0 pr-0 justify-content-center",children:[t(D,{xs:"7",className:"d-flex mr-0 pr-0",children:t(D,{className:"d-flex align-items-start justify-content-end",children:t(Ul,{tnum:e})})}),t(D,{xs:"5",className:"d-flex align-items-start",children:t(k,{className:"pl-0 pr-0 pt-0 mt-0 d-flex flex-fill justify-content-start align-items-start",children:t(jt,{browse:!0})})})]})]}):t("div",{class:"col-12 d-flex flex-column",children:t(k,{className:"pt-3 d-flex flex-nowrap flex-row align-items-center justify-content-center",children:t(D,{children:t("div",{style:"color:#d23;line-height:200%;font-size:100%;",children:o("span",{children:["Please make a selection in the ",t("b",{children:"Select"})," tab"]})})})})})},Yt=({params:e})=>{let l=e.tab;l!=="browse"&&(l="matrix");const[,,,r]=He();return r?(dn(0),l==="matrix"?t(zl,{}):t(Gl,{})):t("h3",{children:"Loading.."})};const Hl=({style:e})=>{const[,,,l]=He(),r=Dt();if(Qe(m=>m+1,0),se(()=>{v('[data-toggle="tooltip"]').tooltip({delay:{show:800,hide:100},trigger:"hover"}),v(".toast").toast({delay:4e3})},[]),se(()=>{s()}),!l)return t("h3",{children:"Loading.."});function s(){const m=v("#dset-info-content");m.html(""),m.hide()}function a(){s(),St(),r("clear")}function c(m){s(),Rt(m),r(m)}function d(m){r(m?"age-range":"age")}function i(m){if(!m||m.length==0)return s(),rn(),r("clear-brlist"),0;const j=on(m);return r("brlist"),j}function n(m){let j=m.trim().split(/\|/);j[2]&&(j[2].length<3?j[2]="":j[2]=`<i>${j[2]}</i>`);for(let V=3;V<j.length;V++){let $=j[V].split(/:/);if($&&$.length>1)switch($[0]=$[0].toLowerCase(),$[0]){case"doi":$[1]=`<a href="https://doi.org/${$[1]}" target="_blank">DOI</a>`,j[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${$[1]}`;break;case"pmid":$[1]=`<a href="https://pubmed.ncbi.nlm.nih.gov/${$[1]}" target="_blank">PMID</a>`,j[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${$[1]}`;break;case"https":$[1]=`<a href="https:${$[1]}" target="_blank">url</a>`,j[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${$[1]}`;break}}return`<b>${j[1]}</b><br/>${j[0]},&nbsp;${j[2]}`}function y(m,j,V){let $=nl(0,m);const M=v("#dset-info-content");if(V&&V.length>1){v("#dsMultiWarn").toast("show");return}if($&&$.length>0){const p=n($);M.html(p),M.show()}else M.html(""),M.hide()}const P=Se("sex"),B=Se("dx"),A=Se("race"),x=Se("proto"),g=Se("dset"),_=Se("reg"),T=sn().size;return o("div",{class:"col-12 d-flex flex-nowrap flex-column",children:[o(k,{className:"pt-0 mt-0 justify-content-center flex-nowrap",children:[t(D,{xs:"3",className:"d-flex pl-1 ml-1 colDemo justify-content-start",children:t(we,{outline:!0,color:"danger",className:"mt-0 btn-sm align-self-center",onClick:a,"data-toggle":"tooltip",title:"Clear all selection filters",style:"line-height:80%;font-size:80%;margin-top:6px;",children:"Clear"})}),t(D,{className:"pl-0 pt-0 mt-1 align-self-start",style:"max-width:26rem;min-width:26rem;",children:t("div",{id:"dset-info",children:t("div",{id:"dset-info-content",children:" "})})}),t(D,{xs:"4",className:"d-flex flex-fill",style:"z-index:-1;"})]}),o(k,{className:"flex-grow-1 pt-0 mt-0 justify-content-center flex-nowrap",children:[t(D,{xs:"3",className:"colDemo",children:o(D,{className:"d-flex flex-column col-vscroll",children:[t(k,{className:"d-flex justify-content-start",children:t(De,{id:"dx",width:"15em",height:"6.9em",data:B,filter:ke,onApply:c,updateFilter:!0})}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"sex",type:"htoggle",width:"15em",data:P,filter:ke,onApply:c,updateFilter:!0})}),t(wn,{width:"15em",onAgeSelection:d}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"race",width:"15em",height:"5.4rem",data:A,filter:ke,onApply:c,updateFilter:!0})})]})}),t(D,{className:"pt-0 mt-0 align-self-start",style:"max-width:26rem",children:t(k,{className:"mt-0 pt-0",children:o(D,{children:[t(k,{children:t(De,{id:"dset",height:"11em",width:"25em",type:"faketoggle",nocollapse:!0,class:"fl-shad lg-sq",data:g,filter:ke,onApply:c,updateFilter:!0,onClickItem:y})}),o(k,{className:"d-flex justify-content-start flex-nowrap",children:[t(D,{className:"p-0 m-0",style:"max-width:15.2em;",children:t(De,{id:"reg",width:"14rem",height:"8.1rem",data:_,filter:ke,onApply:c,updateFilter:!0,sort:!0})}),t(D,{className:"p-0 m-0",children:t(De,{id:"proto",type:"toggle",nobars:!0,width:"10.4em",data:x,filter:ke,onApply:c,updateFilter:!0})})]})]})})}),t(D,{xs:"4",className:"d-flex flex-fill",children:t(k,{className:"pt-0 mt-0 d-flex flex-fill flex-grow-1 justify-content-center align-items-start",children:t(jt,{brloaded:T,onBrList:i})})}),t(At,{id:"dsMultiWarn",title:"Warning",text:"Batch effect should be considered when selecting samples from multiple datasets."})]})]})};function Vl(e){return se(()=>{console.log(" --- ExpAgePlots creation time --");const l=document.createElement("script");l.src=et+"json_plotly_ageplot.js",l.async=!0,document.body.appendChild(l)},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(D,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3",children:[t(D,{xs:"2",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:t(me,{children:"Genes to plot:"})}),t(D,{xs:"6",className:"d-flex justify-content-start align-content-center",children:t(oe,{value:"GRIN2A,GRIN2B,SP4",disabled:!0})})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}function Wl(e){return se(()=>{console.log(" --- ExpBoxPlots creation time --");const l=document.createElement("script");l.src=et+"json_plotly_boxplots.js",l.async=!0,document.body.appendChild(l)},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(D,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3 pl-0",children:[t(D,{xs:"5",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:o(me,{children:["Control vs SCZD for gene ",t("b",{children:"GPR52"})," across datasets: "]})}),t(D,{xs:"6",className:"d-flex justify-content-start align-content-center",children:t(oe,{value:"Caudate, DentateGyrys, DLPFC.polyA, DLPFC, Habenula, mPFC",disabled:!0})})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}const Kl=({selData:e,style:l})=>{const[r,s]=ne(1);function a(c){s(Number(c.target.id))}return t("div",{class:"col-12 d-flex flex-nowrap flex-column",children:o(k,{className:"flex-grow-1 pt-1 mt-1 justify-content-start",children:[t(D,{xs:"1",className:"d-flex p-0 m-0 colExpNav justify-content-start",children:o(Nt,{vertical:!0,tabs:!0,children:[t(Be,{children:t(ze,{className:"app-navlnk",id:"1",active:r==1,onClick:a,href:"#",children:"Gene Age Plots"})}),t(Be,{children:t(ze,{className:"app-navlnk",id:"2",active:r==2,onClick:a,href:"#",children:"Gene boxplots"})}),t(Be,{children:t(ze,{className:"app-navlnk",children:"more to come.."})})]})}),t(D,{xs:"10",className:"d-flex flex-fill",children:r==1?t(Vl,{}):t(Wl,{})})]})})};function Jl(e){const[l,r]=ne([]),s=async c=>{const d=await fetch(c,{mode:"cors"});return d.headers.get("Content-Type"),await d.text()};function a(){return l.length==0?null:o("table",{class:"tbl tbldsets bregtbl",children:[t("thead",{children:t("tr",{children:l[0].map((c,d)=>t("th",{children:c},d))})}),t("tbody",{children:l.slice(1).map((c,d)=>t("tr",{children:c.map((i,n)=>t("td",{children:i==0&&n>=5?"-":i},n))},d))})]})}return se(()=>{function c(d){const n=d.trim().split(/[\n\r]+/).map(y=>{let P=y.split(/,/);return P.splice(12,1),P.splice(5,1),P});return console.log(" -- parsed drows len",n.length),n}console.log(" --- BrRegSeq creation time --"),s(et+"br_reg_crosstab.csv").then(d=>{console.log("..fetching table data"),r(c(d))}).catch(d=>console.log(d))},[]),se(()=>{}),console.log("~~~~~~~~~~~~ Rendering with rows len:",l.length),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(D,{xs:"12",className:"d-flex flex-column",children:[t(k,{className:"d-flex flex-row justify-content-start p-0",children:t(D,{xs:"6",className:"d-flex justify-content-start align-content-start pt-2 pr-0",children:t(me,{children:"Per Brain RNA-seq sample count by region"})})}),t(k,{className:"fixbregtbl",children:t(D,{children:a()})})]})})})}function Zl(e){return se(()=>{console.log(" --- ExpBoxPlots creation time --")},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(D,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3 pl-0",children:[t(D,{xs:"5",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:t(me,{children:"Dataset demographics and region report "})}),t(D,{xs:"6",className:"d-flex justify-content-start align-content-center"})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}const Ql=({style:e})=>{const[l,r]=ne(1);function s(a){r(Number(a.target.id))}return t("div",{class:"col-12 d-flex flex-nowrap flex-column",children:o(k,{className:"flex-grow-1 pt-1 mt-1 justify-content-start",children:[t(D,{xs:"1",className:"d-flex p-0 m-0 colExpNav justify-content-start",children:o(Nt,{vertical:!0,tabs:!0,children:[t(Be,{children:t(ze,{className:"app-navlnk",id:"1",active:l==1,onClick:s,href:"#",children:"Brain Region Reports"})}),t(Be,{children:t(ze,{className:"app-navlnk",id:"2",active:l==2,onClick:s,href:"#",children:"Dataset reports"})}),t(Be,{children:t(ze,{className:"app-navlnk",children:"more to come.."})})]})}),t(D,{xs:"10",className:"d-flex flex-fill",children:l==1?t(Jl,{}):t(Zl,{})})]})})},Yl=({params:e})=>{let l=e.tab;l!=="exp"&&l!=="rep"&&(l="sel");const[,,,r]=He();return r?(dn(1),l==="sel"?t(Hl,{}):l=="exp"?t(Kl,{}):t(Ql,{})):t("h3",{children:"Loading.."})};const ea=({tab:e})=>o(D,{children:[t(k,{children:t("h1",{children:"Long RNA-seq Data"})}),t(k,{children:t("p",{children:"Query and explore available long read RNA-seq data."})})]});const ta=({tab:e})=>o(D,{children:[t(k,{children:t("h1",{children:"DNA Methylation data"})}),t(k,{children:t("p",{children:"This is the page to explore DNA Methylation data."})})]});function na(){const[e,l]=Zn();let[r,s]=Qn(e);s||(s="");function a(i,n){l(i)}function c(){switch(r){case"brsel":return t(Yt,{params:{tab:`${s}`}});case"rna":return t(Yl,{params:{tab:`${s}`}});case"dnam":return t(ta,{});case"lrna":return t(ea,{})}return t(Yt,{params:{tab:{tab:s}}})}const d=c();return o(pe,{children:[t(el,{page:r,tab:s,menuClick:a}),t(en,{fluid:!0,className:"content d-flex h-100",children:t(fl,{children:t(cl,{children:d})})})]})}zn(t(na,{}),document.getElementById("app"));
