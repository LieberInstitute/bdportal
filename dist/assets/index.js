var An=Object.defineProperty,jn=Object.defineProperties;var Mn=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Bt=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var Ft=(e,l,r)=>l in e?An(e,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[l]=r,Fe=(e,l)=>{for(var r in l||(l={}))Bt.call(l,r)&&Ft(e,r,l[r]);if(tt)for(var r of tt(l))Lt.call(l,r)&&Ft(e,r,l[r]);return e},_e=(e,l)=>jn(e,Mn(l));var Et=(e,l)=>{var r={};for(var s in e)Bt.call(e,s)&&l.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&tt)for(var s of tt(e))l.indexOf(s)<0&&Lt.call(e,s)&&(r[s]=e[s]);return r};import{j as Fn,a as Bn,F as Ln,y as se,$ as v,M as En,b as Pn,c as Tn,C as en,d as Ce,e as $n,R as k,B as we,p as Qe,s as xe,f as S,I as oe,l as le,N as Ct,U as tn,D as nn,g as ln,h as an,i as Be,k as In,m as Ue,n as Ye,o as On,q as _n,L as me,A as zn,r as Pt,t as ze,S as qn}from"./vendor.js";const Xn=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerpolicy&&(d.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?d.credentials="include":a.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(a){if(a.ep)return;a.ep=!0;const d=r(a);fetch(a.href,d)}};Xn();const et="/dev/bdportal/";var Un="/dev/bdportal/assets/logo.svg",Gn="/dev/bdportal/assets/bands.png",Hn="/dev/bdportal/assets/bands_r.png",Vn="/dev/bdportal/assets/brain_encircled.svg";const t=Fn,o=Bn,pe=Ln;function Ge(e){if(!(e.toggle&&typeof e.toggle=="function"))throw new Error("DlgModal: props.toggle function must be provided !");const l=e.title?e.title:" ",r=e.buttonClose?e.buttonClose:"Close";e.buttonEnable||(e.buttonEnable=()=>!0);async function s(a){let d=!0;a.preventDefault(),e.onSubmit&&typeof e.onSubmit=="function"&&(d=await e.onSubmit(a)),d&&e.toggle()}return se(()=>{const a=v(".modal-body").find("input[type='text']:enabled:visible:first");a&&a.focus()}),o(En,{focus:!0,fade:!1,backdrop:"static",isOpen:e.isOpen,toggle:e.toggle,children:[o("div",{className:"modal-header app-bg pt-1 mt-0",style:"height:32px;",children:[t("h5",{className:"modal-title",style:"line-height:120%;",children:l}),t("div",{type:"button",tabindex:"-1",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:e.toggle,children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),o(Pn,{onSubmit:s,children:[t(Tn,{className:"app-bg",children:t(en,{fluid:!0,children:t(Ce,{children:e.children})})}),t($n,{className:"justify-content-center app-bg",children:o(k,{className:"d-flex w-75 justify-content-around",children:[e.button&&t(we,{type:"submit",className:"app-btn",disabled:!e.buttonEnable(),onClick:a=>{e.buttonAction&&e.buttonAction(a)},children:e.button}),t(we,{color:"secondary rounded-0",onClick:e.toggle,children:r})]})})]})]})}function Wn(e){const[,l]=Qe(m=>m+1,0),s=xe({wasSubmitted:!1,wasInvalid:!1,uname_fld:"",prevUser:""}).current,a=e.button?e.button:"Log in",d=e.checkLogin?e.checkLogin:()=>!0;function c({target:m}){const O=s.uname_fld.length;s.uname_fld=m.value.trim();const E=s.uname_fld.length;let p=0;(O===0&&E>0||O>0&&E===0)&&p++,s.wasInvalid&&(s.wasInvalid=!1,p++),p&&l()}function i({target:m}){s.wasInvalid&&(s.wasInvalid=!1,v(m).parents().find("#invalid").hide())}function n(m){if(m.key.toLowerCase()==="enter"){const O=m.target.form,E=[...O].indexOf(m.target);O.elements[E+1].focus(),m.preventDefault()}}function b(){return s.uname_fld.length>0}function L(m){if(m){v("#login-spinner").addClass("spinner-border");const O=v(".modal-content").find(":button");O&&O.prop("disabled",!0)}else{v("#login-spinner").removeClass("spinner-border");const O=v(".modal-content").find(":button");O&&O.prop("disabled",!1)}}async function F(m){s.wasSubmitted=!0;const O=m.target.username.value.trim(),E=m.target.password.value;L(!0);const p=await d(O,E);return L(!1),p?(s.wasInvalid=!1,!0):(s.prevUser=O,s.wasInvalid=!0,l(),!1)}function D(m){s.wasInvalid=!1,s.uname_fld="",e.toggle(m)}se(()=>{s.wasInvalid&&v(".modal-body").find("#invalid").show()});const x=e.isOpen||s.wasSubmitted&&s.wasInvalid;return s.wasSubmitted=!1,o(Ge,{title:e.title,isOpen:x,toggle:D,onSubmit:F,button:a,buttonEnable:b,invalid:s.wasInvalid,children:[o(k,{className:"d-flex form-group align-items-center justify-content-center",style:"height:1.4em;",children:[t("span",{children:"\xA0"}),s.wasInvalid&&t("span",{id:"invalid",style:"color:red",children:"Invalid login !"}),t("div",{id:"login-spinner",className:"text-danger",role:"status",children:"\xA0"}),t("span",{children:"\xA0"})]}),o(k,{className:"d-flex form-group align-items-center",children:[t(S,{xs:"4",className:"d-flex justify-content-end",children:t("span",{children:"Username: "})}),t(S,{xs:"6",className:"d-flex justify-content-start p-2",children:t(oe,{type:"text",name:"username",onChange:c,onKeyDown:n})})]}),o(k,{className:"d-flex form-group align-items-center",children:[t(S,{xs:"4",className:"d-flex justify-content-end",children:t("span",{children:"Password: "})}),t(S,{xs:"6",className:"d-flex justify-content-start p-2",children:t(oe,{type:"password",name:"password",onChange:i})})]}),t(k,{className:"w-100 d-flex align-items-center",style:"height:1.4em;"})]})}function Kn(e){const l=e.prompt?e.prompt:"Are you sure?",r=e.title?e.title:"Confirm",s=e.button?e.button:"Yes",a=e.buttonClose?e.buttonClose:"No";function d(c){return e.onConfirm&&e.onConfirm(c),!0}return o(Ge,{title:r,isOpen:e.isOpen,toggle:e.toggle,onSubmit:d,button:s,buttonClose:a,children:[t(k,{className:"p-1 d-flex form-group align-items-center justify-content-center",children:t("span",{style:"font-size:120%; font-weight:800;",children:l})}),t(k,{className:"w-100 d-flex align-items-center"})]})}const Je={brsel:[1,"Brain Matrix",["matrix","Select"],["browse","Browse"]],rna:[2,"bulk RNAseq",["sel","Select"],["exp","Explore"],["rep","Reports"]],dnam:[3,"DNA methylation"],lrna:[4,"long RNAseq"],default:"brsel"},ot=[];function Jn(){ot.length||(Object.keys(Je).forEach(e=>{if(e!=="default"){const l=Je[e];ot.push([e,...l])}}),ot.sort((e,l)=>e[1]-l[1]))}function mt(){return window.location.hash.replace("#","")||"/"}function Zn(e){console.log("~~~~ asked to navigate to:",e),window.location.hash=e}function Qn(){const[e,l]=le(mt());return se(()=>{const r=()=>l(mt());return window.addEventListener("hashchange",r),()=>window.removeEventListener("hashchange",r)},[]),[e,Zn]}function Yn(){return sn(mt())}function sn(e){if(!e)return[Je.default];const l=[];let r=e;for(;r.charAt(0)=="/";)r=r.substring(1);if(r.length==0)return l[0]=Je.default,l;for(r=r.replace("//","/");r.length&&r.charAt(r.length-1)=="/";)r=r.substring(0,r.length-1);return r.split("/")}function el({login:e}){const[l,r]=le(!1),[s,a]=le(!1);function d(){r(!l)}function c(){a(!s)}const[i,n]=le(["","",null]);function b(){i[2]?a(!0):r(!0)}function L(){n(["","",null])}async function F(D,x){const m={username:D,password:x},O={"Access-Control-Allow-Origin":"*"};try{const E=await In.post("/auth",m,{headers:O});if(E)return n([E.data.signed_user,"x",E.data.token]),!0}catch(E){console.log(`Error : ${E}`)}return!1}return se(()=>{r(!1)},[]),o(pe,{children:[t("span",{className:"navlogin",onClick:()=>b(),children:i[2]?i[0]:"Login"}),t(Wn,{isOpen:l,toggle:d,checkLogin:F,title:"User Login"}),t(Kn,{isOpen:s,toggle:c,onConfirm:L,title:"Logout"})]})}function tl(e,l){window.location.hash=`${e}/${l}`}function nl(e,l){return`${et}#/${e}/${l}`}function ll({page:e,tab:l,menuClick:r}){Jn();function s(c,i){c!=e&&(r||typeof r!="function")&&r(c,i)}const a=Je[e];if(!a)return o("h1",{children:[" Navdata for page $",e," not found!"]});const d=a.slice(2);return!l&&d.length&&(l=d[0][0]),o(Ct,{className:"bg-light d-flex align-items-center navheader flex-nowrap",children:[t("a",{href:"http://www.libd.org",children:t("img",{alt:"logo",src:Un,style:{height:"2rem"}})}),t("span",{style:{height:"100%",padding:"0.5rem 1rem"},children:" "}),o(tn,{nav:!0,inNavbar:!0,className:"p-0 m-0 ddtsel",children:[t(nn,{className:"navdbtsel v-100 m-2",nav:!0,caret:!0,children:a[1]}),t(ln,{className:"navddlst",children:ot.map((c,i)=>t(an,{disabled:i>1,onClick:()=>s(c[0],c[1]),children:c[2]},i))})]}),t("div",{class:"navtab-box flex-nowrap",children:d.length>0&&d.map(c=>t(Be,{className:c[0]===l?"navtab selected":"navtab",id:c[0],children:t("div",{children:t("a",{href:nl(e,c[0]),children:c[1]})})},c[0]))}),o(Be,{className:"ml-auto nav-right",children:[t("img",{alt:"bands",src:Gn,className:"navimgbands"}),t("span",{className:"navtitle",children:"LIBData Portal"}),t("img",{alt:"bands_r",src:Hn,className:"navimgbands"}),t(el,{}),t("img",{alt:"brainlogo",src:Vn,style:{height:"2rem",paddingRight:"0.5rem"}})]})]})}const Xe=[],al=["Brain Matrix","bulk RNAseq","DNA methylation","WGS","scRNAseq","long RNAseq","microRNA"],he={selXType:0,prevSelXType:-1,dataLoaded:!1,rebuildRMatrix:!0},Rt=65,U={reg:["reg"],regFull:["regname"],dx:["dx"],dxFull:["dxname"],dset:[],dsetp:[],dsetRef:[],proto:[[1,"PolyA","Ribo-Zero HMR","Ribo-Zero Gold"],[2,"450k","WGBS"],[3,"WGS"]],race:["race"],sex:["sex"],age:["age","fetal","0-15","16-64","65+"],ageRanges:[[0],[.01,15.99],[16,64.99],[Rt]]};function sl(e,l){return U.dsetRef[e][l]}const Tt=["reg"],$t=["dx"],ut=[],Re=[],pt=[{}],We=[],ft=[],ht=new Set,ct=new Set,qe=[],$e=[],ye={reg:[],dx:[],race:[],sex:[],age:[],dset:[],proto:[]},fe={reg:[],dx:[],race:[],sex:[],age:[]},ue={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],proto:["proto"],dset:["dset"]},ne={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],dx2cx:{},cx2dx:{},s2cx:{},r2cx:{},cx2s:{},cx2r:{},cxDxSex:[],cxDxRace:[],Brains:new Set},Le=ne.Brains,de={reg:[],dx:["dx"],race:["race"],age:["age"],sex:["sex"],proto:["proto"],dset:["dset"]},C={reg:new Set,dx:new Set,proto:new Set,dset:new Set,age:new Set,ageRange:[],race:new Set,sex:new Set,brSet:new Set,brXtX:new Set,with_seq:!1,with_gt:!1},It=U.ageRanges;function rn(){return C.brSet}function on(){C.brSet.clear(),Ae()}function cn(e){if(e.length==0)return 0;const l=[];for(let r=0;r<e.length;r++){let s=e[r],a=parseInt(s.replace("Br",""));a>0&&(a=pt[0][a]),a&&l.push(a)}if(l.length==0)return 0;kt(!0);for(let r=0;r<l.length;r++)C.brSet.add(l[r]);return Ae(),l.length}function Te(e){if(e=Math.floor(e*10)/10,e<0)return 1;if(e===0)return 2;let l=It.length;if(e>=Rt)return l;--l;for(let r=1;r<l;++r){let s=It[r];if(e>=s[0]&&e<=s[1])return r+1}return 0}const Ke=(e,l)=>{l||(l="[updateCounts]"),console.log(`${l} WARNING: could not get an Age range index from age ${e}"`)};function rl(e){const l=e.dtypes.length;if(!l){console.log("FATAL ERROR: numDataTypes is zero!!!");return}Xe.length=0,e.dtypes.forEach(p=>{Xe.push(p)}),console.log("[loadData] loading data.."),["sex","race"].forEach(p=>{let A=U[p];A.length=0,A.push(p),Array.prototype.push.apply(A,e[p])});const r=U.race;for(let p=1;p<r.length;p++)r[p]=="Multi-Racial"?r[p]="Multi":r[p]=="Native American"&&(r[p]="NA");Tt.length=1,$t.length=1,["dx","reg"].forEach(p=>{let A=U[p],V=`${p}Full`,P=U[V];A.length=0,A.push(p),P.length=0,P.push(V);let H=e[p],g=null,f=null;if(p==="reg"){f=Tt,g=ye.reg,g.length=0;for(let w=0;w<=l;w++)g.push([w])}else{f=$t,g=fe.dx,g.length=0;for(let w=0;w<=l;w++)g.push([w]);H.forEach(()=>g[0].push(0))}H.forEach(w=>{if(A.length!==w[0]&&console.log(`Error: index mismatch loading ${p} data`),A.push(w[1]),P.push(w[2]),f.push(w[3]),g)for(let q=1;q<=l;q++)g[q].push(w[3+q])})});const s=U.dset,a=U.dsetp,d=U.dsetRef;s.length=0,a.length=0,d.length=0;let c=e.datasets;c.length!==l&&console.log("[loadData] Error: allData.dset len ",c.length," not ",l),ut.length=0;const i=ye.dset;i.length=0,i.push([0]);const n=U.proto,b=ye.proto;b.length=0,b.push([0]);for(let p=1;p<=l;p++){s.push([p]),a.push([p]),d.push([p]),ut.push([p]);const A=p-1;i[p]=[p],c[A].forEach(P=>{s[A].push(P[1]),i[p].push(P[4]),a[A].push(P[2]+1),d[A].push(P[5]),ut[A].push(P[3])}),b[p]=[p];let V=n[A].length;for(;--V;)b[p].push(0)}Re.length=0,Re.push([]),pt.length=0,["dx","reg","race","sex","age"].forEach(p=>{let A=U[p].length;(p==="reg"?[fe[p]]:p==="dx"?[ye[p]]:[fe[p],ye[p]]).forEach(P=>{if(P){P.length=0;for(let H=0;H<=l;H++){let g=A;for(P[H]=[],P[H].length=A,P[H][0]=H;--g;)P[H][g]=0}}})});const L=fe.dx[0],F=fe.age[0],D=fe.race[0],x=fe.sex[0],m={};pt.push(m),ct.clear(),e.brains.forEach(p=>{const[A,V,P,H,g,f,w,q,Q]=p;if(Re.length!==A)throw new Error(`[loadData] Error: brain index ${A} mismatch (${Re.length})`);if(ct.add(A),Re.push([V,P,H,g,f,w,q,Q]),m[V]=A,!Q){let W=Te(f);W===0?Ke(f):F[W]++,L[P]++,x[g]++,D[H]++}});for(let p=0;p<We.length;p++)We[p].length=0;We.length=0,ft.length=0,qe.length=0,$e.length=0;const O=fe.reg[0],E=[];return ht.clear(),e.sdata.forEach((p,A)=>{$e.push([]),We.push(p);const V={};qe.push(V);const P=[],H=[],g=A+1,f=ye.dx[g],w=ye.race[g],q=ye.sex[g],Q=ye.age[g],W=ye.proto[g],y=fe.dx[g],T=fe.race[g],B=fe.sex[g],G=fe.age[g],h=fe.reg[g];let R={},_=0;p.forEach((X,z)=>{const[j,K,,J,Y]=X;P[K]=j;let N=V[j];N||(N=[],V[j]=N),N.push(z),W[Y]++;const[,I,$,ee,ce,Me,Ie,Ne]=Re[j];if(!Ne){let ge=Te(ce);f[I]++,w[$]++,q[ee]++,Q[ge]++,ht.has(j)||(ht.add(j),ct.delete(j)),R[j]||(_++,R[j]=1,y[I]++,T[$]++,B[ee]++,G[ge]++);const u=`${j}_${J}`;H[u]||(H[u]=1,h[J]++),E[u]||(E[u]=1,O[J]++)}}),ft.push([p.length,_])}),e.sdata=[],e=null,he.prevSelXType=-1,Ae(),he.dataLoaded=!0,[$e,ue,ne,!0]}function Se(e){const l=he.selXType;if(!he.dataLoaded)return[];const r=[],s=e==="dset"||e==="proto";if(l===0&&s)throw new Error(`getFilterData(${e}) should NOT be called with 0 selXType`);const a=s?U[e][l-1]:U[e];if(!a||a.length<2)throw new Error(`[getFilterData]: no names data found for filter name "${e}" (selXType=${l})`);const d=e==="reg",c=d||e==="dx"?U[`${e}Full`]:new Array(a.length).fill("");let i=null,n=null;i=l?ye[e][l]:fe[e][0],n=d?de[e][l]:de[e];const b=e==="dset"?U.dsetp[l-1]:[];if(b.length===0&&(b.length=a.length),a.length!==n.length||n.length!==i.length)throw new Error(`[getFilterData ${e}]: fltNames(${a.length}), fltXCounts(${n.length}) and oriCounts(${i.length}) must be equal length!`);return a.forEach((L,F)=>{F&&i[F]>0&&r.push([L,n[F],b[F],F,i[F],c[F]])}),r}function ke(e){const l=C[e];if(l==null)throw new Error(`Error: cannot get filter set for "${e}"`);return l}function Ot(e){const l=C[e];if(l==null||typeof l!="boolean")throw new Error(`Cannot get filter set for "${e}"`);return l}function St(e){e==="reg"&&(console.log("WARNING: brXtX filter cleared, did you mean that? *************"),C.brXtX.clear()),Ae()}function _t(){return C.ageRange}function il(){if(C.ageRange.length==2)return!0;let e=!1;const l=C.age;if(l.size==0)return C.ageRange.length=0,!0;if(l.size==1){const r=l.values().next().value;if(r===1)C.ageRange.length=0,C.ageRange.push(-1,0);else if(r===U.ageRanges.length)C.ageRange.length=0,C.ageRange.push(Rt,120);else{const s=U.ageRanges[r-1];C.ageRange.length=0,C.ageRange.push(Math.trunc(s[0]),Math.trunc(s[1]))}}else e=!0,C.ageRange.length=0;return C.age.clear(),e&&Ae(),!e}function zt(e,l){if(!(e in C))throw new Error(`applyFilterCond(${e}) invalid property `);if(typeof C[e]!="boolean")throw new Error(`applyFilterCond(${e}) not a boolean property`);if(typeof l=="undefined")throw new Error(`applyFilterCond(${e}, ?) requires a value`);C[e]=l,Ae()}function ol(e,l,r){const s=C[e];if(s==null)throw new Error(`Error: cannot applyFilterData for "${e}"`);s.clear(),l.forEach(a=>s.add(a)),e==="reg"&&C.brXtX.clear(),r&&C.brXtX.add(r-1),Ae()}function dn(e){for(const l in C)if(!!Object.prototype.hasOwnProperty.call(C,l)){if(l==="ageRange"){if(C[l].length===2)return!0}else if(l.startsWith("with_")&&!e){if(he.selXType===0&&C[l])return!0}else if(C[l].size)return!0}return!1}function kt(e){for(const l in C)!Object.prototype.hasOwnProperty.call(C,l)||(l==="ageRange"?C[l].length=0:l.startsWith("with_")?C[l]=!1:C[l].clear());e||Ae()}const nt=1,qt=1<<1,lt=1<<2,Xt=1<<3,Ut=1<<4,at=1<<5,st=1<<6;function fn(e=0,l=!1){he.selXType=e,(l||e!=he.prevSelXType)&&Ae()}let xt,un,dt,bt,yt,vt,hn,gn,mn,pn,xn,bn;function cl(){ne.dx2cx={},ne.cx2dx={},ne.s2cx={},ne.r2cx={},ne.cx2s={},ne.cx2r={},ne.cxDxSex.length=0,ne.cxDxRace.length=0,Le.clear(),xt=ne.dx2cx,un=ne.cx2dx,dt=ne.cxDxSex,bt=ne.cxDxRace,yt=ne.s2cx,vt=ne.r2cx,hn=ne.cx2s,gn=ne.cx2r,mn=ne.dx,pn=ne.age,xn=ne.race,bn=ne.sex;const e=Xe.length;let l=U.reg.length,r=e+1,s=ne.reg;for(s.length=r;r--;){s[r]=[r],s[r].length=l;let a=l;for(;a--;)s[r][a]=0}["dx","age","sex","race"].forEach(a=>{let d=U[a].length,c=ne[a];for(c.length=d,c[0]=a;--d;)c[d]=0})}function Gt(e,l,r,s,a){if(Le.has(e))return!1;Le.add(e);let d=xt[l],c=dt.length,i=Object.keys(yt).length,n=Object.keys(vt).length;return d>=0||(xt[l]=c,un[c]=l,d=c,dt.push(Array(i).fill(0)),bt.push(Array(n).fill(0))),[[yt,hn,dt,i,r],[vt,gn,bt,n,s]].forEach(b=>{let[L,F,D,x,m]=b,O=L[m];O>=0||(L[m]=x,F[x]=m,O=x,D.forEach(E=>E.push(0))),D[d]||console.log("brix=",e,"   d=",d,"   cxDxf=",D),D[d][O]++}),mn[l]++,xn[s]++,bn[r]++,a&&pn[a]++,!0}function Ae(){const e=Xe.length,l=he.selXType;l!=he.prevSelXType&&(he.prevSelXType=l);let r=U.reg.length;[ue.reg,de.reg].forEach(g=>{let f=e+1;for(g.length=f;f--;){g[f]=[f],g[f].length=r;let w=r;for(;w--;)g[f][w]=0}}),["dx","age","sex","race"].forEach(g=>{let f=U[g].length;[ue[g],de[g]].forEach(w=>{if(w){let q=f;for(w.length=f,w[0]=g;--q;)w[q]=0}})}),cl();let s=-1;const a=l===0,d=[];$e.length=0;const c=C.ageRange.length==2?C.ageRange.slice():null;if(c&&(c[0]>=0?c[1]=Math.trunc(c[1])+.99:c[1]===0&&(c[1]=-.001)),l){s=l-1,d.push(l-1);let g=ue.dset,f=de.dset,w=U.dset[l-1].length;for(g.length=f.length=w,g[0]=f[0]="dset";--w;)g[w]=0,f[w]=0;for(g=ue.proto,f=de.proto,w=U.proto[l-1].length,g.length=f.length=w,g[0]=f[0]="proto";--w;)g[w]=0,f[w]=0}else{["reg"].forEach(w=>{let q=U[w].length;[ne[w][0],de[w][0]].forEach(W=>{if(W){let y=q;for(W.length=q,W[0]=0;--y;)W[y]=0}})});const g=C.brXtX.size;let f=0;if(g){if(g>1)throw new Error("Error: multiple intersection data types not implemented yet!");for(s=C.brXtX.values().next().value,console.log(">>>> brXtX filter:",s),f=0;f<e;f++)if(f===s){d.push(s);break}for(f=0;f<e;f++)f!==s&&d.push(f)}else for(f=0;f<e;f++)d.push(f)}Le.clear();const i=new Set,n=C.brSet,b=n.size>0,L=ue.dx,F=ue.sex,D=ue.age,x=ue.race,m=ue.dset,O=ue.proto,E=de.dx,p=de.age,A=de.race,V=de.sex,P=de.dset,H=de.proto;for(let g=0;g<d.length;g++){const f=d[g],w=We[f];if(!w||w.length==0){console.log(`[updateCounts] Error: no sample data found for data ${Xe[f]}`);continue}const q=[],Q=ue.reg[f+1],W=de.reg[f+1],y=ne.reg[f+1];$e[f]=[];const T=w.length;C.reg.values().next().value;for(let B=0;B<T;++B){const[G,h,R,_,X]=w[B];if(b&&!n.has(G)||a&&s>=0&&s!=f&&!Le.has(G))continue;const[,z,j,K,J,Y,N,I]=Re[G];if(I||C.with_seq&&!Y||C.with_gt&&!N||c&&(J<c[0]||J>c[1]))continue;let $=0,ee=0;f===s&&C.reg.size&&!C.reg.has(_)&&(ee|=qt),C.dx.size&&!C.dx.has(z)&&(ee|=nt),C.race.size&&!C.race.has(j)&&(ee|=lt),C.sex.size&&!C.sex.has(K)&&(ee|=at),l&&(C.dset.size&&!C.dset.has(R)&&(ee|=Xt),C.proto.size&&!C.proto.has(X)&&(ee|=Ut)),C.age.size&&($===0&&($=Te(J)),$===0?Ke(J):C.age.has($)||(ee|=st));let ce=!i.has(G);const Me=`${G}_${_}`,Ie=!q[Me],Ne=l||ce,ge=l||Ie;if(ee){if(ee===qt&&ge&&(W[_]++,q[Me]=1),Ne){let u=0;switch(ee){case nt:E[z]++,u|=1;break;case Xt:l&&(P[R]++,u|=1);break;case Ut:l&&(H[X]++,u|=1);break;case st:$===0&&($=Te(J)),$&&p[$]++,u|=1;break;case lt:A[j]++,u|=1;break;case at:V[K]++,u|=1;break}ce&&u&&i.add(G)}continue}Q[_]++,ge&&W[_]++,Ie&&(y[_]++,q[Me]=1),Ne&&(L[z]++,E[z]++,x[j]++,A[j]++,F[K]++,V[K]++,l&&(m[R]++,P[R]++,O[X]++,H[X]++),$===0&&($=Te(J)),$===0?Ke(J):(D[$]++,p[$]++),Gt(G,z,K,j,$)&&i.add(G)),$e[f].push([G,h,R,_,X])}}a&&s<0&&ct.forEach(g=>{const[,f,w,q,Q,W,y,T]=Re[g];if(T||C.with_seq&&!W||C.with_gt&&!y||b&&!n.has(g)||c&&(Q<c[0]||Q>c[1]))return;let B=0,G=0;if(C.dx.size&&!C.dx.has(f)&&(G|=nt),C.race.size&&!C.race.has(w)&&(G|=lt),C.sex.size&&!C.sex.has(q)&&(G|=at),C.age.size&&(B===0&&(B=Te(Q)),B===0?Ke(Q):C.age.has(B)||(G|=st)),G)switch(G){case nt:E[f]++;break;case st:B&&p[B]++;break;case lt:A[w]++;break;case at:V[q]++;break}else E[f]++,A[w]++,B===0&&(B=Te(Q)),V[q]++,B===0?Ke(Q):p[B]++,Gt(g,f,q,w,B)})}function dl(e){const l=[];let r=0;const s=["BrNum","Dx","Race","Sex","Age"];if(Array.isArray(e)){r=e.length;for(let a=0;a<r;a++)s.push(Xe[e[a]]+"_samples")}return l.push(s),Le.forEach(a=>{const[d,c,i,n,b]=Re[a],L=[`Br${d}`,U.dx[c],U.race[i],U.sex[n],b];if(r)for(let F=0;F<r;F++){let D=e[F],x=qe[D],m=0;x&&x[a]&&(m=x[a].length),L.push(m)}l.push(L)}),l}const yn=Ue(),fl=Ue();function He(){return Ye(yn)}function ul({children:e}){const[l,r]=le([$e,ue,ne,he.dataLoaded]),[s,a]=le(et+"data/multi_dta.json.gz");function d(i,n){a(i),r(n)}const c=async i=>{const n=await fetch(i,{mode:"cors"});if(n.headers.get("Content-Type")=="application/json")return JSON.parse(await n.text());let L=new Uint8Array(await n.arrayBuffer());const F=On(L),D=_n(F);return JSON.parse(D)};return se(()=>{c(s).then(i=>{console.log("fetching all sample data"),r(rl(i))}).catch(i=>console.log(i))},[s]),t(yn.Provider,{value:l,children:t(fl.Provider,{value:d,children:e})})}function hl(){const e=xe(!0);return se(()=>{e.current=!1},[]),e.current}const vn=Ue(),wn=Ue();function Dt(){const e=Ye(vn);if(e===void 0)throw new Error("useFltCtx must be used within FltCtxProvider!");return e}function At(){const e=Ye(wn);if(e===void 0)throw new Error("useFltCtxUpdate must be used within FltCtxProvider!");return e}function gl(e){const[l,r]=le([null,!1]);function s(a){console.log(`FltCtxProvider: requested update of [${l}] by "${a}"`),r(d=>[a,!d[1]])}return t(vn.Provider,{value:l,children:t(wn.Provider,{value:s,children:e.children})})}const ml={dx:"Diagnosis",age:"Age",race:"Ancestry",reg:"Brain region",sex:"Sex",dset:" Datasets ",proto:"Protocol",pub:"Public"};function pl(e,l){if(Object.keys(e).length!==Object.keys(l).length)return!1;for(let r in e)if(e[r]!==l[r])return!1;return!0}function De(e){const l=xe(null),r=xe({fltData:[],onlyStates:{},appliedStates:{},idMap:{},jqCreated:!1,btnApply:null,btnUndo:null,lHeight:0}),[,s]=Qe(N=>N+1,0),a=r.current,d=e.id,c=e.type&&e.type.indexOf("toggle")>=0,i=e.type=="ftoggle"||e.type=="faketoggle",n=typeof e.filter=="function"?e.filter(d):e.filter,b=e.type==="htoggle"||e.horiz,L=c||typeof e.nocollapse!="undefined"||typeof e.noCollapse!="undefined",F=e.data?typeof e.data=="function"?e.data(d):e.data:[["Item-one",101,2,15,1e3,"This is item-1"],["Item-two",202,1,42,2e3,"This is item-2"],["Item-three",303,2,33,3e3,"This is item-3"],["Item-four",404,2,14,4e3,"This is item-4"],["Item-five",508,2,52,5e3,"This is item-5"],["Item-six",803,1,83,3e3,"This is item-6"],["Item-seven",704,2,74,4e3,"This is item-7"],["Item-eight",608,2,62,5e3,"This is item-8"]];if(F.length>0){a.fltData.length=F.length;let N=0;F.forEach((I,$)=>{a.fltData[$]=I,I[1]>N&&(N=I[1])}),e.sort&&a.fltData.sort((I,$)=>$[1]-I[1]),a.fltData.forEach((I,$)=>{a.idMap[I[3]]=$,I[6]=Math.round(I[1]*100/N)})}n&&(a.onlyStates={},n.forEach(N=>a.onlyStates[N]=1),a.appliedStates=Object.assign({},a.onlyStates));const D=d=="age"&&e.ageRange&&e.ageRange.length===2;se(()=>{if(a.fltData.length===0)return;const N=v(l.current);if(a.jqCreated||(a.jqCreated=!0),y(N),a.btnApply=N.find(".lg-apply"),a.btnUndo=N.find(".btn-undo"),!c){const I=N.find(".lg-scroller");g(I),p(),Object.keys(a.onlyStates).length===0&&f()}});function x(N){Object.keys(a.onlyStates).length===a.fltData.length&&(a.onlyStates={}),a.appliedStates=Object.assign({},a.onlyStates),n&&e.updateFilter&&(n.clear(),Object.keys(a.onlyStates).map(Number).forEach(I=>n.add(I))),e.onApply&&e.onApply(a.onlyStates,d),!N&&s()}function m(){return Object.keys(a.appliedStates).length===0&&Object.keys(a.onlyStates).length===a.fltData.length?!1:!pl(a.appliedStates,a.onlyStates)}function O(){D&&(e.ageRange.length=0),E(!0),q()}function E(N){a.onlyStates={},!N&&(f(),s())}function p(){const N=v(l.current).find(".lg-only");N.hide();let I=N.find(".lg-only-item");if(I.off("click"),I.remove(),Object.keys(a.onlyStates).length)N.append(Object.keys(a.onlyStates).map($=>Number(a.idMap[$])).sort(($,ee)=>$-ee).map($=>`<span class="lg-only-item" key=${$} id="o${a.fltData[$][3]}">${a.fltData[$][0]}</span>`)),N.show(),I=N.find(".lg-only-item"),I.on("click",$=>{if(!$.target.id||$.target.id.length<2)return;const ee=Number($.target.id.substring(1)),ce=v($.target).closest(".lg-panel").find(".lg-item")[a.idMap[ee]];P(v(ce),ee),x()});else if(D){let[$,ee]=e.ageRange,ce="";$<0&&ee<0&&($=Math.round($*52+40),ee=Math.round(ee*52+40),ce="PCW"),N.append(`<span class="lg-only-item" key="ar" id="oar">${$} - ${ee} ${ce}</span>`),N.show(),N.find(".lg-only-item").on("click",()=>{O()})}}function A(){const N=m(),I=N&&Object.keys(a.appliedStates).length>0;N?(I?a.btnUndo.show():a.btnUndo.hide(),a.btnApply.show()):(a.btnUndo.hide(),a.btnApply.hide())}function V(N,I,$){c&!(i&&$)&&(a.onlyStates={},N.siblings().removeClass("lg-sel")),N.addClass("lg-sel"),a.onlyStates[I]=1,c||p(),A()}function P(N,I){N.removeClass("lg-sel"),delete a.onlyStates[I],c||p(),A()}function H(N){let I=v(N.target);if(N.preventDefault(),D){e.onNoClickInfo&&e.onNoClickInfo(d,"age-range");return}if(!I.hasClass("lg-item")&&(I=I.closest(".lg-item"),I.length==0))return;const $=parseInt(I[0].id);isNaN($)||(a.onlyStates[$]?P(I,$):(V(I,$,N.ctrlKey),e.onClickItem&&e.onClickItem($,d,Object.keys(a.onlyStates))))}function g(N){a.lHeight=N.get(0).scrollHeight;const I=Math.round(N.height());N.off("scroll"),T(N,a.lHeight,I),I<a.lHeight&&N.on("scroll",$=>T(v($.target),a.lHeight,I))}function f(){if(c)return;const N=v(l.current);if(N.find(".lg-title")){const $=N.find(".lg-lst");$.collapse("show"),N.removeClass("lg-collapsed"),a.lHeight<4&&g($.find(".lg-scroller"))}}function w(){if(c)return;const N=v(l.current);N.find(".lg-lst").collapse("hide"),N.addClass("lg-collapsed")}function q(){x(),!(c||L)&&(Object.keys(a.onlyStates).length>0?w():f())}function Q(){a.onlyStates=Object.assign({},a.appliedStates),s()}function W(N){v(l.current).hasClass("lg-collapsed")?f():w()}function y(N){return d==="proto"&&!b&&(N.find(".lg-item").css({"font-size":"14px"}),N.find(".lg-count").css({"font-size":"13px"})),N}function T(N,I,$){const ee=N.scrollTop(),ce=N.closest(".lg-panel").find(".lg-lst");ee>1?ce.find(".lg-topshade").show():ce.find(".lg-topshade").hide(),ee+$>=I?ce.find(".lg-bottomshade").hide():ce.find(".lg-bottomshade").show()}function B(N){return a.onlyStates[N]>0?"lg-sel":""}function G(N){return N?N===1?t("span",{class:"lg-item-lock",children:" "}):t("span",{class:"lg-item-pub",children:" "}):null}function h(){const N=!b&&typeof e.nobars=="undefined";return a.fltData.map(I=>o("li",{class:`d-flex justify-content-between lg-item ${b?"lg-item-h":""} ${B(I[3])}`,id:I[3],children:[o("span",{class:"lg-item-th",children:[G(I[2]),I[0]]}),b&&t("span",{class:"lg-spacer",children:" "}),o("span",{class:"lg-item-counts",children:[N&&o("span",{class:"lg-item-bar",children:[" ",t("span",{class:"lg-item-bar-v",style:{width:`${I[6]}%`},children:" "})," "]}),t("span",{class:`badge-primary badge-pill lg-count ${I[1]===0?"lg-count-0":""}`,children:I[1]})]})]},`${I[3]}_${String(Date.now()).substring(4)}`))}let R="lg-panel";c&&(R=`${R} lg-collapsed`),e.class&&(R=`${R} ${e.class}`);const _=!c&&(Object.keys(a.onlyStates).length>0||D),X=m(),z=X&&Object.keys(a.appliedStates).length>0,j=ml[e.id]||e.id,K=L||e.notitleclick,J=d=="dset"?"lg-title lg-dset-title":"lg-title",Y=b?"lg-toggler d-flex justify-content-around":"lg-toggler";return o("div",{class:R,ref:l,id:e.id,style:{width:e.width?e.width:"auto"},children:[o("div",{class:J,children:[t("span",{onClick:K?null:W,class:K?"lg-tcaption":"lg-tcaption lg-clickable",children:j}),o("span",{class:"float-right d-flex justify-content-center align-items-center",children:[t("span",{class:"btn-undo",onClick:Q,style:z?{display:"inline-block"}:{display:"none"},children:t("img",{class:"btn-undo-icon"})},String(Date.now()-10).substring(4)),t("span",{class:"lg-apply",onClick:q,style:X?{display:"inline"}:{display:"none"},children:"Apply"},String(Date.now()).substring(4)),!L&&t("span",{className:"coll-glyph",onClick:W,children:" "})]})]}),c?o("ul",{class:Y,onClick:H,style:i?{maxHeight:e.height?e.height:"8.6rem"}:{},children:[h()," "]}):o("ul",{class:"collapse show lg-lst",onClick:H,children:[t("div",{class:"lg-scroller",style:{maxHeight:e.height?e.height:"8.6rem"},children:h()}),t("div",{class:"lg-topshade",children:" "}),t("div",{class:"lg-bottomshade",children:" "})]}),t("div",{class:"lg-only",style:_?"display:block;":"display:none;",children:t("span",{class:"lg-only-lb",onClick:O,children:"\u2715"})},String(Date.now()).substring(4))]})}function xl(e){const l=["gene","tx","ex","jx"];le("");const[r,s]=le("dataset_"),[a,d]=le("rda"),[c,i]=le(0);function n(D){d(D.target.id=="r1"?"rda":"csv.gz")}function b(D){i(D.target.id=="n0"?0:1)}function L(D){switch(D){case"ex":D="exon";break;case"tx":D="transcript";break;case"jx":D="junction";break}return D.charAt(0).toUpperCase()+D.slice(1)}function F({target:D}){s(D.value)}return o(Ge,_e(Fe({},e),{title:"Download data",justClose:"1",width:"40em",children:[o(k,{className:"form-group d-flex justify-content-center flex-nowrap mb-0 pb-0",style:"font-size:90%;",children:[t(S,{xs:"3",className:"d-flex justify-content-end mr-0 pr-2",children:t(me,{className:"pt-2 float-right",children:"File prefix:"})}),t(S,{xs:"3",className:"ml-0 pl-0 d-flex justify-content-start",children:t(oe,{id:"fpre",onChange:F,value:r})}),o(S,{className:"ml-0 pl-0 d-flex justify-content-start ",children:["File format: \xA0",o(Ce,{tag:"fieldset",onChange:n,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r1",name:"fmt",checked:a=="rda"})," .rda (RSE)"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r2",name:"fmt",checked:a=="csv.gz"})," .csv.gz"]})})]})]})]}),t(k,{className:"d-flex justify-content-center mt-0 pt-0",style:"font-size:90%;",children:o(Ce,{tag:"fieldset",onChange:b,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"n0",name:"norm",checked:c==0})," raw counts"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"n1",name:"norm",checked:c==1})," normalized (RPKM/TPM)"]})})]})}),t(k,{className:"form-group pt-0 mt-0",style:"font-size:90%;min-height:2em;",children:c?o(pe,{children:[t(S,{xs:"4",className:"pr-0 mr-0 align-self-center",style:"max-width:9em;",children:"Restrict to genes:"}),t(S,{xs:"8",className:"pl-0 ml-0 mx-auto mr-0 pr-0",children:t(oe,{placeholder:"GRIN2A,GRIN2B,SP4"})})]}):null}),l.map((D,x)=>o(k,{className:"form-group d-flex justify-content-end",style:"font-size:90%;",children:[o(S,{xs:"4",className:"align-self-center",children:[L(D)," data"]},x+1),o(S,{xs:"4",className:"align-self-center",style:"color:#666;",children:[" ",`${r}${D}.${a}`," "]},x),o(S,{xs:"3",className:"align-self-center",children:[t(we,{className:"btn app-btn",children:"Download"})," "]},x+2)]},D))]}))}function bl(e){let s=e,{datasets:l}=s,r=Et(s,["datasets"]);return o(Ge,_e(Fe({},r),{title:"Restricted data",button:"Request",buttonClose:"Cancel",children:[o("p",{children:[t("br",{}),"The following datasets are restricted. Please enter access codes for each dataset or press the ",t("b",{children:"Request Access"})," button below to request access to them."]}),o(k,{className:"form-group",children:[t("div",{className:"col-5 align-self-center",children:" "}),t("div",{className:"col-5 align-self-center",children:" Access code  "})]}),l.map(a=>o(k,{className:"form-group",style:"font-size:90%;font-weight:bold;",children:[t(S,{xs:"5",className:"align-self-center",children:a}),o(S,{xs:"4",className:"align-self-center",children:[t(oe,{type:"text",name:"name"})," "]}),o(S,{xs:"3",className:"align-self-center",children:[t(we,{className:"btn-primary",children:"Unlock"})," "]})]},a)),o(k,{className:"form-group justify-content-left ",children:["If you are requesting access, please enter a brief justification below, to be sent along with your request.",t("textarea",{style:{width:"100%"},children:"  "})]})]}))}function yl(e){const l=e.split(","),r=parseInt(l[0].slice(4)),s=parseInt(l[1]),a=parseInt(l[2]);return Math.floor((2.99*r+5.87*s+1.14*a)/10)}function vl(e,l){const r=e.split(","),s=l<0?0:255,a=l<0?l*-1:l,d=parseInt(r[0].slice(4)),c=parseInt(r[1]),i=parseInt(r[2]);return"rgb("+(Math.round((s-d)*a)+d)+","+(Math.round((s-c)*a)+c)+","+(Math.round((s-i)*a)+i)+")"}function wl(e,l,r){const s=e.split(","),a=l.split(","),d=parseInt(s[0].slice(4)),c=parseInt(s[1]),i=parseInt(s[2]);return"rgb("+(Math.round((parseInt(a[0].slice(4))-d)*r)+d)+","+(Math.round((parseInt(a[1])-c)*r)+c)+","+(Math.round((parseInt(a[2])-i)*r)+i)+")"}function Nl(e){let l="";for(let r=0;r<e.length;r++){let s=e[r]===null?"":e[r].toString();e[r]instanceof Date&&(s=e[r].toLocaleString());let a=s.replace(/"/g,'""');a.search(/("|,|\n)/g)>=0&&(a='"'+a+'"'),r>0&&(l+=","),l+=a}return l+=`
`,l}function Cl(e){let l="";for(let r=0;r<e.length;r++){let s=e[r]===null?"":e[r].toString();e[r]instanceof Date&&(s=e[r].toLocaleString());const a=/[\t\n]/g;let d=s.replace(a," ");r>0&&(l+="	"),l+=d}return l+=`
`,l}async function Rl(e,l,r){r||(r="text/plain:charset-utf-8");const s=new Blob([e],{type:r}),a=document.createElement("a");a.download=l,a.href=URL.createObjectURL(s),a.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(a.href),30*1e3)}),document.body.appendChild(a),a.click(),document.body.removeChild(a)}function Sl(e){const[l,r]=le(""),[s,a]=le(1);function d({target:b}){r(b.value)}function c(b){a(b.target.id=="r1"?1:2)}function i(){if(e.data){let b=e.data;typeof e.data=="function"&&(b=e.data());const L=s==1?"csv":"tsv";let F=`${l}.${L}`,D="";s==1?b.forEach(x=>D+=Nl(x)):b.forEach(x=>D+=Cl(x)),Rl(D,F,e.mimeType)}}function n(){return l.length>0}return o(Ge,_e(Fe({},e),{title:"Save text file",button:"Save",buttonAction:i,buttonEnable:n,buttonClose:"Cancel",children:[o(k,{className:"form-group pt-2 mt-2 d-flex justify-content-center flex-nowrap",children:[t(S,{xs:"5",className:"d-flex justify-content-end mr-0 pr-2",children:t(me,{className:"pt-2 float-right",children:"Please enter file name:"})}),t(S,{xs:"7",className:"ml-0 pl-0 d-flex justify-content-start",children:t(oe,{id:"fname",onChange:d,placeholder:"file name (without extension)"})})]}),o(k,{className:"form-group d-flex justify-content-center flex-nowrap pb-0",children:[t(S,{xs:"5",className:"d-flex justify-content-end",children:"File format:"}),t(S,{xs:"7",className:"d-flex pb-0",children:o(Ce,{tag:"fieldset",onChange:c,children:[t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r1",name:"fmt",checked:s==1})," .csv"]})}),t(Ce,{check:!0,children:o(me,{check:!0,children:[t(oe,{type:"radio",id:"r2",name:"fmt",checked:s==2})," .tsv"]})})]})})]})]}))}function jt({id:e,title:l,show:r,text:s}){return l||(l="Information"),s||(s="  text needed here "),e||(e="infoToast1"),t("div",{class:"position-fixed p-1",style:"z-index: 200; top: 2em; right: 40em;",children:o("div",{id:e,class:r?"toast":"toast hide",role:"alert","aria-live":"assertive","aria-atomic":"true","data-delay":"2000",style:"opacity:1;background-color: rgba(255,255,255,0.95);",children:[o("div",{class:"toast-header-sm",children:[t("strong",{class:"mr-auto",style:"color:#777;",children:l}),t("button",{type:"button",class:"ml-2 mb-1 mr-1 close","data-dismiss":"toast","aria-label":"Close",children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),t("div",{class:"toast-body mt-1 pt-0 d-flex flex-column justify-content-center align-content-center",style:"color:#b46",children:s})]})})}const kl=()=>{const[e,l]=le(!1);function r(){l(!e)}return[e,r,l]};function Dl(e){let l,r=[];const[s,a]=le(""),[d,c]=le(!1);function i(){c(!1)}function n(x,m){x||(x="No valid BrNum entries found."),c(!0),a(x),m||(m=5),setTimeout(()=>{c(!1)},m*1e3)}function b(x){let m=x.trim().split(/\r?\n/);if(r.length=0,m)for(let O=0;O<m.length;O++){let E=m[O].match(/\b(Br\d+)\b/g);E&&E.length&&r.push(...E)}}function L(x){const m=l.result;b(m);let O="";r.length?(O=r.join(`
`),v("#brlst").val(O),v("#brlst").prop("disabled",!0)):n()}function F(x){l=new FileReader,l.onloadend=L,l.readAsText(x)}function D(){if(r.length==0){let x=v("#brlst").val();if(x.trim().length==0)return n("List is empty!"),!1;if(b(x),r.length==0)return n(),!1}return e.onSubmit&&e.onSubmit(r),!0}return o(Ge,_e(Fe({},e),{title:"BrNum list",button:"Apply list",buttonClose:"Cancel",onSubmit:D,children:[t(k,{className:"d-flex m-0 p-0 justify-content-center align-items-center",style:"min-height:52px;",children:d&&t(zn,{id:"alInvalid",className:"mb-0",color:"danger",isOpen:d,toggle:i,style:"font-size:90%",children:s})}),t(k,{className:"p-1 d-flex justify-content-start align-items-center",children:o("label",{for:"fupload",className:"app-file-upload app-btn",children:["  ",t("input",{type:"file",id:"fupload",accept:".csv,.txt,.tsv",onChange:x=>F(x.target.files[0])})," Upload Br list"]})}),t(k,{className:"mb-4 pb-4",children:t(oe,{id:"brlst",type:"textarea",rows:"5"})})]}))}function Al(e){const[l,r]=le(e.brloaded|0),[s,a]=le(!1);function d(){a(!s)}function c(){l>0?e.onBrList&&r(e.onBrList([])):a(!0)}function i(F){e.onBrList?r(e.onBrList(F)):r(F.length)}let n=l;e.brloaded&&l!=e.brloaded&&(r(l),n=l);const b=n?"subjects loaded":"No subjects loaded.";return o(k,{className:"p-1 mb-3 d-flex justify-content-start align-items-center",children:[t(we,{id:"b1",className:"btn-sm app-btn",onClick:c,children:n?"Clear BrNums":"Upload BrNums"}),"\xA0",n>0&&t("span",{class:"lg-flt",children:n}),t("span",{style:"padding:2px 2px;font-size:90%",children:b}),t(Dl,{isOpen:s,toggle:d,onSubmit:i,title:"Confirm"})]})}function Mt(e){Dt();const[l,r,s]=He(),[a,d]=kl(),c=he.selXType,i=c?c-1:0;C.reg.size>0;let n=C.dset,b=dn(!0),L=c&&n.size>0;const F=[];if(b)for(let g=1;g<r.proto.length;g++)r.proto[g]>0&&F.push(U.proto[i][g]);function D(){return t(pe,{children:o(k,{className:"d-flex flex-nowrap justify-content-between pt-4",children:[t(we,{className:"btn-light btn-sm app-btn btn-download flex-nowrap ",onClick:d,children:"Download"}),t(Sl,{data:dl([0,1,2]),isOpen:a,toggle:d}),t("div",{children:"\xA0\xA0\xA0\xA0\xA0"}),t(we,{className:"btn-light btn-sm app-btn flex-nowrap ",children:"Request Genotypes"})]})})}if(se(()=>{F.length>1&&v("#tsWarnProto").toast("show")}),!ft||ft.length==0)return null;const x=c?l[i].length:0,m=s.sex.slice(1).reduce((g,f)=>g+f);let O=[];c&&n.forEach(g=>{U.dsetp[i][g]===1&&O.push(U.dset[i][g])});function E(){return o(pe,{children:[t(S,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.dx.map((g,f)=>{if(f>0&&g>0)return o("tr",{children:[o("td",{align:"right",children:[" ",g," "]})," ",o("td",{align:"left",children:[U.dx[f]," "]})]},f)})})})}),t(S,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.race.map((g,f)=>{if(f>0&&g>0)return o("tr",{children:[o("td",{align:"right",children:[" ",g," "]})," ",o("td",{align:"left",children:[U.race[f]," "]})]},f)})})})}),t(S,{children:t("table",{className:"subjtbl",children:t("tbody",{children:s.sex.map((g,f)=>{if(f>0&&g>0)return o("tr",{children:[o("td",{align:"right",children:[" ",g," "]})," ",o("td",{align:"left",children:[U.sex[f]," "]})]},f)})})})})]})}function p(g,f){if(g.length!==f.length)return!1;for(let w=0;w<g.length;w++)if(g[w]!==f[w])return!1;return!0}function A(){if(s.cxDxRace.length<2)return E();const g=s.cxDxRace,f=s.cx2dx,w=s.cxDxSex,q=s.cx2s,Q=s.cx2r;let W=[],y=[],T=[],B=g.map((z,j)=>j),G=w.map((z,j)=>j);if(!p(B,G))return console.log(" !!!!!!!!!! Error: subjXTable Dx rows should be the same!"),E();let h=g[0].map((z,j)=>j),R=w[0].map((z,j)=>j);B.sort((z,j)=>f[z]-f[j]),h.sort((z,j)=>Q[z]-Q[j]);let _=B.map((z,j)=>g[z]);for(let z=0;z<_.length;z++)y.push(0),_[z]=h.map((j,K)=>{const J=_[z][j];return y[z]+=J,z===0&&W.push(0),W[K]+=J,J});let X=G.map((z,j)=>w[z]);for(let z=0;z<X.length;z++)X[z]=R.map((j,K)=>{const J=X[z][j];return z===0&&T.push(0),T[K]+=J,J});return t(S,{className:"pt-2",children:o("table",{className:"subjxtbl",children:[o("thead",{children:[o("tr",{children:[t("td",{class:"td-blank",children:"  "})," ",t("td",{class:"td-blank",children:"  "}),W.map((z,j)=>t("th",{children:z},j)),t("td",{class:"tc-spacer",children:" "}),T.map((z,j)=>t("th",{children:z},j))]}),o("tr",{children:[t("td",{class:"td-blank",children:"  "})," ",t("td",{class:"td-blank",children:"  "}),_[0].map((z,j)=>t("th",{children:U.race[Q[h[j]]]},j)),t("td",{class:"tc-spacer",children:" "}),X[0].map((z,j)=>t("th",{children:U.sex[q[R[j]]]},j))]})]}),t("tbody",{children:_.map((z,j)=>o("tr",{children:[t("th",{children:y[j]}),t("th",{children:U.dx[f[B[j]]]}),z.map((K,J)=>t("td",{children:K},J)),t("td",{class:"tc-spacer",children:" "}),X[j].map((K,J)=>t("td",{children:K},J))]},j))})]})})}function V(){Yn(),tl("rna","exp")}const P=fe.sex[0].reduce((g,f)=>g+f),H=Le.size;return o(S,{className:"pl-0 ml-0 d-flex flex-column sel-summary text-align-center justify-content-center align-items-center",children:[!e.browse&&t(Al,{brloaded:e.brloaded,onBrList:e.onBrList}),c==0&&!b&&!e.browse&&o("div",{style:"color: #777;font-size:95%;",children:[o("span",{children:[P," subjects in the database"]}),H!==P&&o("span",{children:[" (",H,") "]})]}),t("div",{class:"red-info-text",style:"line-height:200%;",children:b?t("span",{children:"\xA0"}):t("span",{children:"Apply a selection to see subject summaries."})}),b&&o(pe,{children:[c?o(k,{className:"pb-0 mb-0 d-flex justify-content-center",style:"font-size:1rem;border-bottom:1px solid #ddd;",children:[t("span",{style:"color:#923",children:t("b",{children:b?m:0})})," \xA0 subjects"]}):o(k,{className:"d-flex flex-nowrap align-items-center align-self-center justify-content-center",style:"font-size:1rem;border-bottom:1px solid #ddd;",children:[t("span",{class:"flex-fill",children:" Selected subjects:\xA0 "}),t("span",{style:"color:#923;padding:0 2px;padding-right:4px;",children:t("b",{children:b?m:0})})]}),t(k,{className:"flex-nowrap align-self-center pt-0 mt-0",children:A()})," "]}),t(k,{className:"flex-nowrap flex-row justify-content-center",style:{paddingTop:"1em"},children:L?o(S,{className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-nowrap align-items-center align-self-center justify-content-center",style:{fontSize:"1rem"},children:[t("span",{class:"flex-fill",children:" Selected samples: "}),o("span",{className:"sel-total",children:[" ",x||0," "]})]}),t(k,{className:"p-2 m-2",children:F.length>1&&t(jt,{id:"tsWarnProto",title:"Warning",text:`Selection has samples with ${F.length} different RNAseq protocols (${F.join(", ")})`})}),o(k,{className:"d-flex flex-fill flex-nowrap justify-content-center",children:[o(S,{className:"d-flex justify-content-center",children:[t(we,{className:"btn-light btn-sm app-btn btn-download",onClick:d,children:"Download"}),O.length?t(bl,{datasets:O,isOpen:a,toggle:d}):t(xl,{isOpen:a,toggle:d})]}),t(S,{className:"d-flex justify-content-center",children:t(we,{className:"btn-light btn-sm app-btn btn-xplore",onClick:V,children:"Explore"})})]})]}):o(S,{children:[" ",c?t("div",{className:"mx-auto",children:t("span",{class:"red-info-text",children:" Apply a dataset selection to access samples. "})}):o(pe,{children:[" ",b&&D()," "]})]})})]})}function jl(e){let l;typeof e.value=="undefined"?l=e.type==="single"?1:[]:l=Array.isArray(e.value)?[e.value[0],e.value[1]]:[e.value],typeof e.type=="undefined"&&!Array.isArray(e.value)&&(e.type="single");const r=xe(null);function s(f,w){return typeof f=="undefined"?w:f}function a(f,w){return typeof f=="undefined"?w:f=="yes"||f==1}function d(f){return typeof f!="undefined"}function c(f,w){if(f===w)return!0;if(f==null||w==null||f.length!==w.length)return!1;for(let q=0;q<f.length;++q)if(f[q]!==w[q])return!1;return!0}const i=xe({isRange:e.type!=="single",from:parseFloat(s(e.from,0)),to:parseFloat(s(e.to,10)),step:s(e.step,1),scale_prop:e.scale,width:parseInt(s(e.width,300),10),showLabels:a(e.showLabels,!0),scaleClickable:a(e.scaleClickable,!1),snap:a(e.snap,!0),format:s(e.format,"%s"),theme:s(e.theme,""),disabled:a(e.disabled,!1),decimals:s(e.decimals,0),animate:a(e.animate,!1),value:[l[0],l[1]],mapValue:e.mapValue,mapScale:e.mapScale,lastPos:[],rebuild:!0,pointers:null,loPtr:null,hiPtr:null,psize:0,vstep:0,labels:null,lowLabel:null,highLabel:null,scale:null,bar:null,clickableBar:null,interval:0}),n=i.current,b=e.type!=="single";n.isRange!==b&&(n.isRange=b,n.rebuild=!0);const L=parseFloat(s(e.from,0));n.from!==L&&(n.from=L,n.rebuild=!0);const F=parseFloat(s(e.to,10));n.to!==F&&(n.to=F,n.rebuild=!0);const D=s(e.step,1);n.step!==D&&(n.step=D,n.rebuild=!0);const x=e.scale;c(n.scale_prop,x)||(n.scale_prop=x,n.rebuild=!0);const m=parseInt(s(e.width,300),10);n.width!==m&&(n.width=m,n.rebuild=!0);const O=a(e.showLabels,!0);O!==n.showLabels&&(n.showLabels=O,n.rebuild=!0);const E=a(e.scaleClickable,!1);E!==n.scaleClickable&&(n.scaleClickable=E,n.rebuild=!0);const p=s(e.format,"%s");p!==n.format&&(n.format=p,n.rebuild=!0);const A=a(e.snap,!0);A!==n.snap&&(n.snap=A,n.rebuild=!0);const V=s(e.theme,"");V!==n.theme&&(n.theme=V,n.rebuild=!0);const P=a(e.disabled,!1);P!==n.disabled&&(n.disabled=P,n.rebuild=!0);const H=s(e.decimals,0);H!==n.decimals&&(n.decimals=H,n.rebuild=!0),e.mapValue!==n.mapValue&&(n.mapValue=e.mapValue),n.animate=a(e.animate,!0);function g(){const f=i.current;f.clickableBar.off("click"),f.pointers.off("mousedown touchstart dragstart")}return se(()=>{const f=v(r.current);let w=n.vstep,q=n.from,Q=n.to-q,W=n.width;function y(){return n.decimals>0}function T(u){let M=Ie(u);if(y()){const Z=parseFloat(M).toFixed(n.decimals);return M=parseFloat(Z),[Z,M]}return M=Math.round(M/n.step)*n.step,[String(M),M]}function B(u){let M=n.value[u];return y()?[parseFloat(M).toFixed(n.decimals),M]:(M=Math.round(M/n.step)*n.step,[String(M),M])}function G(u){let M=Ie(u);M=Math.round(M/n.step)*n.step,M-=n.from;const Z=W/(n.interval/n.step),ae=M/n.step*Z;return u<=ae+Z/2&&u>=ae-Z/2?Math.round(ae):-1}function h(){f.toggleClass("slider-readonly",n.disabled)}function R(u,M,Z,ae){const ie=typeof ae=="undefined";if(!ie&&!n.showLabels)return!1;const re=u?n.highLabel:n.lowLabel;let je;const[Ee,be]=ie?T(M):B(u);if(typeof n.format=="function"){const Dn=n.isRange?u?"high":"low":void 0;je=n.format(Ee,Dn)}else je=n.format.replace("%s",Ee);const Pe=re.html(je).width();let Oe=Math.min(Math.max(M,0),W);return Oe-=Pe/2,n.showLabels&&_(re,{left:Oe},Z&&n.animate),ie&&n.value[u]!==be?(n.value[u]=be,!0):!1}function _(u,M,Z){Z?(u.stop(!0),u.animate(M)):u.css(M)}function X(u,M,Z,ae){let ie,re=parseFloat(n.loPtr.css("left")),je=parseFloat(n.hiPtr.css("left"))||0,Ee=u?n.hiPtr:n.loPtr,be=n.psize/2;if(n.snap&&(M=G(M)),M===n.lastPos[u])return!1;n.lastPos[u]=M,u?je=Math.round(M-be):re=Math.round(M-be);const Pe=Math.round(M-be);if(_(Ee,{left:Pe},Z&&n.animate),n.isRange){ie=n.isRange?re+be:0;const Oe=Math.round(je+be-ie);_(n.bar,{width:Math.abs(Oe),left:Oe>0?ie:ie+Oe},Z&&n.animate)}return R(u,M,Z,ae)}function z(u){if(n.disabled)return;let M=!1;const Z=Math.round(u.pageX-n.clickableBar.offset().left);if(!n.isRange)M=X(0,Z,!0);else{const ae=Math.abs(parseFloat(n.loPtr.css("left"),10)),ie=n.loPtr.width()/2,re=Math.abs(parseFloat(n.hiPtr.css("left"),10)),je=n.loPtr.width()/2,Ee=Math.abs(ae-Z+ie),be=Math.abs(re-Z+je);let Pe;Ee==be?Pe=Z<ae?0:1:Pe=Ee<be?0:1,M=X(Pe,Z,!0)}e.onBarClick&&typeof e.onBarClick=="function"&&e.onBarClick(n.value[0],n.value[1]),M&&K()}function j(){if(!n.isRange)return;const u=n.value[0]==n.from&&n.value[1]==n.to,M=!n.bar.hasClass("full-range");u&&M?n.bar.addClass("full-range"):!u&&!M&&n.bar.removeClass("full-range")}function K(){if(j(),e.onChange&&typeof e.onChange=="function")if(n.isRange){let u=n.value[0],M=n.value[1];n.mapValue&&(u=n.mapValue(u),M=n.mapValue(M)),e.onChange(u,M)}else{let u=n.value[0];n.mapValue&&(u=n.mapValue(u)),e.onChange(u)}}function J(u,M,Z){let ae=0,ie=W;n.isRange&&(ae=M?parseFloat(n.loPtr.css("left"))+n.loPtr.width()/2:0,ie=M===0?parseFloat(n.hiPtr.css("left"))+n.hiPtr.width()/2:W);const re=Math.min(Math.max(Z,ae),ie);X(M,re)&&K()}function Y(u){if(n.disabled||u.type==="mousedown"&&u.which!==1)return;u.stopPropagation(),u.preventDefault();const M=v(u.target);n.pointers.removeClass("last-active"),M.addClass("focused last-active");const Z=M.hasClass("low")?0:1;f.find(Z?"highLabel":"lowLabel").addClass("focused"),v(document).on("mousemove.rslider touchmove.rslider",{pidx:Z},N),v(document).on("mouseup.rslider touchend.rslider touchcancel.rslider",{pidx:Z},I)}function N(u){u.stopPropagation(),u.preventDefault(),u.originalEvent.touches&&u.originalEvent.touches.length?u=u.originalEvent.touches[0]:u.originalEvent.changedTouches&&u.originalEvent.changedTouches.length&&(u=u.originalEvent.changedTouches[0]);const M=Math.round(f.offset().left*100)/100,Z=Math.round(u.clientX-M);f.trigger("change",[u.data.pidx,Z])}function I(u){n.pointers.removeClass("focused").trigger("rangeslideend"),n.labels.removeClass("focused"),v(document).off(".rslider"),e.onDragEnd&&typeof e.onDragEnd=="function"&&(n.isRange?e.onDragEnd(n.value[0],n.value[1]):e.onDragEnd(n.value[0]))}function $(){n.clickableBar.on("click",z),n.pointers.on("mousedown touchstart",Y),n.pointers.on("dragstart",u=>u.preventDefault())}function ee(u){let M=!1;if(!n.isRange){M=u!==n.value[0],Ne([u]),M&&K();return}const Z=Math.abs(n.value[0]-u);if(Math.abs(n.value[1]-u)>Z){M=u!==n.value[0],Ne([u,n.value[1]]),M&&K();return}M=u!==n.value[1],Ne([n.value[0],u]),M&&K()}function ce(){let u=n.scale_prop||[n.from,n.to],M="";for(let ae=0;ae<u.length;ae++){if(u[ae]<n.from||u[ae]>n.to)continue;const ie=Math.round(Me(u[ae]));let re=u[ae];n.mapScale?re=n.mapScale(re):n.mapValue&&(re=n.mapValue(re)),M+=`<span style="left: ${ie}px"><ins data-pos="${u[ae]}">${re}</ins></span>`}n.scale.html().length>5&&n.scaleClickable&&v("ins",n.scale).each((ae,ie)=>ie.off("click")),n.scale.html(M),v("ins",n.scale).each((ae,ie)=>{const re=v(ie);n.scaleClickable?(re.on("click",()=>ee(String(re.data("pos")))),re.css({marginLeft:-re.outerWidth()/2,cursor:"pointer"})):re.css({marginLeft:-re.outerWidth()/2})})}function Me(u){return W*(u-q)/Q}function Ie(u){return u*Q/W+q}function Ne(u){d(u)||(u=[n.value[0],n.value[1]]),u[0]=Math.min(Math.max(u[0],n.from),n.to),n.isRange&&d(u[1])&&(u[1]=Math.min(Math.max(u[1],n.from),n.to),u[0]>u[1]?(n.value[0]=u[1],n.value[1]=u[0]):(n.value[0]=u[0],n.value[1]=u[1])),X(0,Math.round(Me(n.value[0])),!1,n.value[0]),n.isRange&&d(u[1])&&X(1,Math.round(Me(n.value[1])),!1,n.value[1])}let ge=n.theme;ge.length>0&&ge!="default"&&(ge=`theme-${ge}`,f.hasClass(ge)||f.addClass(ge)),n.rebuild?(f.off("change"),n.interval=n.to-n.from,n.lastPos=[],n.isRange?(d(n.value[0])||(n.value[0]=n.from+(n.to-n.from)/4),d(n.value[1])||(n.value[1]=n.value[0]+(n.to-n.from)/4)):d(n.value[0])||(n.value[0]=d(e.value)?e.value:n.value[0]=n.from+(n.to-n.from)/2),f.on("change",J),n.pointers=v(".pointer",f),n.loPtr=n.pointers.first(),n.hiPtr=n.pointers.last(),n.labels=v(".pointer-label",f),n.lowLabel=n.labels.first(),n.highLabel=n.labels.last(),n.scale=v(".scale",f),n.bar=v(".selected-bar",f),n.clickableBar=f.find(".clickable-bar"),W=n.width,f.width(W+1),n.isRange?(n.hiPtr.show(),n.highLabel.show(),n.bar.show()):(n.hiPtr.hide(),n.highLabel.hide(),n.bar.hide()),n.psize=n.loPtr.outerWidth(),w=1/Math.pow(10,H),n.vstep=w,q=n.from,Q=n.to-q,n.showLabels?n.labels.show():n.labels.hide(),g(),$(),e.scale&&ce(),n.rebuild=!1,d(e.value)&&(n.value[0]=l[0],n.value[1]=l[1]),Ne(),j(),h()):d(e.value)&&(n.value[0]!==l[0]||n.value[1]!==l[1])&&(n.value[0]=l[0],n.value[1]=l[1],Ne(),j())}),se(()=>()=>{g()},[]),t("div",{class:"slider-range-wrap",children:o("div",{ref:r,class:"slider-container",children:[o("div",{class:"back-bar",children:[t("div",{class:"selected-bar"}),t("div",{class:"pointer low"}),t("div",{class:"pointer-label low"}),t("div",{class:"pointer high"}),t("div",{class:"pointer-label high"}),t("div",{class:"clickable-bar"})]}),t("div",{class:"scale"})]})})}function Ht(e,l){return typeof e=="undefined"?l:Number(e)}function Ml({range:e,text:l,onClick:r}){function s(a){r&&r(a,e)}return t("div",{class:"btn-age-preset",range:e,onClick:s,children:l})}const te=[-1,120],ve=[0,10,20,30,40],rt=[te[0],15,30,45,60,75,90,105,te[1]],Ve=[ve[0],ve[ve.length-1]];function Vt(e){return Math.round(e*100+Number.EPSILON)/100}function Fl(e){const[l,r]=le({vmin:te[0],vmax:te[1],fetal:!1}),s=e.drange,[,a]=Qe(h=>h+1,0),d=xe(null),c=xe({fetalSel:[0,40],fullSel:[te[0],te[1]],scale:rt,mrange:te,slState:l,currentRange:[te[0],te[1]],appliedRange:[te[0],te[1]],jqCreated:!1,internalRerender:!1,renderKey:1234,btnApply:null,inputTimeout:null}),i=c.current;function n(h){const R=i.slState.vmin!=h.vmin||i.slState.vmax!=h.vmax||i.slState.fetal!=h.fetal;if(i.slState.fetal!=h.fetal&&(h.fetal?(i.scale=ve,i.mrange=Ve):(i.scale=rt,i.mrange=te)),i.slState=Fe({},h),R){const _=h.fetal?Vt((h.vmin-40)/52):h.vmin,X=h.fetal?Vt((h.vmax-40)/52):h.vmax;h.fetal?i.fetalSel=[h.vmin,h.vmax]:i.fullSel=[h.vmin,h.vmax],e.onChange&&e.onChange(_,X),i.currentRange[0]=_,i.currentRange[1]=X}i.internalRerender=!0,r(h)}function b(){return i.currentRange[0]!=te[0]||i.currentRange[1]!=te[1]}function L(){s&&(i.currentRange[0]===te[0]&&i.currentRange[1]===te[1]?s.length=0:(s[0]=i.currentRange[0],s[1]=i.currentRange[1])),i.appliedRange[0]=i.currentRange[0],i.appliedRange[1]=i.currentRange[1],b()?x():m(),e.onApply&&e.onApply(i.appliedRange[0],i.appliedRange[1]),a()}function F(h){i.currentRange[0]=te[0],i.currentRange[1]=te[1],n({vmin:te[0],vmax:te[1],fetal:!1}),L()}se(()=>{i.jqCreated||(i.jqCreated=!0),i.internalRerender=!1});function D(h,R){R&&A(R)}function x(){const h=v(d.current);h.find(".age-panel").collapse("hide"),h.addClass("lg-collapsed")}function m(){const h=v(d.current);h.find(".lg-title")&&(h.find(".age-panel").collapse("show"),h.removeClass("lg-collapsed"))}function O(h){v(d.current).hasClass("lg-collapsed")?m():x()}function E(h,R){h>0&&(h=Math.round(h)),R>0&&(R=Math.round(R)),n(_e(Fe({},c.current.slState),{vmin:h,vmax:R}))}function p(h){const R=h.target.checked;i.scale=R?ve:rt,i.mrange=[i.scale[0],i.scale[i.scale.length-1]];const _=R?i.fetalSel:i.fullSel;n({fetal:R,vmin:_[0],vmax:_[1]})}function A(h){const R=c.current.slState;(R.vmin!==h[0]||R.vmax!==h[1])&&(e.onChange&&e.onChange(h),n({fetal:R.fetal,vmin:h[0],vmax:h[1]}))}function V(){i.inputTimeout&&clearTimeout(i.inputTimeout),i.inputTimeout=null}function P(h,R=1200){h.inputType==="insertReplacementText"&&(R=0),V(),i.inputTimeout=setTimeout(()=>{const _=c.current.slState,[X,z]=i.mrange;let j=[_.vmin,_.vmax],K=h.target.value.trim();if(K===""||K==="-"){h.target.value=j[0],i.inputTimeout=null;return}let J=parseFloat(K).toFixed(0);if(J.length>0&&J!="NaN"){let Y=parseFloat(J);Y>z&&(Y=z),Y>j[1]&&(Y=j[1]),Y<X&&(Y=X),Y!==j[0]&&A([Y,j[1]]),Y!==parseFloat(K)&&(h.target.value=Y)}else h.target.value=j[0];i.inputTimeout=null},R)}function H(h){if(i.slState.fetal){const R=ve[ve.length-1];return h==R?"birth":h}return h}function g(h,R=1200){h.inputType==="insertReplacementText"&&(R=0),V(),i.inputTimeout=setTimeout(()=>{const _=c.current.slState;let X=[_.vmin,_.vmax];const[z,j]=i.mrange;let K=h.target.value.trim();if(K===""||K==="-"){h.target.value=X[1],i.inputTimeout=null;return}let J=parseFloat(K).toFixed(0);if(J.length>0&&J!="NaN"){let Y=parseFloat(J);Y>j&&(Y=j),Y<X[0]&&(Y=X[0]),Y<z&&(Y=z),Y!==X[1]&&A([X[0],Y]),Y!==parseFloat(K)&&(h.target.value=Y)}else h.target.value=X[1];i.inputTimeout=null},R)}function f(h){P(h,0)}function w(h){g(h,0)}function q(h){h.key.toLowerCase()==="enter"&&(h.target.id=="ivmin"?P(h,0):g(h,0),h.preventDefault())}function Q(){const h=i.appliedRange[1]<=0&&i.appliedRange[0]<=0;let R=[i.appliedRange[0],i.appliedRange[1]];h&&(R[0]=Math.round(i.appliedRange[0]*52+40),R[1]=Math.round(i.appliedRange[1]*52+40)),n({vmin:R[0],vmax:R[1],fetal:h})}if(s&&(s.length==0?i.appliedRange=[te[0],te[1]]:i.appliedRange=[s[0],s[1]]),!i.jqCreated||!i.internalRerender){if(s?(l.vmin=i.appliedRange[0],l.vmax=i.appliedRange[1],l.fetal=l.vmin<0&&l.vmax<=0):(l.vmin=Ht(e.vmin,e.fetal?Ve[0]:te[0]),l.vmax=Ht(e.vmax,e.fetal?Ve[1]:te[1]),e.fetal?l.fetal=!0:l.fetal=l.vmin<0&&l.vmax<=0),i.currentRange=[l.vmin,l.vmax],l.vmin<0&&l.vmax<=0){l.fetal=!0;let h=Math.round(l.vmin*52+40),R=Math.round(l.vmax*52+40);const _=ve[0],X=ve[ve.length-1];h<_&&(h=_),h>X&&(h=X),R<_&&(R=_),R>X&&(R=X),l.vmin=h,l.vmax=R}i.scale=l.fetal?ve:rt,i.mrange=[i.scale[0],i.scale[i.scale.length-1]],i.slState=Fe({},l),i.renderKey=String(Date.now()).substring(4)}const W=b(),y=i.currentRange[0]!=i.appliedRange[0]||i.currentRange[1]!=i.appliedRange[1],T=y&&i.appliedRange[0]!==te[0]&&i.appliedRange[1]!==te[1];let B=`${i.slState.vmin} - ${i.slState.vmax}`;i.slState.fetal?B=i.slState.vmin==Ve[0]&&i.slState.vmax==Ve[1]?"fetal":`fetal ${B}`:i.slState.vmin<0&&(B=`fetal - ${i.slState.vmax}`);const G=e.title||"Age range";return o("div",{class:"lg-panel",ref:d,style:{width:e.width?e.width:"14rem"},children:[o("div",{class:"lg-title d-flex align-items-center",style:"min-height:24px !important;",children:[t("span",{onClick:e.notitleclick?null:O,class:e.notitleclick?"":"lg-clickable",children:G}),o("span",{class:"float-right d-flex justify-content-center align-items-center",children:[t("span",{class:"btn-undo",onClick:Q,style:T?{display:"inline-block"}:{display:"none"},children:t("img",{class:"btn-undo-icon"})},String(Date.now()-10).substring(4)),t("span",{class:"lg-apply",onClick:L,style:{display:y?"inline":"none"},children:"Apply"},String(Date.now()).substring(4)),t("span",{className:"coll-glyph",onClick:O,children:" "})]})]})," ",o("div",{class:"collapse show age-panel",children:[o("div",{class:"age-padder d-flex justify-content-start align-items-center pt-1",children:[o("div",{class:"custom-control custom-checkbox",children:[t("input",{type:"checkbox",class:"custom-control-input",id:"swFetal",checked:i.slState.fetal,onClick:p}),o("label",{class:i.slState.fetal?"custom-control-label lb-fetal-ck":"custom-control-label lb-fetal",for:"swFetal",children:["fetal",i.slState.fetal?"":"?"," "]})]}),t("span",{class:"flex-fill",children:!i.slState.fetal&&t(Ml,{range:[16,64],onClick:D,text:"16-64"})})]}),t("div",{class:"age-padder pt-0",children:t(jl,{onChange:E,width:"180",scale:i.scale,showLabels:!0,from:i.mrange[0],to:i.mrange[1],mapScale:H,value:[i.slState.vmin,i.slState.vmax]})}),o("div",{class:"age-padder d-inline-flex align-items-center justify-content-center pl-4 pt-0",children:[t(oe,{className:"form-control-sm",id:"ivmin",type:"number",size:"5",pattern:"^-?[1-9]\\d*$",onChange:P,onBlur:f,onKeyDown:q,min:i.mrange[0],max:i.mrange[1],value:i.slState.vmin}),t("span",{class:"age-spacer",children:" .. "}),t(oe,{className:"form-control-sm",id:"ivmax",type:"number",size:"5",pattern:"^\\.-?[1-9]\\d*$",onChange:g,onBlur:w,onKeyDown:q,min:i.mrange[0],max:i.mrange[1],value:i.slState.vmax}),o("div",{class:"age-label",children:[" ",i.slState.fetal?"PCW":"years"," "]})]})]}),W&&o("div",{className:"lg-only",children:[t("span",{class:"lg-only-lb",onClick:F,children:"\u2715"}),t("span",{class:"lg-only-item",onClick:F,children:B})]})]})}function Nn(e){const l=e.width||"15em",r=Se("age"),s=_t();let a=s.length?1:0;const d=e.onAgeSelection&&typeof e.onAgeSelection=="function"?e.onAgeSelection:null,[c,i]=le(a),n=["Age bins ","Age range "];xe({created:!1});function b(x,m){m=="age-range"&&v("#tsAgeRange").toast("show")}function L(x){if(x==c)return;let m=!0;m=x?il():!0,m||(m=!0,console.log("NOTICE::::: Age selection cleared!"),d&&d(c)),i(x)}function F(){St("age"),d&&d(c)}function D(x,m){Ae(),d&&d(c)}return te[0],te[1],s.length==2,String(Date.now()).substring(4),o(k,{className:"d-flex justify-content-start pt-0 mt-0",style:{position:"relative"},children:[c?t(Fl,{width:l,title:" ",drange:s,onApply:D,notitleclick:!0}):t(De,{id:"age",title:" ",width:l,ageRange:_t(),data:r,filter:ke,onApply:F,onNoClickInfo:b,notitleclick:!0,updateFilter:!0}),o(tn,{className:"p-0 m-0 age-t-dd",children:[t(nn,{className:"age-t-dtoggle v-100 m-2",nav:!0,caret:!0,children:n[c]}),t(ln,{className:"age-t-ddlst",children:n.map((x,m)=>t(an,{onClick:()=>L(m),children:x},m))})]}),t(jt,{id:"tsAgeRange",text:"A custom age range was selected. Dismiss it before selecting age bins."})]})}const Cn=Ue(),Rn=Ue();function Bl(){return Ye(Cn)}function Ll(){return Ye(Rn)}function El({children:e}){const[l,r]=le([0,[],[],[]]);function s(a){r(a)}return t(Cn.Provider,{value:l,children:t(Rn.Provider,{value:s,children:e})})}var Pl="/dev/bdportal/assets/br_sect_100w.png";let Ze=[],Wt=null;const Tl=700,$l=al.slice(1,6),Il="#FFF0F0",Ol="rgb(255,240,240)",wt="#ed1848";let Kt=null,gt=!1;function Sn(e,l){return e>=Ze.length-1?0:Ze[e+1][l]}function Jt(e,l,r){return l=parseInt(l,10),l>e.length-1||l<0?e:e.substring(0,l).concat(r,e.substring(l+1))}function _l(e){const[l,r,s,a]=He(),[d,c]=Dt(),i=At();gt=hl();const n=xe({onlySt:[""],appSt:[""],appSelcol:[0],selcol:[0],selregs:[],interSects:[],btnApp:[null]}),b=n.current.onlySt,L=n.current.appSt,F=n.current.appSelcol,D=n.current.btnApp,x=n.current.selregs,m=n.current.selcol;Kt=Ll(),Wt=l;let O=0;s.reg.length>0&&(O=s.reg[0].length),se(()=>{if(gt&&de.reg.length>0){m[0]=0,x.length=0;const y=de.reg;for(let B=1;B<U.reg.length;B++)x.push(0);p(),L[0]=b[0];const T=ql($l,y);W(),P(T),C.reg.size&&C.brXtX.size&&E()}}),se(()=>{function y(){gt||Ze.length===0||(C.reg.size==0&&(H(!0),L[0]=b[0],F[0]=0),v("#rxMatrix > tbody > tr").each((T,B)=>{v(B).find("td").each((G,h)=>{let R=Sn(G,T+1),_=v(h);_.html(R===0?"":R),kn(_,R),G+1===m[0]&&x[T]&&q(_,T,G,1)})}),A(),g())}y()},[c]);function E(){const y=C.brXtX.values().next().value;C.reg.forEach(T=>{x[T-1]=1,q(null,T-1,y+1,1)}),L[0]=b[0],F[0]=m[0],g()}function p(){m[0]=0;for(let y=0;y<x.length;y++)x[y]=0;b[0]="";for(let y=0;y<O;y++)b[0]+="0"}function A(){if(b[0]===L[0]&&F[0]===m[0]){D[0].hide();return}D[0].show()}function V(){const y=[];for(let T=0;T<x.length;T++)x[T]>0&&y.push(T+1);ol("reg",y,m[0]),L[0]=b[0],F[0]=m[0],i("reg")}function P(y){D[0]=y.find(".lg-apply"),D[0].off("click"),D[0].on("click",function(){v(this).hide(),V()}),D[0].hide()}function H(y){if(m[0]>0){for(let T=0;T<x.length;T++)x[T]>0&&Q(null,T,m[0],1);p()}y||(g(),A())}function g(){Kt([m[0],x,Ze,Wt])}function f(y,T,B,G){if(x[T]&&m[0]===B&&y.html().trim().length!==0)return;const h=y.prop("obg");if(G)h?y.css("background-color",h):y.css("background-color","");else if(h){const R=wl(h,Ol,.1);y.css("background-color",R)}else y.css("background-color",Il)}function w(y,T){const B=y.index(),G=y.parent().index();if(y.siblings("td").each(function(){const R=v(this),_=R.index();f(R,G,_,T)}),x[G]?it(y.siblings("th")):Nt(y.siblings("th"),T),m[0]===0||m[0]===B){v("#rxMatrix td:nth-child("+(B+1)+")").each(function(){const R=v(this),_=R.parent().index();f(R,_,B,T)}),f(y,G,B,T);var h=v("#rxMatrix th:nth-child("+(B+1)+") > div > span");B===m[0]?it(h):Nt(h,T)}}function q(y,T,B,G){if(y==null&&(y=v("table#rxMatrix tr").eq(T+1).find("td").eq(B-1)),y!=null){if(y.html().trim().length!==0)y.css("font-weight","bold"),y.css("color","#fff"),y.css("background-color",wt);else return;var h=y.siblings("th");it(h),x[T]=1,m[0]===0&&(it(v("#rxMatrix th:nth-child("+(B+1)+") > div > span")),m[0]=B),b[0]=Jt(b[0],T,"1"),G||(A(),g())}}function Q(y,T,B,G){if(y==null&&(y=v("table#rxMatrix tr").eq(T+1).find("td").eq(B-1)),y==null)return;y.css("font-weight","normal");const h=y.prop("obg"),R=y.prop("ofg");R?y.css("color",R):y.css("color",""),h?y.css("background-color",h):y.css("background-color",""),x[T]=0,Qt(y.siblings("th"));let _=0;for(let X=0;X<x.length;X++)if(x[X]){_=1;break}_===0&&(m[0]&&Qt(v("#rxMatrix th:nth-child("+(m[0]+1)+") > div > span")),m[0]=0),b[0]=Jt(b[0],T,"0"),G||(A(),g())}function W(){v("#rxMatrix td").on("mouseenter",function(){w(v(this),0,m[0])}).on("mouseleave",function(){w(v(this),1,m[0])}),v("#rxMatrix td").on("click",function(){const y=v(this),T=y.index(),B=y.parent().index();m[0]>0&&m[0]!==T||(x[B]?Q(y,B,T):y.html()>0&&q(y,B,T))}),v("#rxMatrix th").on("mouseenter",function(){Zt(v(this),0,m[0],x)}).on("mouseleave",function(){Zt(v(this),1,m[0],x)}),v("#rxMatrix th").on("click",function(){let y=v(this),T=y.index();if(y.hasClass("rt")){if(m[0]>0&&m[0]!==T)return;if(m[0]>0)H(!0);else{console.log(" selecting all!~~~~~~~~~~~~~~~~~~~");for(let B=0;B<x.length;B++)q(null,B,T,1)}}else{let B=y.parent().index();m[0]>0&&(x[B]?Q(null,B,m[0],1):q(null,B,m[0],1))}A(),g()})}return t(pe,{children:o("div",{className:"col mx-auto",children:[t("div",{className:"mxImgBox",children:t("img",{alt:"Regions",src:Pl})}),o("div",{className:"mxApply",children:[t("span",{className:"lg-apply",children:"Apply"})," "]}),o("table",{id:"rxMatrix",children:[t("thead",{}),t("tbody",{})]})]})})}function zl(e,l,r){let s=v("#rxMatrix > thead"),a=s.parents(".matrixWrap");v("#rxMatrix td").off(),s.empty(),s.append('<tr><th class="cr" style="width:8rem;"></th>'+v.map(e,c=>'<th class="rt"><div class="txRotate"><span>'+c+"</span></div></th>").join()+"</tr>");let d=v("#rxMatrix > tbody");return d.empty(),d.append(v.map(l,(c,i)=>'<tr><th><span data-toggle="tooltip" data-placement="left" title="'+r[i]+'">'+c+"</span></th>"+v.map(e,(n,b)=>{let L=Sn(b,i+1);return L===0&&(L=""),"<td>"+L+"</td>"}).join()+`</tr>
`).join()),v("#rxMatrix td").each(function(){let c=v(this),i=c.html();kn(c,i)}),a}function kn(e,l){if(l>0){let r=l/(Tl*4.1),s=vl("rgb(240,240,240)",-r),a=yl(s)<120?"#fff":"#000";e.prop("obg",s),e.css("background-color",s),e.prop("ofg",a),e.css("color",a),e.css("cursor","pointer")}else e.removeProp("obg"),e.removeProp("ofg"),e.css("cursor","default"),e.css("background-color",""),e.css("color","")}function ql(e,l){if(l.length===0){console.log("RMatrix --- zero data length!");return}return he.rebuildRMatrix=!1,Ze=l,zl(e,U.reg.slice(1),U.regFull.slice(1))}function Zt(e,l,r,s){if(e.hasClass("rt")){if(r>0)return}else{let a=e.parent().index();if(r>0&&s[a])return}Nt(e,l)}function it(e){e.hasClass("rt")?e.css("color",wt):(e.css("color","#fff"),e.css("background-color",wt))}function Qt(e){e.css("color",""),e.css("background-color","")}function Nt(e,l){l?(e.css("color",""),e.css("background-color","")):e.css("color","#622")}function Xl(){Dt();const[e,l,r,s]=Bl();let a=0,d="";const i=xe({regSelApplied:!1,showHint:!1,expType:""}).current;if(e>0){d=["RNASeq","DNAm","WGS","scRNAseq","long RNAseq"][e-1];for(let n=0;n<l.length;n++)l[n]&&a++}return a&&C.reg.size>0&&(i.regSelApplied=!0),i.showHint=a&&!i.regSelApplied,i.expType=d,se(()=>{i.showHint&&v("#regSelInfo").toast("show")}),t(k,{className:"m-0 p-0 ml-3 mr-2 trinfo justify-content-center align-items-center red-info-text",style:"width:20rem;min-height:4rem;",children:t("div",{class:"position-fixed p-1",style:"z-index: 15; top: 4em; right: 12em;",children:o("div",{id:"regSelInfo",class:"toast hide",role:"alert","aria-live":"assertive","aria-atomic":"true","data-delay":"2000",children:[o("div",{class:"toast-header-sm",children:[t("strong",{class:"mr-auto",style:"color:#777;",children:"Information"}),t("button",{type:"button",class:"ml-2 mb-1 mr-1 close","data-dismiss":"toast","aria-label":"Close",children:t("span",{"aria-hidden":"true",children:"\xD7"})})]}),o("div",{class:"toast-body mt-1 pt-0",children:["Only subjects having ",i.expType," samples in the ",t("br",{})," selected brain regions will be considered after selection is applied"]})]})})})}const Ul=({tab:e,style:l})=>{const[,,,r]=He(),s=At();if(Qe(E=>E+1,0),se(()=>{v('[data-toggle="tooltip"]').tooltip({delay:{show:800,hide:100},trigger:"hover"}),v(".toast").toast({delay:5e3})},[]),!r)return t("h3",{children:"Loading.."});function a(){kt(),s("clear")}function d(E){if(!E||E.length==0)return on(),s("clear-brlist"),0;const p=cn(E);return s("brlist"),p}function c(E){let p=E.target.checked;zt("with_seq",p),s("sequenced")}function i(E){let p=E.target.checked;zt("with_gt",p),s("genotyped")}function n(E){St(E),s(E)}function b(E){s(E?"age-range":"age")}const L=Se("sex"),F=Se("dx"),D=Se("race"),x=Ot("with_seq"),m=Ot("with_gt"),O=rn().size;return t("div",{class:"col-12 d-flex flex-column",children:o(El,{children:[o(k,{className:"pl-2 pt-0 pb-0 mt-0 d-flex flex-nowrap align-items-end justify-content-center",children:[o(S,{xs:"3",className:"colDemo ml-2",style:{height:"3.3rem"},children:[" \xA0",o("div",{class:"col d-flex justify-content-between align-self-center ckRow",children:[t("div",{class:"col-6 d-flex",children:t("div",{class:"row pl-0 d-flex justify-content-start align-self-center",children:t(we,{outline:!0,color:"danger",className:"btn-sm align-self-start",onClick:a,"data-toggle":"tooltip",title:"Clear all demographic filters",style:"line-height:80%;font-size:80%;margin-top:-3px;",children:"Clear"})})}),o("div",{class:"col-6 d-flex flex-column",children:[t("div",{class:"row mx-auto",children:o("div",{className:"ckbox-label","data-toggle":"tooltip","data-placement":"left",title:"Consider only genotyped brains",children:[t(Pt,{type:"checkbox",id:"ckOnlyGenotyped",onClick:i,checked:m}),"Genotyped"]})}),t("div",{class:"row mx-auto",children:o("div",{className:"ckbox-label","data-toggle":"tooltip","data-placement":"left",title:"Only sequenced brains with at least one data type",children:[t(Pt,{type:"checkbox",id:"ckOnlySeq",onClick:c,checked:x}),"Sequenced"]})})]})]})]}),t(S,{xs:"5",className:"colMatrix d-flex align-self-start",children:"  "}),t(S,{xs:"4",className:"pl-3 colSummary align-self-start",children:t(k,{className:"m-0 p-0 mr-1 pr-1 mt-1 d-flex justify-content-start",children:t(Xl,{})})})]}),o(k,{className:"flex-grow-1 pt-0 mt-0 justify-content-center",children:[t(S,{xs:"3",className:"colDemo",children:o(S,{className:"d-flex flex-column col-vscroll",children:[t(k,{className:"d-flex justify-content-start",children:t(De,{id:"dx",width:"15em",height:"6.9em",data:F,filter:ke,onApply:n,updateFilter:!0})}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"sex",type:"htoggle",width:"15em",data:L,filter:ke,onApply:n,updateFilter:!0})}),t(Nn,{width:"15em",onAgeSelection:b}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"race",width:"15em",height:"5.4rem",data:D,filter:ke,onApply:n,updateFilter:!0})})]})}),t(S,{xs:"5",className:"pt-0 mt-0 colMatrix align-self-start",children:t(k,{className:"mt-0 pt-0",children:t(S,{className:"col-4 matrixWrap",children:t(_l,{})})})}),t(S,{xs:"4",className:"d-flex flex-fill",children:t(k,{className:"pt-0 mt-0 d-flex flex-fill flex-grow-1 justify-content-center align-items-start",children:t(Mt,{brloaded:O,onBrList:d})})})]})]})})},Gl=["#","BrNum","Dx","Ancestry","Sex","Age","RNAseq","DNAm","WGS"];function Hl(e,l,r){const[s,a,d,c,i,n,b,L]=e;let F=qe[0],D=0;F&&F[l]&&(D=F[l].length);let x=qe[1],m=0;x&&x[l]&&(m=x[l].length);let O=qe[2],E=0;return O&&O[l]&&(E=O[l].length),o("tr",{children:[o("td",{children:[r,"."]})," ",o("td",{children:["Br",s]}),t("td",{children:U.dx[a]}),t("td",{children:U.race[d]})," ",t("td",{children:U.sex[c]})," ",t("td",{children:i}),t("td",{children:D})," ",t("td",{children:m}),"  ",t("td",{children:E})]},r)}const Vl=e=>{xe({brd:[],sortcol:0,sortup:!1}).current,se(()=>{const s=v(".brtbl"),a=s.find("tbody tr:first").children(),d=s.find("thead tr");let c=a.map(function(){return v(this).width()}).get(),i=d.children().map(function(){return v(this).width()}).get();d.children().each((n,b)=>{v(b).width(Math.max(c[n],i[n]))}),a.each((n,b)=>{v(b).width(Math.max(c[n],i[n]))})});const r=[];return Le.forEach(s=>{const a=Re[s];r.push([a,s])}),o("table",{class:"tbl tbldsets brtbl",children:[t("thead",{children:t("tr",{children:Gl.map((s,a)=>o("td",{children:["  ",s]},a))},"t0")}),t("tbody",{children:r.map((s,a)=>{const[d,c]=s;return Hl(d,c,a+1)})})]})},Wl=()=>{const[e,l]=le(0);return dn(!0)?o("div",{class:"col-12 d-flex flex-column",children:[t(k,{className:"pt-1",children:"\xA0"}),o(k,{className:"flex-grow-1 pt-0 mt-0 mr-0 pr-0 justify-content-center",children:[t(S,{xs:"7",className:"d-flex mr-0 pr-0",children:t(S,{className:"d-flex align-items-start justify-content-end",children:t(Vl,{tnum:e})})}),t(S,{xs:"5",className:"d-flex align-items-start",children:t(k,{className:"pl-0 pr-0 pt-0 mt-0 d-flex flex-fill justify-content-start align-items-start",children:t(Mt,{browse:!0})})})]})]}):t("div",{class:"col-12 d-flex flex-column",children:t(k,{className:"pt-3 d-flex flex-nowrap flex-row align-items-center justify-content-center",children:t(S,{children:t("div",{style:"color:#d23;line-height:200%;font-size:100%;",children:o("span",{children:["Please make a selection in the ",t("b",{children:"Select"})," tab"]})})})})})},Yt=({params:e})=>{let l=e.tab;l!=="browse"&&(l="matrix");const[,,,r]=He();return r?(fn(0),l==="matrix"?t(Ul,{}):t(Wl,{})):t("h3",{children:"Loading.."})};const Kl=({style:e})=>{const[,,,l]=He(),r=At();if(Qe(p=>p+1,0),se(()=>{v('[data-toggle="tooltip"]').tooltip({delay:{show:800,hide:100},trigger:"hover"}),v(".toast").toast({delay:4e3})},[]),se(()=>{s()}),!l)return t("h3",{children:"Loading.."});function s(){const p=v("#dset-info-content");p.html(""),p.hide()}function a(){s(),kt(),r("clear")}function d(p){s(),St(p),r(p)}function c(p){r(p?"age-range":"age")}function i(p){if(!p||p.length==0)return s(),on(),r("clear-brlist"),0;const A=cn(p);return r("brlist"),A}function n(p){let A=p.trim().split(/\|/);A[2]&&(A[2].length<3?A[2]="":A[2]=`<i>${A[2]}</i>`);for(let V=3;V<A.length;V++){let P=A[V].split(/:/);if(P&&P.length>1)switch(P[0]=P[0].toLowerCase(),P[0]){case"doi":P[1]=`<a href="https://doi.org/${P[1]}" target="_blank">DOI</a>`,A[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${P[1]}`;break;case"pmid":P[1]=`<a href="https://pubmed.ncbi.nlm.nih.gov/${P[1]}" target="_blank">PMID</a>`,A[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${P[1]}`;break;case"https":P[1]=`<a href="https:${P[1]}" target="_blank">url</a>`,A[2]+=`&nbsp;&nbsp;&nbsp;&nbsp;${P[1]}`;break}}return`<b>${A[1]}</b><br/>${A[0]},&nbsp;${A[2]}`}function b(p,A,V){let P=sl(0,p);const H=v("#dset-info-content");if(V&&V.length>1){v("#dsMultiWarn").toast("show");return}if(P&&P.length>0){const g=n(P);H.html(g),H.show()}else H.html(""),H.hide()}const L=Se("sex"),F=Se("dx"),D=Se("race"),x=Se("proto"),m=Se("dset"),O=Se("reg"),E=rn().size;return o("div",{class:"col-12 d-flex flex-nowrap flex-column",children:[o(k,{className:"pt-0 mt-0 justify-content-center flex-nowrap",children:[t(S,{xs:"3",className:"d-flex pl-1 ml-1 colDemo justify-content-start",children:t(we,{outline:!0,color:"danger",className:"mt-0 btn-sm align-self-center",onClick:a,"data-toggle":"tooltip",title:"Clear all selection filters",style:"line-height:80%;font-size:80%;margin-top:6px;",children:"Clear"})}),t(S,{className:"pl-0 pt-0 mt-1 align-self-start",style:"max-width:26rem;min-width:26rem;",children:t("div",{id:"dset-info",children:t("div",{id:"dset-info-content",children:" "})})}),t(S,{xs:"4",className:"d-flex flex-fill",style:"z-index:-1;"})]}),o(k,{className:"flex-grow-1 pt-0 mt-0 justify-content-center flex-nowrap",children:[t(S,{xs:"3",className:"colDemo",children:o(S,{className:"d-flex flex-column col-vscroll",children:[t(k,{className:"d-flex justify-content-start",children:t(De,{id:"dx",width:"15em",height:"6.9em",data:F,filter:ke,onApply:d,updateFilter:!0})}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"sex",type:"htoggle",width:"15em",data:L,filter:ke,onApply:d,updateFilter:!0})}),t(Nn,{width:"15em",onAgeSelection:c}),t(k,{className:"d-flex justify-content-start",children:t(De,{id:"race",width:"15em",height:"5.4rem",data:D,filter:ke,onApply:d,updateFilter:!0})})]})}),t(S,{className:"pt-0 mt-0 align-self-start",style:"max-width:26rem",children:t(k,{className:"mt-0 pt-0",children:o(S,{children:[t(k,{children:t(De,{id:"dset",height:"11em",width:"25em",type:"faketoggle",nocollapse:!0,class:"fl-shad lg-sq",data:m,filter:ke,onApply:d,updateFilter:!0,onClickItem:b})}),o(k,{className:"d-flex justify-content-start flex-nowrap",children:[t(S,{className:"p-0 m-0",style:"max-width:15.2em;",children:t(De,{id:"reg",width:"14rem",height:"8.1rem",data:O,filter:ke,onApply:d,updateFilter:!0,sort:!0})}),t(S,{className:"p-0 m-0",children:t(De,{id:"proto",type:"toggle",nobars:!0,width:"10.4em",data:x,filter:ke,onApply:d,updateFilter:!0})})]})]})})}),t(S,{xs:"4",className:"d-flex flex-fill",children:t(k,{className:"pt-0 mt-0 d-flex flex-fill flex-grow-1 justify-content-center align-items-start",children:t(Mt,{brloaded:E,onBrList:i})})}),t(jt,{id:"dsMultiWarn",title:"Warning",text:"Batch effect should be considered when selecting samples from multiple datasets."})]})]})};function Jl(e){return se(()=>{console.log(" --- ExpAgePlots creation time --");const l=document.createElement("script");l.src=et+"json_plotly_ageplot.js",l.async=!0,document.body.appendChild(l)},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(S,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3",children:[t(S,{xs:"1",className:"d-flex justify-content-start align-content-start pt-2 pr-0",children:t("b",{children:"[Preview]"})}),t(S,{xs:"2",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:t(me,{children:" Genes to plot:"})}),t(S,{xs:"8",className:"d-flex justify-content-start align-content-center",children:t(oe,{value:"GRIN2A,GRIN2B,SP4",disabled:!0})})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}function Zl(e){return se(()=>{console.log(" --- ExpBoxPlots creation time --");const l=document.createElement("script");l.src=et+"json_plotly_boxplots.js",l.async=!0,document.body.appendChild(l)},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(S,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3 pl-0",children:[t(S,{xs:"1",className:"d-flex justify-content-start align-content-start pt-2 pr-0",children:t("b",{children:"[Preview]"})}),t(S,{xs:"5",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:o(me,{children:["Control vs SCZD for gene ",t("b",{children:"GPR52"})," across datasets: "]})}),t(S,{xs:"6",className:"d-flex justify-content-start align-content-center",children:t(oe,{value:"Caudate, DG, DLPFC.polyA, DLPFC, Habenula, mPFC",disabled:!0})})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}const Ql=({selData:e,style:l})=>{const[r,s]=le(1);function a(d){s(Number(d.target.id))}return t("div",{class:"col-12 d-flex flex-nowrap flex-column",children:o(k,{className:"flex-grow-1 pt-1 mt-1 justify-content-start",children:[t(S,{xs:"1",className:"d-flex p-0 m-0 colExpNav justify-content-start",children:o(Ct,{vertical:!0,tabs:!0,children:[t(Be,{children:t(ze,{className:"app-navlnk",id:"1",active:r==1,onClick:a,href:"#",children:"Gene Age Plots"})}),t(Be,{children:t(ze,{className:"app-navlnk",id:"2",active:r==2,onClick:a,href:"#",children:"Gene boxplots"})}),t(Be,{children:t(ze,{className:"app-navlnk",children:"more to come.."})})]})}),t(S,{xs:"10",className:"d-flex flex-fill",children:r==1?t(Jl,{}):t(Zl,{})})]})})};function Yl(e){const[l,r]=le([]);async function s(c){const i=await fetch(c,{mode:"cors"});return i.headers.get("Content-Type"),await i.text()}function a(){return l.length==0?null:o("table",{class:"tbl tbldsets bregtbl",children:[t("thead",{children:t("tr",{children:l[0].map((c,i)=>t("th",{children:c},i))})}),t("tbody",{children:l.slice(1).map((c,i)=>t("tr",{children:c.map((n,b)=>t("td",{children:n==0&&b>=5?"-":n},b))},i))})]})}function d(c){const n=c.trim().split(/[\n\r]+/).map(b=>{let L=b.split(/,/);return L.splice(12,1),L.splice(5,1),L});return console.log(" -- parsed drows len",n.length),n}return se(()=>{console.log(" --- BrRegSeq creation time --"),s(et+"br_reg_crosstab.csv").then(c=>{console.log("..fetching table data"),r(d(c))}).catch(c=>console.log(c))},[]),se(()=>{}),console.log("~~~~~~~~~~~~ Rendering with rows len:",l.length),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(S,{xs:"12",className:"d-flex flex-column",children:[t(k,{className:"d-flex flex-row justify-content-start p-0",children:t(S,{xs:"6",className:"d-flex justify-content-start align-content-start pt-2 pr-0",children:t(me,{children:"RNA-seq sample count per brain by region"})})}),t(k,{className:"fixbregtbl",children:t(S,{children:a()})})]})})})}function ea(e){return se(()=>{console.log(" --- ExpBoxPlots creation time --")},[]),t(pe,{children:t(k,{className:"d-flex flex-nowrap flex-fill",children:o(S,{xs:"12",className:"d-flex flex-column",children:[o(k,{className:"d-flex flex-row justify-content-start p-3 pl-0",children:[t(S,{xs:"5",className:"d-flex justify-content-end align-content-start pt-2 pr-0",children:t(me,{children:"Dataset demographics and region report "})}),t(S,{xs:"6",className:"d-flex justify-content-start align-content-center"})]}),t(k,{className:"d-flex flex-fill",children:t("div",{id:"plot1",class:"w-100 align-self-stretch plotly-graph-div",children:" "})})]})})})}const ta=({style:e})=>{const[l,r]=le(1);function s(a){r(Number(a.target.id))}return t("div",{class:"col-12 d-flex flex-nowrap flex-column",children:o(k,{className:"flex-grow-1 pt-1 mt-1 justify-content-start",children:[t(S,{xs:"1",className:"d-flex p-0 m-0 colExpNav justify-content-start",children:o(Ct,{vertical:!0,tabs:!0,children:[t(Be,{children:t(ze,{className:"app-navlnk",id:"1",active:l==1,onClick:s,href:"#",children:"Brain Region Reports"})}),t(Be,{children:t(ze,{className:"app-navlnk",id:"2",active:l==2,onClick:s,href:"#",children:"Dataset reports"})}),t(Be,{children:t(ze,{className:"app-navlnk",children:"more to come.."})})]})}),t(S,{xs:"10",className:"d-flex flex-fill",children:l==1?t(Yl,{}):t(ea,{})})]})})},na=({params:e})=>{let l=e.tab;l!=="exp"&&l!=="rep"&&(l="sel");const[,,,r]=He();return r?(fn(1),l==="sel"?t(Kl,{}):l=="exp"?t(Ql,{}):t(ta,{})):t("h3",{children:"Loading.."})};const la=({tab:e})=>o(S,{children:[t(k,{children:t("h1",{children:"Long RNA-seq Data"})}),t(k,{children:t("p",{children:"Query and explore available long read RNA-seq data."})})]});const aa=({tab:e})=>o(S,{children:[t(k,{children:t("h1",{children:"DNA Methylation data"})}),t(k,{children:t("p",{children:"This is the page to explore DNA Methylation data."})})]});function sa(){const[e,l]=Qn();let[r,s]=sn(e);s||(s="");function a(i,n){l(i)}function d(){switch(r){case"brsel":return t(Yt,{params:{tab:`${s}`}});case"rna":return t(na,{params:{tab:`${s}`}});case"dnam":return t(aa,{});case"lrna":return t(la,{})}return t(Yt,{params:{tab:{tab:s}}})}const c=d();return o(pe,{children:[t(ll,{page:r,tab:s,menuClick:a}),t(en,{fluid:!0,className:"content d-flex h-100",children:t(gl,{children:t(ul,{children:c})})})]})}qn(t(sa,{}),document.getElementById("app"));
